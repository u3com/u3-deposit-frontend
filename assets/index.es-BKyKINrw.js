const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-DrJfIhyE.js","assets/index-DCNQrpcQ.js","assets/index-xlm1Xm0q.css","assets/events-DQ172AOg.js","assets/index-nibyPLVP.js","assets/core-Dsekcj68.js"])))=>i.map(i=>d[i]);
import{Q as Kc,ab as $f,a0 as Ft,$ as If}from"./index-DCNQrpcQ.js";import{r as Jy}from"./events-DQ172AOg.js";import{c as Qy,a as Xy,k as ew,d as tw,s as rw,g as Tu}from"./index-nibyPLVP.js";var pt=Jy();const Wc=Kc(pt);var xo={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var qa=function(t,e){return qa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},qa(t,e)};function nw(t,e){qa(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Fa=function(){return Fa=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Fa.apply(this,arguments)};function iw(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function sw(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function ow(t,e){return function(r,n){e(r,n,t)}}function aw(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function cw(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function uw(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function lw(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function hw(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Ma(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _f(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function dw(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(_f(arguments[e]));return t}function fw(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Ci(t){return this instanceof Ci?(this.v=t,this):new Ci(t)}function pw(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){n[d]&&(i[d]=function(p){return new Promise(function(g,y){s.push([d,p,g,y])>1||a(d,p)})})}function a(d,p){try{c(n[d](p))}catch(g){h(s[0][3],g)}}function c(d){d.value instanceof Ci?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,p){d(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function gw(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Ci(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function yw(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Ma=="function"?Ma(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function ww(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function mw(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function bw(t){return t&&t.__esModule?t:{default:t}}function vw(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Ew(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const $w=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Fa},__asyncDelegator:gw,__asyncGenerator:pw,__asyncValues:yw,__await:Ci,__awaiter:cw,__classPrivateFieldGet:vw,__classPrivateFieldSet:Ew,__createBinding:lw,__decorate:sw,__exportStar:hw,__extends:nw,__generator:uw,__importDefault:bw,__importStar:mw,__makeTemplateObject:ww,__metadata:aw,__param:ow,__read:_f,__rest:iw,__spread:dw,__spreadArrays:fw,__values:Ma},Symbol.toStringTag,{value:"Module"})),Js=$f($w);var Po={},si={},Nu;function Iw(){if(Nu)return si;Nu=1,Object.defineProperty(si,"__esModule",{value:!0}),si.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return si.delay=t,si}var Er={},Co={},$r={},Ru;function _w(){return Ru||(Ru=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.ONE_THOUSAND=$r.ONE_HUNDRED=void 0,$r.ONE_HUNDRED=100,$r.ONE_THOUSAND=1e3),$r}var To={},Bu;function Sw(){return Bu||(Bu=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(To)),To}var Uu;function Sf(){return Uu||(Uu=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Js;e.__exportStar(_w(),t),e.__exportStar(Sw(),t)})(Co)),Co}var Lu;function Ow(){if(Lu)return Er;Lu=1,Object.defineProperty(Er,"__esModule",{value:!0}),Er.fromMiliseconds=Er.toMiliseconds=void 0;const t=Sf();function e(n){return n*t.ONE_THOUSAND}Er.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Er.fromMiliseconds=r,Er}var ju;function Aw(){return ju||(ju=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Js;e.__exportStar(Iw(),t),e.__exportStar(Ow(),t)})(Po)),Po}var Jr={},ku;function Dw(){if(ku)return Jr;ku=1,Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return Jr.Watch=t,Jr.default=t,Jr}var No={},oi={},qu;function xw(){if(qu)return oi;qu=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.IWatch=void 0;class t{}return oi.IWatch=t,oi}var Fu;function Pw(){return Fu||(Fu=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Js.__exportStar(xw(),t)})(No)),No}var Mu;function Cw(){return Mu||(Mu=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Js;e.__exportStar(Aw(),t),e.__exportStar(Dw(),t),e.__exportStar(Pw(),t),e.__exportStar(Sf(),t)})(xo)),xo}var M=Cw();class Kr{}let Tw=class extends Kr{constructor(e){super()}};const zu=M.FIVE_SECONDS,Wr={pulse:"heartbeat_pulse"};let Nw=class Of extends Tw{constructor(e){super(e),this.events=new pt.EventEmitter,this.interval=zu,this.interval=(e==null?void 0:e.interval)||zu}static async init(e){const r=new Of(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),M.toMiliseconds(this.interval))}pulse(){this.events.emit(Wr.pulse)}};const Rw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Bw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,Uw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Lw(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){jw(t);return}return e}function jw(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function ss(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!Uw.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Rw.test(t)||Bw.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Lw)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function kw(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function _e(t,...e){try{return kw(t(...e))}catch(r){return Promise.reject(r)}}function qw(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Fw(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function xs(t){if(qw(t))return String(t);if(Fw(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return xs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const za="base64:";function Mw(t){return typeof t=="string"?t:za+Vw(t)}function zw(t){return typeof t!="string"||!t.startsWith(za)?t:Hw(t.slice(za.length))}function Hw(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Vw(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ye(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Kw(...t){return Ye(t.join(":"))}function os(t){return t=Ye(t),t?t+":":""}function Ww(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function Gw(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const Zw="memory",Yw=()=>{const t=new Map;return{name:Zw,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Jw(t={}){const e={mounts:{"":t.driver||Yw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=Ye(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await Hu(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const d=new Map,p=g=>{let y=d.get(g.base);return y||(y={driver:g.driver,base:g.base,items:[]},d.set(g.base,y)),y};for(const g of u){const y=typeof g=="string",f=Ye(y?g:g.key),v=y?void 0:g.value,b=y||!g.options?l:{...l,...g.options},E=r(f);p(E).items.push({key:f,value:v,relativeKey:E.relativeKey,options:b})}return Promise.all([...d.values()].map(g=>h(g))).then(g=>g.flat())},c={hasItem(u,l={}){u=Ye(u);const{relativeKey:h,driver:d}=r(u);return _e(d.hasItem,h,l)},getItem(u,l={}){u=Ye(u);const{relativeKey:h,driver:d}=r(u);return _e(d.getItem,h,l).then(p=>ss(p))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?_e(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),l).then(d=>d.map(p=>({key:Kw(h.base,p.key),value:ss(p.value)}))):Promise.all(h.items.map(d=>_e(h.driver.getItem,d.relativeKey,d.options).then(p=>({key:d.key,value:ss(p)})))))},getItemRaw(u,l={}){u=Ye(u);const{relativeKey:h,driver:d}=r(u);return d.getItemRaw?_e(d.getItemRaw,h,l):_e(d.getItem,h,l).then(p=>zw(p))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=Ye(u);const{relativeKey:d,driver:p}=r(u);p.setItem&&(await _e(p.setItem,d,xs(l),h),p.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return _e(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:xs(d.value),options:d.options})),l);h.driver.setItem&&await Promise.all(h.items.map(d=>_e(h.driver.setItem,d.relativeKey,xs(d.value),d.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=Ye(u);const{relativeKey:d,driver:p}=r(u);if(p.setItemRaw)await _e(p.setItemRaw,d,l,h);else if(p.setItem)await _e(p.setItem,d,Mw(l),h);else return;p.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Ye(u);const{relativeKey:h,driver:d}=r(u);d.removeItem&&(await _e(d.removeItem,h,l),(l.removeMeta||l.removeMata)&&await _e(d.removeItem,h+"$",l),d.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Ye(u);const{relativeKey:h,driver:d}=r(u),p=Object.create(null);if(d.getMeta&&Object.assign(p,await _e(d.getMeta,h,l)),!l.nativeOnly){const g=await _e(d.getItem,h+"$",l).then(y=>ss(y));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(p,g))}return p},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){var f;u=os(u);const h=n(u,!0);let d=[];const p=[];let g=!0;for(const v of h){(f=v.driver.flags)!=null&&f.maxDepth||(g=!1);const b=await _e(v.driver.getKeys,v.relativeBase,l);for(const E of b){const x=v.mountpoint+Ye(E);d.some(T=>x.startsWith(T))||p.push(x)}d=[v.mountpoint,...d.filter(E=>!E.startsWith(v.mountpoint))]}const y=l.maxDepth!==void 0&&!g;return p.filter(v=>(!y||Ww(v,l.maxDepth))&&Gw(v,u))},async clear(u,l={}){u=os(u),await Promise.all(n(u,!1).map(async h=>{if(h.driver.clear)return _e(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(d.map(p=>h.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>Vu(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=os(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Hu(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){var h,d;u=os(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&((d=(h=e.unwatch)[u])==null||d.call(h),delete e.unwatch[u]),l&&await Vu(e.mounts[u]),e.mountpoints=e.mountpoints.filter(p=>p!==u),delete e.mounts[u])},getMount(u=""){u=Ye(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Ye(u),n(u,l.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function Hu(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function Vu(t){typeof t.dispose=="function"&&await _e(t.dispose)}const Qw=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Xw=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function kr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Xw(t)}catch{return t}}function ar(t){return typeof t=="string"?t:Qw(t)||""}const em="idb-keyval";var tm=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=Qy(t.dbName,t.storeName)),{name:em,options:t,async hasItem(i){return!(typeof await Tu(r(i),n)>"u")},async getItem(i){return await Tu(r(i),n)??null},setItem(i,s){return rw(r(i),s,n)},removeItem(i){return tw(r(i),n)},getKeys(){return ew(n)},clear(){return Xy(n)}}};const rm="WALLET_CONNECT_V2_INDEXED_DB",nm="keyvaluestorage";let im=class{constructor(){this.indexedDb=Jw({driver:tm({dbName:rm,storeName:nm})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,ar(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Ro=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ps={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ro<"u"&&Ro.localStorage?Ps.exports=Ro.localStorage:typeof window<"u"&&window.localStorage?Ps.exports=window.localStorage:Ps.exports=new e})();function sm(t){var e;return[t[0],kr((e=t[1])!=null?e:"")]}let om=class{constructor(){this.localStorage=Ps.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(sm)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return kr(r)}async setItem(e,r){this.localStorage.setItem(e,ar(r))}async removeItem(e){this.localStorage.removeItem(e)}};const am="wc_storage_version",Ku=1,cm=async(t,e,r)=>{const n=am,i=await e.getItem(n);if(i&&i>=Ku){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,Ku),r(e),um(t,o)},um=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let lm=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new om;this.storage=e;try{const r=new im;cm(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var Bo,Wu;function hm(){if(Wu)return Bo;Wu=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Bo=e;function e(r,n,i){var s=i&&i.stringify||t,o=1;if(typeof r=="object"&&r!==null){var a=n.length+o;if(a===1)return r;var c=new Array(a);c[0]=s(r);for(var u=1;u<a;u++)c[u]=s(n[u]);return c.join(" ")}if(typeof r!="string")return r;var l=n.length;if(l===0)return r;for(var h="",d=1-o,p=-1,g=r&&r.length||0,y=0;y<g;){if(r.charCodeAt(y)===37&&y+1<g){switch(p=p>-1?p:0,r.charCodeAt(y+1)){case 100:case 102:if(d>=l||n[d]==null)break;p<y&&(h+=r.slice(p,y)),h+=Number(n[d]),p=y+2,y++;break;case 105:if(d>=l||n[d]==null)break;p<y&&(h+=r.slice(p,y)),h+=Math.floor(Number(n[d])),p=y+2,y++;break;case 79:case 111:case 106:if(d>=l||n[d]===void 0)break;p<y&&(h+=r.slice(p,y));var f=typeof n[d];if(f==="string"){h+="'"+n[d]+"'",p=y+2,y++;break}if(f==="function"){h+=n[d].name||"<anonymous>",p=y+2,y++;break}h+=s(n[d]),p=y+2,y++;break;case 115:if(d>=l)break;p<y&&(h+=r.slice(p,y)),h+=String(n[d]),p=y+2,y++;break;case 37:p<y&&(h+=r.slice(p,y)),h+="%",p=y+2,y++,d--;break}++d}++y}return p===-1?r:(p<g&&(h+=r.slice(p)),h)}return Bo}var Uo,Gu;function dm(){if(Gu)return Uo;Gu=1;const t=hm();Uo=i;const e=T().console||{},r={mapHttpRequest:g,mapHttpResponse:g,wrapRequestSerializer:y,wrapResponseSerializer:y,wrapErrorSerializer:y,req:g,res:g,err:d};function n(I,O){return Array.isArray(I)?I.filter(function(_){return _!=="!stdSerializers.err"}):I===!0?Object.keys(O):!1}function i(I){I=I||{},I.browser=I.browser||{};const O=I.browser.transmit;if(O&&typeof O.send!="function")throw Error("pino: transmit option must have a send function");const D=I.browser.write||e;I.browser.write&&(I.browser.asObject=!0);const _=I.serializers||{},B=n(I.browser.serialize,_);let C=I.browser.serialize;Array.isArray(I.browser.serialize)&&I.browser.serialize.indexOf("!stdSerializers.err")>-1&&(C=!1);const R=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),I.enabled===!1&&(I.level="silent");const L=I.level||"info",$=Object.create(D);$.log||($.log=f),Object.defineProperty($,"levelVal",{get:m}),Object.defineProperty($,"level",{get:A,set:P});const w={transmit:O,serialize:B,asObject:I.browser.asObject,levels:R,timestamp:p(I)};$.levels=i.levels,$.level=L,$.setMaxListeners=$.getMaxListeners=$.emit=$.addListener=$.on=$.prependListener=$.once=$.prependOnceListener=$.removeListener=$.removeAllListeners=$.listeners=$.listenerCount=$.eventNames=$.write=$.flush=f,$.serializers=_,$._serialize=B,$._stdErrSerialize=C,$.child=S,O&&($._logEvent=h());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function A(){return this._level}function P(N){if(N!=="silent"&&!this.levels.values[N])throw Error("unknown level "+N);this._level=N,s(w,$,"error","log"),s(w,$,"fatal","error"),s(w,$,"warn","error"),s(w,$,"info","log"),s(w,$,"debug","log"),s(w,$,"trace","log")}function S(N,U){if(!N)throw new Error("missing bindings for child Pino");U=U||{},B&&N.serializers&&(U.serializers=N.serializers);const j=U.serializers;if(B&&j){var q=Object.assign({},_,j),k=I.browser.serialize===!0?Object.keys(q):B;delete N.serializers,c([N],k,q,this._stdErrSerialize)}function z(H){this._childLevel=(H._childLevel|0)+1,this.error=u(H,N,"error"),this.fatal=u(H,N,"fatal"),this.warn=u(H,N,"warn"),this.info=u(H,N,"info"),this.debug=u(H,N,"debug"),this.trace=u(H,N,"trace"),q&&(this.serializers=q,this._serialize=k),O&&(this._logEvent=h([].concat(H._logEvent.bindings,N)))}return z.prototype=this,new z(this)}return $}i.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},i.stdSerializers=r,i.stdTimeFunctions=Object.assign({},{nullTime:v,epochTime:b,unixTime:E,isoTime:x});function s(I,O,D,_){const B=Object.getPrototypeOf(O);O[D]=O.levelVal>O.levels.values[D]?f:B[D]?B[D]:e[D]||e[_]||f,o(I,O,D)}function o(I,O,D){!I.transmit&&O[D]===f||(O[D]=(function(_){return function(){const C=I.timestamp(),R=new Array(arguments.length),L=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var $=0;$<R.length;$++)R[$]=arguments[$];if(I.serialize&&!I.asObject&&c(R,this._serialize,this.serializers,this._stdErrSerialize),I.asObject?_.call(L,a(this,D,R,C)):_.apply(L,R),I.transmit){const w=I.transmit.level||O.level,m=i.levels.values[w],A=i.levels.values[D];if(A<m)return;l(this,{ts:C,methodLevel:D,methodValue:A,transmitValue:i.levels.values[I.transmit.level||O.level],send:I.transmit.send,val:O.levelVal},R)}}})(O[D]))}function a(I,O,D,_){I._serialize&&c(D,I._serialize,I.serializers,I._stdErrSerialize);const B=D.slice();let C=B[0];const R={};_&&(R.time=_),R.level=i.levels.values[O];let L=(I._childLevel|0)+1;if(L<1&&(L=1),C!==null&&typeof C=="object"){for(;L--&&typeof B[0]=="object";)Object.assign(R,B.shift());C=B.length?t(B.shift(),B):void 0}else typeof C=="string"&&(C=t(B.shift(),B));return C!==void 0&&(R.msg=C),R}function c(I,O,D,_){for(const B in I)if(_&&I[B]instanceof Error)I[B]=i.stdSerializers.err(I[B]);else if(typeof I[B]=="object"&&!Array.isArray(I[B]))for(const C in I[B])O&&O.indexOf(C)>-1&&C in D&&(I[B][C]=D[C](I[B][C]))}function u(I,O,D){return function(){const _=new Array(1+arguments.length);_[0]=O;for(var B=1;B<_.length;B++)_[B]=arguments[B-1];return I[D].apply(this,_)}}function l(I,O,D){const _=O.send,B=O.ts,C=O.methodLevel,R=O.methodValue,L=O.val,$=I._logEvent.bindings;c(D,I._serialize||Object.keys(I.serializers),I.serializers,I._stdErrSerialize===void 0?!0:I._stdErrSerialize),I._logEvent.ts=B,I._logEvent.messages=D.filter(function(w){return $.indexOf(w)===-1}),I._logEvent.level.label=C,I._logEvent.level.value=R,_(C,I._logEvent,L),I._logEvent=h($)}function h(I){return{ts:0,messages:[],bindings:I||[],level:{label:"",value:0}}}function d(I){const O={type:I.constructor.name,msg:I.message,stack:I.stack};for(const D in I)O[D]===void 0&&(O[D]=I[D]);return O}function p(I){return typeof I.timestamp=="function"?I.timestamp:I.timestamp===!1?v:b}function g(){return{}}function y(I){return I}function f(){}function v(){return!1}function b(){return Date.now()}function E(){return Math.round(Date.now()/1e3)}function x(){return new Date(Date.now()).toISOString()}function T(){function I(O){return typeof O<"u"&&O}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return I(self)||I(window)||I(this)||{}}}return Uo}var In=dm();const Hi=Kc(In),fm={level:"info"},Vi="custom_context",Gc=1e3*1024;let pm=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Zu=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new pm(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}},Af=class{constructor(e,r=Gc){this.level=e??"error",this.levelValue=In.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new Zu(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===In.levels.values.error?console.error(e):r===In.levels.values.warn?console.warn(e):r===In.levels.values.debug?console.debug(e):r===In.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(ar({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new Zu(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(ar({extraMetadata:e})),new Blob(r,{type:"application/json"})}},gm=class{constructor(e,r=Gc){this.baseChunkLogger=new Af(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}},ym=class{constructor(e,r=Gc){this.baseChunkLogger=new Af(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var wm=Object.defineProperty,mm=Object.defineProperties,bm=Object.getOwnPropertyDescriptors,Yu=Object.getOwnPropertySymbols,vm=Object.prototype.hasOwnProperty,Em=Object.prototype.propertyIsEnumerable,Ju=(t,e,r)=>e in t?wm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ls=(t,e)=>{for(var r in e||(e={}))vm.call(e,r)&&Ju(t,r,e[r]);if(Yu)for(var r of Yu(e))Em.call(e,r)&&Ju(t,r,e[r]);return t},js=(t,e)=>mm(t,bm(e));function Qs(t){return js(Ls({},t),{level:(t==null?void 0:t.level)||fm.level})}function $m(t,e=Vi){return t[e]||""}function Im(t,e,r=Vi){return t[r]=e,t}function rt(t,e=Vi){let r="";return typeof t.bindings>"u"?r=$m(t,e):r=t.bindings().context||"",r}function _m(t,e,r=Vi){const n=rt(t,r);return n.trim()?`${n}/${e}`:e}function Ke(t,e,r=Vi){const n=_m(t,e,r),i=t.child({context:n});return Im(i,n,r)}function Sm(t){var e,r;const n=new gm((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Hi(js(Ls({},t.opts),{level:"trace",browser:js(Ls({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function Om(t){var e;const r=new ym((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Hi(js(Ls({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function Am(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Sm(t):Om(t)}var Dm=Object.defineProperty,xm=(t,e,r)=>e in t?Dm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Qu=(t,e,r)=>xm(t,typeof e!="symbol"?e+"":e,r);let Pm=class extends Kr{constructor(e){super(),this.opts=e,Qu(this,"protocol","wc"),Qu(this,"version",2)}};var Cm=Object.defineProperty,Tm=(t,e,r)=>e in t?Cm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nm=(t,e,r)=>Tm(t,e+"",r);let Rm=class extends Kr{constructor(e,r){super(),this.core=e,this.logger=r,Nm(this,"records",new Map)}},Bm=class{constructor(e,r){this.logger=e,this.core=r}};class Um extends Kr{constructor(e,r){super(),this.relayer=e,this.logger=r}}let Lm=class extends Kr{constructor(e){super()}},jm=class{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}},km=class extends Kr{constructor(e,r){super(),this.relayer=e,this.logger=r}},qm=class extends Kr{constructor(e,r){super(),this.core=e,this.logger=r}},Fm=class{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}},Mm=class{constructor(e,r){this.projectId=e,this.logger=r}},zm=class{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}};var Hm=Object.defineProperty,Vm=(t,e,r)=>e in t?Hm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xu=(t,e,r)=>Vm(t,typeof e!="symbol"?e+"":e,r);let Km=class{constructor(e){this.opts=e,Xu(this,"protocol","wc"),Xu(this,"version",2)}},Wm=class{constructor(e){this.client=e}};function Gm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Df(t,...e){if(!Gm(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function el(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Zm(t,e){Df(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Qr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lo=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Ym(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function xf(t){return typeof t=="string"&&(t=Ym(t)),Df(t),t}let Jm=class{clone(){return this._cloneInto()}};function Qm(t){const e=n=>t().update(xf(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Pf(t=32){if(Qr&&typeof Qr.getRandomValues=="function")return Qr.getRandomValues(new Uint8Array(t));if(Qr&&typeof Qr.randomBytes=="function")return Qr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Xm(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}let eb=class extends Jm{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Lo(this.buffer)}update(e){el(this);const{view:r,buffer:n,blockLen:i}=this;e=xf(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Lo(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){el(this),Zm(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;Xm(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Lo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const as=BigInt(2**32-1),Ha=BigInt(32);function Cf(t,e=!1){return e?{h:Number(t&as),l:Number(t>>Ha&as)}:{h:Number(t>>Ha&as)|0,l:Number(t&as)|0}}function tb(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Cf(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const rb=(t,e)=>BigInt(t>>>0)<<Ha|BigInt(e>>>0),nb=(t,e,r)=>t>>>r,ib=(t,e,r)=>t<<32-r|e>>>r,sb=(t,e,r)=>t>>>r|e<<32-r,ob=(t,e,r)=>t<<32-r|e>>>r,ab=(t,e,r)=>t<<64-r|e>>>r-32,cb=(t,e,r)=>t>>>r-32|e<<64-r,ub=(t,e)=>e,lb=(t,e)=>t,hb=(t,e,r)=>t<<r|e>>>32-r,db=(t,e,r)=>e<<r|t>>>32-r,fb=(t,e,r)=>e<<r-32|t>>>64-r,pb=(t,e,r)=>t<<r-32|e>>>64-r;function gb(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const yb=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),wb=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,mb=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),bb=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,vb=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),Eb=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,Z={fromBig:Cf,split:tb,toBig:rb,shrSH:nb,shrSL:ib,rotrSH:sb,rotrSL:ob,rotrBH:ab,rotrBL:cb,rotr32H:ub,rotr32L:lb,rotlSH:hb,rotlSL:db,rotlBH:fb,rotlBL:pb,add:gb,add3L:yb,add3H:wb,add4L:mb,add4H:bb,add5H:Eb,add5L:vb},[$b,Ib]=Z.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),cr=new Uint32Array(80),ur=new Uint32Array(80);let _b=class extends eb{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:p,Gl:g,Hh:y,Hl:f}=this;return[e,r,n,i,s,o,a,c,u,l,h,d,p,g,y,f]}set(e,r,n,i,s,o,a,c,u,l,h,d,p,g,y,f){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=p|0,this.Gl=g|0,this.Hh=y|0,this.Hl=f|0}process(e,r){for(let E=0;E<16;E++,r+=4)cr[E]=e.getUint32(r),ur[E]=e.getUint32(r+=4);for(let E=16;E<80;E++){const x=cr[E-15]|0,T=ur[E-15]|0,I=Z.rotrSH(x,T,1)^Z.rotrSH(x,T,8)^Z.shrSH(x,T,7),O=Z.rotrSL(x,T,1)^Z.rotrSL(x,T,8)^Z.shrSL(x,T,7),D=cr[E-2]|0,_=ur[E-2]|0,B=Z.rotrSH(D,_,19)^Z.rotrBH(D,_,61)^Z.shrSH(D,_,6),C=Z.rotrSL(D,_,19)^Z.rotrBL(D,_,61)^Z.shrSL(D,_,6),R=Z.add4L(O,C,ur[E-7],ur[E-16]),L=Z.add4H(R,I,B,cr[E-7],cr[E-16]);cr[E]=L|0,ur[E]=R|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:p,Fl:g,Gh:y,Gl:f,Hh:v,Hl:b}=this;for(let E=0;E<80;E++){const x=Z.rotrSH(h,d,14)^Z.rotrSH(h,d,18)^Z.rotrBH(h,d,41),T=Z.rotrSL(h,d,14)^Z.rotrSL(h,d,18)^Z.rotrBL(h,d,41),I=h&p^~h&y,O=d&g^~d&f,D=Z.add5L(b,T,O,Ib[E],ur[E]),_=Z.add5H(D,v,x,I,$b[E],cr[E]),B=D|0,C=Z.rotrSH(n,i,28)^Z.rotrBH(n,i,34)^Z.rotrBH(n,i,39),R=Z.rotrSL(n,i,28)^Z.rotrBL(n,i,34)^Z.rotrBL(n,i,39),L=n&s^n&a^s&a,$=i&o^i&c^o&c;v=y|0,b=f|0,y=p|0,f=g|0,p=h|0,g=d|0,{h,l:d}=Z.add(u|0,l|0,_|0,B|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const w=Z.add3L(B,R,$);n=Z.add3H(w,_,C,L),i=w|0}({h:n,l:i}=Z.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Z.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Z.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Z.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=Z.add(this.Eh|0,this.El|0,h|0,d|0),{h:p,l:g}=Z.add(this.Fh|0,this.Fl|0,p|0,g|0),{h:y,l:f}=Z.add(this.Gh|0,this.Gl|0,y|0,f|0),{h:v,l:b}=Z.add(this.Hh|0,this.Hl|0,v|0,b|0),this.set(n,i,s,o,a,c,u,l,h,d,p,g,y,f,v,b)}roundClean(){cr.fill(0),ur.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Sb=Qm(()=>new _b);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Zc=BigInt(0),Tf=BigInt(1),Ob=BigInt(2);function Yc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jc(t){if(!Yc(t))throw new Error("Uint8Array expected")}function jo(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Ab=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Qc(t){Jc(t);let e="";for(let r=0;r<t.length;r++)e+=Ab[t[r]];return e}function Nf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Zc:BigInt("0x"+t)}const zt={_0:48,_9:57,A:65,F:70,a:97,f:102};function tl(t){if(t>=zt._0&&t<=zt._9)return t-zt._0;if(t>=zt.A&&t<=zt.F)return t-(zt.A-10);if(t>=zt.a&&t<=zt.f)return t-(zt.a-10)}function Rf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=tl(t.charCodeAt(s)),a=tl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Db(t){return Nf(Qc(t))}function Cs(t){return Jc(t),Nf(Qc(Uint8Array.from(t).reverse()))}function Bf(t,e){return Rf(t.toString(16).padStart(e*2,"0"))}function Va(t,e){return Bf(t,e).reverse()}function Ht(t,e,r){let n;if(typeof e=="string")try{n=Rf(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Yc(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function rl(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Jc(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const ko=t=>typeof t=="bigint"&&Zc<=t;function xb(t,e,r){return ko(t)&&ko(e)&&ko(r)&&e<=t&&t<r}function ai(t,e,r,n){if(!xb(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Pb(t){let e;for(e=0;t>Zc;t>>=Tf,e+=1);return e}const Cb=t=>(Ob<<BigInt(t-1))-Tf,Tb={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Yc(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Xc(t,e,r={}){const n=(i,s,o)=>{const a=Tb[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function nl(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Pe=BigInt(0),ye=BigInt(1),Or=BigInt(2),Nb=BigInt(3),Ka=BigInt(4),il=BigInt(5),sl=BigInt(8);function Ee(t,e){const r=t%e;return r>=Pe?r:e+r}function Rb(t,e,r){if(e<Pe)throw new Error("invalid exponent, negatives unsupported");if(r<=Pe)throw new Error("invalid modulus");if(r===ye)return Pe;let n=ye;for(;e>Pe;)e&ye&&(n=n*t%r),t=t*t%r,e>>=ye;return n}function Tt(t,e,r){let n=t;for(;e-- >Pe;)n*=n,n%=r;return n}function ol(t,e){if(t===Pe)throw new Error("invert: expected non-zero number");if(e<=Pe)throw new Error("invert: expected positive modulus, got "+e);let r=Ee(t,e),n=e,i=Pe,s=ye;for(;r!==Pe;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==ye)throw new Error("invert: does not exist");return Ee(i,e)}function Bb(t){const e=(t-ye)/Or;let r,n,i;for(r=t-ye,n=0;r%Or===Pe;r/=Or,n++);for(i=Or;i<t&&Rb(i,e,t)!==t-ye;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+ye)/Ka;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+ye)/Or;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let g=o.sqr(h);d<c&&!o.eql(g,o.ONE);d++)g=o.sqr(g);const p=o.pow(u,ye<<BigInt(c-d-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=d}return l}}function Ub(t){if(t%Ka===Nb){const e=(t+ye)/Ka;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%sl===il){const e=(t-il)/sl;return function(r,n){const i=r.mul(n,Or),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Or),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return Bb(t)}const Lb=(t,e)=>(Ee(t,e)&ye)===ye,jb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kb(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=jb.reduce((n,i)=>(n[i]="function",n),e);return Xc(t,r)}function qb(t,e,r){if(r<Pe)throw new Error("invalid exponent, negatives unsupported");if(r===Pe)return t.ONE;if(r===ye)return e;let n=t.ONE,i=e;for(;r>Pe;)r&ye&&(n=t.mul(n,i)),i=t.sqr(i),r>>=ye;return n}function Fb(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Uf(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Lf(t,e,r=!1,n={}){if(t<=Pe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Uf(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Cb(i),ZERO:Pe,ONE:ye,create:c=>Ee(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Pe<=c&&c<t},is0:c=>c===Pe,isOdd:c=>(c&ye)===ye,neg:c=>Ee(-c,t),eql:(c,u)=>c===u,sqr:c=>Ee(c*c,t),add:(c,u)=>Ee(c+u,t),sub:(c,u)=>Ee(c-u,t),mul:(c,u)=>Ee(c*u,t),pow:(c,u)=>qb(a,c,u),div:(c,u)=>Ee(c*ol(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>ol(c,t),sqrt:n.sqrt||(c=>(o||(o=Ub(t)),o(a,c))),invertBatch:c=>Fb(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?Va(c,s):Bf(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Cs(c):Db(c)}});return Object.freeze(a)}const al=BigInt(0),cs=BigInt(1);function qo(t,e){const r=e.negate();return t?r:e}function jf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Fo(t,e){jf(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function Mb(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function zb(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Mo=new WeakMap,kf=new WeakMap;function zo(t){return kf.get(t)||1}function Hb(t,e){return{constTimeNegate:qo,hasPrecomputes(r){return zo(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>al;)n&cs&&(i=i.add(s)),s=s.double(),n>>=cs;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Fo(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Fo(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let d=0;d<s;d++){const p=d*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=cs);const y=p,f=p+Math.abs(g)-1,v=d%2!==0,b=g<0;g===0?c=c.add(qo(v,n[y])):a=a.add(qo(b,n[f]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Fo(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(i===al)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=cs),p===0)continue;let g=n[d+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=Mo.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Mo.set(n,i(s))),s},wNAFCached(r,n,i){const s=zo(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=zo(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){jf(n,e),kf.set(r,n),Mo.delete(r)}}}function Vb(t,e,r,n){if(Mb(r,t),zb(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Pb(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let d=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),d=d.add(g);if(l=l.add(d),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function Kb(t){return kb(t.Fp),Xc(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Uf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const $t=BigInt(0),We=BigInt(1),us=BigInt(2),Wb=BigInt(8),Gb={zip215:!0};function Zb(t){const e=Kb(t);return Xc(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Yb(t){const e=Zb(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=us<<BigInt(a*8)-We,l=r.create,h=Lf(e.n,e.nBitLength),d=e.uvRatio||((w,m)=>{try{return{isValid:!0,value:r.sqrt(w*r.inv(m))}}catch{return{isValid:!1,value:$t}}}),p=e.adjustScalarBytes||(w=>w),g=e.domain||((w,m,A)=>{if(jo("phflag",A),m.length||A)throw new Error("Contexts/pre-hash are not supported");return w});function y(w,m){ai("coordinate "+w,m,$t,u)}function f(w){if(!(w instanceof E))throw new Error("ExtendedPoint expected")}const v=nl((w,m)=>{const{ex:A,ey:P,ez:S}=w,N=w.is0();m==null&&(m=N?Wb:r.inv(S));const U=l(A*m),j=l(P*m),q=l(S*m);if(N)return{x:$t,y:We};if(q!==We)throw new Error("invZ was invalid");return{x:U,y:j}}),b=nl(w=>{const{a:m,d:A}=e;if(w.is0())throw new Error("bad point: ZERO");const{ex:P,ey:S,ez:N,et:U}=w,j=l(P*P),q=l(S*S),k=l(N*N),z=l(k*k),H=l(j*m),G=l(k*l(H+q)),K=l(z+l(A*l(j*q)));if(G!==K)throw new Error("bad point: equation left != right (1)");const V=l(P*S),fe=l(N*U);if(V!==fe)throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(m,A,P,S){this.ex=m,this.ey=A,this.ez=P,this.et=S,y("x",m),y("y",A),y("z",P),y("t",S),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof E)throw new Error("extended point not allowed");const{x:A,y:P}=m||{};return y("x",A),y("y",P),new E(A,P,We,l(A*P))}static normalizeZ(m){const A=r.invertBatch(m.map(P=>P.ez));return m.map((P,S)=>P.toAffine(A[S])).map(E.fromAffine)}static msm(m,A){return Vb(E,h,m,A)}_setWindowSize(m){I.setWindowSize(this,m)}assertValidity(){b(this)}equals(m){f(m);const{ex:A,ey:P,ez:S}=this,{ex:N,ey:U,ez:j}=m,q=l(A*j),k=l(N*S),z=l(P*j),H=l(U*S);return q===k&&z===H}is0(){return this.equals(E.ZERO)}negate(){return new E(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:m}=e,{ex:A,ey:P,ez:S}=this,N=l(A*A),U=l(P*P),j=l(us*l(S*S)),q=l(m*N),k=A+P,z=l(l(k*k)-N-U),H=q+U,G=H-j,K=q-U,V=l(z*G),fe=l(H*K),se=l(z*K),ne=l(G*H);return new E(V,fe,ne,se)}add(m){f(m);const{a:A,d:P}=e,{ex:S,ey:N,ez:U,et:j}=this,{ex:q,ey:k,ez:z,et:H}=m;if(A===BigInt(-1)){const Su=l((N-S)*(k+q)),Ou=l((N+S)*(k-q)),Do=l(Ou-Su);if(Do===$t)return this.double();const Au=l(U*us*H),Du=l(j*us*z),xu=Du+Au,Pu=Ou+Su,Cu=Du-Au,Wy=l(xu*Do),Gy=l(Pu*Cu),Zy=l(xu*Cu),Yy=l(Do*Pu);return new E(Wy,Gy,Yy,Zy)}const G=l(S*q),K=l(N*k),V=l(j*P*H),fe=l(U*z),se=l((S+N)*(q+k)-G-K),ne=fe-V,oe=fe+V,pe=l(K-A*G),gt=l(se*ne),Hy=l(oe*pe),Vy=l(se*pe),Ky=l(ne*oe);return new E(gt,Hy,Ky,Vy)}subtract(m){return this.add(m.negate())}wNAF(m){return I.wNAFCached(this,m,E.normalizeZ)}multiply(m){const A=m;ai("scalar",A,We,n);const{p:P,f:S}=this.wNAF(A);return E.normalizeZ([P,S])[0]}multiplyUnsafe(m,A=E.ZERO){const P=m;return ai("scalar",P,$t,n),P===$t?T:this.is0()||P===We?this:I.wNAFCachedUnsafe(this,P,E.normalizeZ,A)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return I.unsafeLadder(this,n).is0()}toAffine(m){return v(this,m)}clearCofactor(){const{h:m}=e;return m===We?this:this.multiplyUnsafe(m)}static fromHex(m,A=!1){const{d:P,a:S}=e,N=r.BYTES;m=Ht("pointHex",m,N),jo("zip215",A);const U=m.slice(),j=m[N-1];U[N-1]=j&-129;const q=Cs(U),k=A?u:r.ORDER;ai("pointHex.y",q,$t,k);const z=l(q*q),H=l(z-We),G=l(P*z-S);let{isValid:K,value:V}=d(H,G);if(!K)throw new Error("Point.fromHex: invalid y coordinate");const fe=(V&We)===We,se=(j&128)!==0;if(!A&&V===$t&&se)throw new Error("Point.fromHex: x=0 and x_0=1");return se!==fe&&(V=l(-V)),E.fromAffine({x:V,y:q})}static fromPrivateKey(m){return _(m).point}toRawBytes(){const{x:m,y:A}=this.toAffine(),P=Va(A,r.BYTES);return P[P.length-1]|=m&We?128:0,P}toHex(){return Qc(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,We,l(e.Gx*e.Gy)),E.ZERO=new E($t,We,We,$t);const{BASE:x,ZERO:T}=E,I=Hb(E,a*8);function O(w){return Ee(w,n)}function D(w){return O(Cs(w))}function _(w){const m=r.BYTES;w=Ht("private key",w,m);const A=Ht("hashed private key",s(w),2*m),P=p(A.slice(0,m)),S=A.slice(m,2*m),N=D(P),U=x.multiply(N),j=U.toRawBytes();return{head:P,prefix:S,scalar:N,point:U,pointBytes:j}}function B(w){return _(w).pointBytes}function C(w=new Uint8Array,...m){const A=rl(...m);return D(s(g(A,Ht("context",w),!!i)))}function R(w,m,A={}){w=Ht("message",w),i&&(w=i(w));const{prefix:P,scalar:S,pointBytes:N}=_(m),U=C(A.context,P,w),j=x.multiply(U).toRawBytes(),q=C(A.context,j,N,w),k=O(U+q*S);ai("signature.s",k,$t,n);const z=rl(j,Va(k,r.BYTES));return Ht("result",z,r.BYTES*2)}const L=Gb;function $(w,m,A,P=L){const{context:S,zip215:N}=P,U=r.BYTES;w=Ht("signature",w,2*U),m=Ht("message",m),A=Ht("publicKey",A,U),N!==void 0&&jo("zip215",N),i&&(m=i(m));const j=Cs(w.slice(U,2*U));let q,k,z;try{q=E.fromHex(A,N),k=E.fromHex(w.slice(0,U),N),z=x.multiplyUnsafe(j)}catch{return!1}if(!N&&q.isSmallOrder())return!1;const H=C(S,k.toRawBytes(),q.toRawBytes(),m);return k.add(q.multiplyUnsafe(H)).subtract(z).clearCofactor().equals(E.ZERO)}return x._setWindowSize(8),{CURVE:e,getPublicKey:B,sign:R,verify:$,ExtendedPoint:E,utils:{getExtendedPublicKey:_,randomPrivateKey:()=>o(r.BYTES),precompute(w=8,m=E.BASE){return m._setWindowSize(w),m.multiply(BigInt(3)),m}}}}BigInt(0),BigInt(1);const eu=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),cl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Jb=BigInt(1),ul=BigInt(2);BigInt(3);const Qb=BigInt(5),Xb=BigInt(8);function e0(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=eu,o=t*t%s*t%s,a=Tt(o,ul,s)*o%s,c=Tt(a,Jb,s)*t%s,u=Tt(c,Qb,s)*c%s,l=Tt(u,e,s)*u%s,h=Tt(l,r,s)*l%s,d=Tt(h,n,s)*h%s,p=Tt(d,i,s)*d%s,g=Tt(p,i,s)*d%s,y=Tt(g,e,s)*u%s;return{pow_p_5_8:Tt(y,ul,s)*t%s,b2:o}}function t0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function r0(t,e){const r=eu,n=Ee(e*e*e,r),i=Ee(n*n*e,r),s=e0(t*i).pow_p_5_8;let o=Ee(t*n*s,r);const a=Ee(e*o*o,r),c=o,u=Ee(o*cl,r),l=a===t,h=a===Ee(-t,r),d=a===Ee(-t*cl,r);return l&&(o=c),(h||d)&&(o=u),Lb(o,r)&&(o=Ee(-o,r)),{isValid:l||h,value:o}}const n0=Lf(eu,void 0,!0),i0={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:n0,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Xb,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Sb,randomBytes:Pf,adjustScalarBytes:t0,uvRatio:r0},qf=Yb(i0),s0="EdDSA",o0="JWT",ks=".",Xs="base64url",Ff="utf8",Mf="utf8",a0=":",c0="did",u0="key",ll="base58btc",l0="z",h0="K36",d0=32;function tu(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function zf(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?tu(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Hf(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=zf(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return tu(r)}function f0(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var y=0,f=0,v=0,b=g.length;v!==b&&g[v]===0;)v++,y++;for(var E=(b-v)*l+1>>>0,x=new Uint8Array(E);v!==b;){for(var T=g[v],I=0,O=E-1;(T!==0||I<f)&&O!==-1;O--,I++)T+=256*x[O]>>>0,x[O]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");f=I,v++}for(var D=E-f;D!==E&&x[D]===0;)D++;for(var _=c.repeat(y);D<E;++D)_+=t.charAt(x[D]);return _}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var y=0;if(g[y]!==" "){for(var f=0,v=0;g[y]===c;)f++,y++;for(var b=(g.length-y)*u+1>>>0,E=new Uint8Array(b);g[y];){var x=r[g.charCodeAt(y)];if(x===255)return;for(var T=0,I=b-1;(x!==0||T<v)&&I!==-1;I--,T++)x+=a*E[I]>>>0,E[I]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");v=T,y++}if(g[y]!==" "){for(var O=b-v;O!==b&&E[O]===0;)O++;for(var D=new Uint8Array(f+(b-O)),_=f;O!==b;)D[_++]=E[O++];return D}}}function p(g){var y=d(g);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var p0=f0,g0=p0;const Vf=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},y0=t=>new TextEncoder().encode(t),w0=t=>new TextDecoder().decode(t);let m0=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},b0=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Kf(this,e)}},v0=class{constructor(e){this.decoders=e}or(e){return Kf(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Kf=(t,e)=>new v0({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let E0=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new m0(e,r,n),this.decoder=new b0(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const eo=({name:t,prefix:e,encode:r,decode:n})=>new E0(t,e,r,n),Ki=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=g0(r,e);return eo({prefix:t,name:e,encode:n,decode:s=>Vf(i(s))})},$0=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},I0=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ke=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>eo({prefix:e,name:t,encode(i){return I0(i,n,r)},decode(i){return $0(i,n,r,t)}}),_0=eo({prefix:"\0",name:"identity",encode:t=>w0(t),decode:t=>y0(t)});var S0=Object.freeze({__proto__:null,identity:_0});const O0=ke({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var A0=Object.freeze({__proto__:null,base2:O0});const D0=ke({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var x0=Object.freeze({__proto__:null,base8:D0});const P0=Ki({prefix:"9",name:"base10",alphabet:"0123456789"});var C0=Object.freeze({__proto__:null,base10:P0});const T0=ke({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),N0=ke({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var R0=Object.freeze({__proto__:null,base16:T0,base16upper:N0});const B0=ke({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),U0=ke({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),L0=ke({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),j0=ke({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),k0=ke({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),q0=ke({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),F0=ke({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),M0=ke({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),z0=ke({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var H0=Object.freeze({__proto__:null,base32:B0,base32upper:U0,base32pad:L0,base32padupper:j0,base32hex:k0,base32hexupper:q0,base32hexpad:F0,base32hexpadupper:M0,base32z:z0});const V0=Ki({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),K0=Ki({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var W0=Object.freeze({__proto__:null,base36:V0,base36upper:K0});const G0=Ki({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Z0=Ki({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Y0=Object.freeze({__proto__:null,base58btc:G0,base58flickr:Z0});const J0=ke({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Q0=ke({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),X0=ke({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),e1=ke({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var t1=Object.freeze({__proto__:null,base64:J0,base64pad:Q0,base64url:X0,base64urlpad:e1});const Wf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),r1=Wf.reduce((t,e,r)=>(t[r]=e,t),[]),n1=Wf.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function i1(t){return t.reduce((e,r)=>(e+=r1[r],e),"")}function s1(t){const e=[];for(const r of t){const n=n1[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const o1=eo({prefix:"🚀",name:"base256emoji",encode:i1,decode:s1});var a1=Object.freeze({__proto__:null,base256emoji:o1}),c1=Gf,hl=128,u1=-128,l1=Math.pow(2,31);function Gf(t,e,r){e=e||[],r=r||0;for(var n=r;t>=l1;)e[r++]=t&255|hl,t/=128;for(;t&u1;)e[r++]=t&255|hl,t>>>=7;return e[r]=t|0,Gf.bytes=r-n+1,e}var h1=Wa,d1=128,dl=127;function Wa(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Wa.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&dl)<<i:(o&dl)*Math.pow(2,i),i+=7}while(o>=d1);return Wa.bytes=s-n,r}var f1=Math.pow(2,7),p1=Math.pow(2,14),g1=Math.pow(2,21),y1=Math.pow(2,28),w1=Math.pow(2,35),m1=Math.pow(2,42),b1=Math.pow(2,49),v1=Math.pow(2,56),E1=Math.pow(2,63),$1=function(t){return t<f1?1:t<p1?2:t<g1?3:t<y1?4:t<w1?5:t<m1?6:t<b1?7:t<v1?8:t<E1?9:10},I1={encode:c1,decode:h1,encodingLength:$1},Zf=I1;const fl=(t,e,r=0)=>(Zf.encode(t,e,r),e),pl=t=>Zf.encodingLength(t),Ga=(t,e)=>{const r=e.byteLength,n=pl(t),i=n+pl(r),s=new Uint8Array(i+r);return fl(t,s,0),fl(r,s,n),s.set(e,i),new _1(t,r,e,s)};let _1=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const Yf=({name:t,code:e,encode:r})=>new S1(t,e,r);let S1=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ga(this.code,r):r.then(n=>Ga(this.code,n))}else throw Error("Unknown type, must be binary type")}};const Jf=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),O1=Yf({name:"sha2-256",code:18,encode:Jf("SHA-256")}),A1=Yf({name:"sha2-512",code:19,encode:Jf("SHA-512")});var D1=Object.freeze({__proto__:null,sha256:O1,sha512:A1});const Qf=0,x1="identity",Xf=Vf,P1=t=>Ga(Qf,Xf(t)),C1={code:Qf,name:x1,encode:Xf,digest:P1};var T1=Object.freeze({__proto__:null,identity:C1});new TextEncoder,new TextDecoder;const gl={...S0,...A0,...x0,...C0,...R0,...H0,...W0,...Y0,...t1,...a1};({...D1,...T1});function ep(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const yl=ep("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ho=ep("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=zf(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),tp={utf8:yl,"utf-8":yl,hex:gl.base16,latin1:Ho,ascii:Ho,binary:Ho,...gl};function to(t,e="utf8"){const r=tp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Yn(t,e="utf8"){const r=tp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?tu(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function wl(t){return kr(to(Yn(t,Xs),Ff))}function qs(t){return to(Yn(ar(t),Ff),Xs)}function rp(t){const e=Yn(h0,ll),r=l0+to(Hf([e,t]),ll);return[c0,u0,r].join(a0)}function N1(t){return to(t,Xs)}function R1(t){return Yn(t,Xs)}function B1(t){return Yn([qs(t.header),qs(t.payload)].join(ks),Mf)}function U1(t){return[qs(t.header),qs(t.payload),N1(t.signature)].join(ks)}function Za(t){const e=t.split(ks),r=wl(e[0]),n=wl(e[1]),i=R1(e[2]),s=Yn(e.slice(0,2).join(ks),Mf);return{header:r,payload:n,signature:i,data:s}}function ml(t=Pf(d0)){const e=qf.getPublicKey(t);return{secretKey:Hf([t,e]),publicKey:e}}async function L1(t,e,r,n,i=M.fromMiliseconds(Date.now())){const s={alg:s0,typ:o0},o=rp(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=B1({header:s,payload:c}),l=qf.sign(u,n.secretKey.slice(0,32));return U1({header:s,payload:c,signature:l})}var bl=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},j1=(function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t})(),k1=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),q1=(function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t})(),F1=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),M1=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),z1=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,H1=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,vl=3,V1=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",z1]],El=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function K1(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new M1:typeof navigator<"u"?G1(navigator.userAgent):Y1()}function W1(t){return t!==""&&V1.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function G1(t){var e=W1(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new F1;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<vl&&(i=bl(bl([],i,!0),J1(vl-i.length),!0)):i=[];var s=i.join("."),o=Z1(t),a=H1.exec(t);return a&&a[1]?new q1(r,s,o,a[1]):new j1(r,s,o)}function Z1(t){for(var e=0,r=El.length;e<r;e++){var n=El[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function Y1(){var t=typeof process<"u"&&process.version;return t?new k1(process.version.slice(1)):null}function J1(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ae={},$l;function np(){if($l)return ae;$l=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.getLocalStorage=ae.getLocalStorageOrThrow=ae.getCrypto=ae.getCryptoOrThrow=ae.getLocation=ae.getLocationOrThrow=ae.getNavigator=ae.getNavigatorOrThrow=ae.getDocument=ae.getDocumentOrThrow=ae.getFromWindowOrThrow=ae.getFromWindow=void 0;function t(d){let p;return typeof window<"u"&&typeof window[d]<"u"&&(p=window[d]),p}ae.getFromWindow=t;function e(d){const p=t(d);if(!p)throw new Error(`${d} is not defined in Window`);return p}ae.getFromWindowOrThrow=e;function r(){return e("document")}ae.getDocumentOrThrow=r;function n(){return t("document")}ae.getDocument=n;function i(){return e("navigator")}ae.getNavigatorOrThrow=i;function s(){return t("navigator")}ae.getNavigator=s;function o(){return e("location")}ae.getLocationOrThrow=o;function a(){return t("location")}ae.getLocation=a;function c(){return e("crypto")}ae.getCryptoOrThrow=c;function u(){return t("crypto")}ae.getCrypto=u;function l(){return e("localStorage")}ae.getLocalStorageOrThrow=l;function h(){return t("localStorage")}return ae.getLocalStorage=h,ae}var dt=np(),ci={},Il;function Q1(){if(Il)return ci;Il=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.getWindowMetadata=void 0;const t=np();function e(){let r,n;try{r=t.getDocumentOrThrow(),n=t.getLocationOrThrow()}catch{return null}function i(){const p=r.getElementsByTagName("link"),g=[];for(let y=0;y<p.length;y++){const f=p[y],v=f.getAttribute("rel");if(v&&v.toLowerCase().indexOf("icon")>-1){const b=f.getAttribute("href");if(b)if(b.toLowerCase().indexOf("https:")===-1&&b.toLowerCase().indexOf("http:")===-1&&b.indexOf("//")!==0){let E=n.protocol+"//"+n.host;if(b.indexOf("/")===0)E+=b;else{const x=n.pathname.split("/");x.pop();const T=x.join("/");E+=T+"/"+b}g.push(E)}else if(b.indexOf("//")===0){const E=n.protocol+b;g.push(E)}else g.push(b)}}return g}function s(...p){const g=r.getElementsByTagName("meta");for(let y=0;y<g.length;y++){const f=g[y],v=["itemprop","property","name"].map(b=>f.getAttribute(b)).filter(b=>b?p.includes(b):!1);if(v.length&&v){const b=f.getAttribute("content");if(b)return b}}return""}function o(){let p=s("name","og:site_name","og:title","twitter:title");return p||(p=r.title),p}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),u=a(),l=n.origin,h=i();return{description:u,url:l,icons:h,name:c}}return ci.getWindowMetadata=e,ci}var ip=Q1();function X1(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0;const p=u.length;for(;d!==p&&u[d]===0;)d++,l++;const g=(p-d)*s+1>>>0,y=new Uint8Array(g);for(;d!==p;){let b=u[d],E=0;for(let x=g-1;(b!==0||E<h)&&x!==-1;x--,E++)b+=256*y[x]>>>0,y[x]=b%r>>>0,b=b/r>>>0;if(b!==0)throw new Error("Non-zero carry");h=E,d++}let f=g-h;for(;f!==g&&y[f]===0;)f++;let v=n.repeat(l);for(;f<g;++f)v+=t.charAt(y[f]);return v}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===n;)h++,l++;const p=(u.length-l)*i+1>>>0,g=new Uint8Array(p);for(;l<u.length;){const b=u.charCodeAt(l);if(b>255)return;let E=e[b];if(E===255)return;let x=0;for(let T=p-1;(E!==0||x<d)&&T!==-1;T--,x++)E+=r*g[T]>>>0,g[T]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");d=x,l++}let y=p-d;for(;y!==p&&g[y]===0;)y++;const f=new Uint8Array(h+(p-y));let v=h;for(;y!==p;)f[v++]=g[y++];return f}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var ev="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";X1(ev);function sp(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Si(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=sp(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return r}function tv(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var y=0,f=0,v=0,b=g.length;v!==b&&g[v]===0;)v++,y++;for(var E=(b-v)*l+1>>>0,x=new Uint8Array(E);v!==b;){for(var T=g[v],I=0,O=E-1;(T!==0||I<f)&&O!==-1;O--,I++)T+=256*x[O]>>>0,x[O]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");f=I,v++}for(var D=E-f;D!==E&&x[D]===0;)D++;for(var _=c.repeat(y);D<E;++D)_+=t.charAt(x[D]);return _}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var y=0;if(g[y]!==" "){for(var f=0,v=0;g[y]===c;)f++,y++;for(var b=(g.length-y)*u+1>>>0,E=new Uint8Array(b);g[y];){var x=r[g.charCodeAt(y)];if(x===255)return;for(var T=0,I=b-1;(x!==0||T<v)&&I!==-1;I--,T++)x+=a*E[I]>>>0,E[I]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");v=T,y++}if(g[y]!==" "){for(var O=b-v;O!==b&&E[O]===0;)O++;for(var D=new Uint8Array(f+(b-O)),_=f;O!==b;)D[_++]=E[O++];return D}}}function p(g){var y=d(g);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var rv=tv,nv=rv;const iv=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},sv=t=>new TextEncoder().encode(t),ov=t=>new TextDecoder().decode(t);class av{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class cv{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return op(this,e)}}class uv{constructor(e){this.decoders=e}or(e){return op(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const op=(t,e)=>new uv({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class lv{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new av(e,r,n),this.decoder=new cv(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ro=({name:t,prefix:e,encode:r,decode:n})=>new lv(t,e,r,n),Wi=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=nv(r,e);return ro({prefix:t,name:e,encode:n,decode:s=>iv(i(s))})},hv=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},dv=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},qe=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>ro({prefix:e,name:t,encode(i){return dv(i,n,r)},decode(i){return hv(i,n,r,t)}}),fv=ro({prefix:"\0",name:"identity",encode:t=>ov(t),decode:t=>sv(t)}),pv=Object.freeze(Object.defineProperty({__proto__:null,identity:fv},Symbol.toStringTag,{value:"Module"})),gv=qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),yv=Object.freeze(Object.defineProperty({__proto__:null,base2:gv},Symbol.toStringTag,{value:"Module"})),wv=qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),mv=Object.freeze(Object.defineProperty({__proto__:null,base8:wv},Symbol.toStringTag,{value:"Module"})),bv=Wi({prefix:"9",name:"base10",alphabet:"0123456789"}),vv=Object.freeze(Object.defineProperty({__proto__:null,base10:bv},Symbol.toStringTag,{value:"Module"})),Ev=qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),$v=qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Iv=Object.freeze(Object.defineProperty({__proto__:null,base16:Ev,base16upper:$v},Symbol.toStringTag,{value:"Module"})),_v=qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Sv=qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ov=qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Av=qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dv=qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xv=qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Pv=qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Cv=qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Tv=qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Nv=Object.freeze(Object.defineProperty({__proto__:null,base32:_v,base32hex:Dv,base32hexpad:Pv,base32hexpadupper:Cv,base32hexupper:xv,base32pad:Ov,base32padupper:Av,base32upper:Sv,base32z:Tv},Symbol.toStringTag,{value:"Module"})),Rv=Wi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bv=Wi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Uv=Object.freeze(Object.defineProperty({__proto__:null,base36:Rv,base36upper:Bv},Symbol.toStringTag,{value:"Module"})),Lv=Wi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),jv=Wi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),kv=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Lv,base58flickr:jv},Symbol.toStringTag,{value:"Module"})),qv=qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Fv=qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Mv=qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),zv=qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Hv=Object.freeze(Object.defineProperty({__proto__:null,base64:qv,base64pad:Fv,base64url:Mv,base64urlpad:zv},Symbol.toStringTag,{value:"Module"})),ap=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Vv=ap.reduce((t,e,r)=>(t[r]=e,t),[]),Kv=ap.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Wv(t){return t.reduce((e,r)=>(e+=Vv[r],e),"")}function Gv(t){const e=[];for(const r of t){const n=Kv[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Zv=ro({prefix:"🚀",name:"base256emoji",encode:Wv,decode:Gv}),Yv=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Zv},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const _l={...pv,...yv,...mv,...vv,...Iv,...Nv,...Uv,...kv,...Hv,...Yv};function cp(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Sl=cp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Vo=cp("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=sp(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),up={utf8:Sl,"utf-8":Sl,hex:_l.base16,latin1:Vo,ascii:Vo,binary:Vo,..._l};function tt(t,e="utf8"){const r=up[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function ze(t,e="utf8"){const r=up[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const Jv={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Qv={};const Xv="ReactNative",Pt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},eE="js";function Fs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Gr(){return!dt.getDocument()&&!!dt.getNavigator()&&navigator.product===Xv}function tE(){return Gr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function rE(){return Gr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Gi(){return!Fs()&&!!dt.getNavigator()&&!!dt.getDocument()}function no(){return Gr()?Pt.reactNative:Fs()?Pt.node:Gi()?Pt.browser:Pt.unknown}function Ol(){var t;try{return Gr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function nE(t,e){const r=new URLSearchParams(t);for(const n of Object.keys(e).sort())if(e.hasOwnProperty(n)){const i=e[n];i!==void 0&&r.set(n,i)}return r.toString()}function iE(){return ip.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function sE(){if(no()===Pt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=K1();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function oE(){var t;const e=no();return e===Pt.browser?[e,((t=dt.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function lp(t,e,r){const n=sE(),i=oE();return[[t,e].join("-"),[eE,r].join("-"),n,i].join("/")}function aE({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=lp(t,e,n),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=nE(u[1]||"",h);return u[0]+"?"+d}function Ya(t){return Object.fromEntries(t.entries())}function Ja(t){return new Map(Object.entries(t))}function cE(t=M.FIVE_MINUTES,e){const r=M.toMiliseconds(t||M.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function yr(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function hp(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function uE(t){return hp("topic",t)}function lE(t){return hp("id",t)}function hE(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Oi(t,e){return M.fromMiliseconds(Date.now()+M.toMiliseconds(t))}function Al(t){return Date.now()>=M.toMiliseconds(t)}function Ko(t,e){return`${t}${e?`:${e}`:""}`}function Dl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function dp(){return typeof process<"u"&&Qv.IS_VITEST==="true"}function fp(t){return Buffer.from(t,"base64").toString("utf-8")}function dE(t){return new Promise(e=>setTimeout(e,t))}function Ti(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function fE(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Zi(t,...e){if(!fE(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ru(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ti(t.outputLen),Ti(t.blockLen)}function Cn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function pp(t,e){Zi(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ls=BigInt(2**32-1),xl=BigInt(32);function pE(t,e=!1){return e?{h:Number(t&ls),l:Number(t>>xl&ls)}:{h:Number(t>>xl&ls)|0,l:Number(t&ls)|0}}function gE(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=pE(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const yE=(t,e,r)=>t<<r|e>>>32-r,wE=(t,e,r)=>e<<r|t>>>32-r,mE=(t,e,r)=>e<<r-32|t>>>64-r,bE=(t,e,r)=>t<<r-32|e>>>64-r,Xr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function vE(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Wo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Nt(t,e){return t<<32-e|t>>>e}const Pl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function EE(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Cl(t){for(let e=0;e<t.length;e++)t[e]=EE(t[e])}function $E(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Tn(t){return typeof t=="string"&&(t=$E(t)),Zi(t),t}function IE(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Zi(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let nu=class{clone(){return this._cloneInto()}};function gp(t){const e=n=>t().update(Tn(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Jn(t=32){if(Xr&&typeof Xr.getRandomValues=="function")return Xr.getRandomValues(new Uint8Array(t));if(Xr&&typeof Xr.randomBytes=="function")return Xr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const yp=[],wp=[],mp=[],_E=BigInt(0),ui=BigInt(1),SE=BigInt(2),OE=BigInt(7),AE=BigInt(256),DE=BigInt(113);for(let t=0,e=ui,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],yp.push(2*(5*n+r)),wp.push((t+1)*(t+2)/2%64);let i=_E;for(let s=0;s<7;s++)e=(e<<ui^(e>>OE)*DE)%AE,e&SE&&(i^=ui<<(ui<<BigInt(s))-ui);mp.push(i)}const[xE,PE]=gE(mp,!0),Tl=(t,e,r)=>r>32?mE(t,e,r):yE(t,e,r),Nl=(t,e,r)=>r>32?bE(t,e,r):wE(t,e,r);function CE(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=Tl(u,l,1)^r[a],d=Nl(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=wp[o],c=Tl(i,s,a),u=Nl(i,s,a),l=yp[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=xE[n],t[1]^=PE[n]}r.fill(0)}let TE=class bp extends nu{constructor(e,r,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ti(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=vE(this.state)}keccak(){Pl||Cl(this.state32),CE(this.state32,this.rounds),Pl||Cl(this.state32),this.posOut=0,this.pos=0}update(e){Cn(this);const{blockLen:r,state:n}=this;e=Tn(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Cn(this,!1),Zi(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ti(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(pp(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new bp(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const NE=(t,e,r)=>gp(()=>new TE(e,t,r));NE(1,136,256/8);function Go(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function vp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ut(t,...e){if(!vp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Rl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function RE(t,e){ut(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Bl(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const mr=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),BE=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),UE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!UE)throw new Error("Non little-endian hardware is not supported");function LE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Qa(t){if(typeof t=="string")t=LE(t);else if(vp(t))t=Xa(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function jE(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function kE(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const qE=(t,e)=>{function r(n,...i){if(ut(n),t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?ut(u):ut(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&ut(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");ut(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,ut(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(ut(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Ul(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!FE(e))throw new Error("invalid output, must be aligned");return e}function Ll(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function FE(t){return t.byteOffset%4===0}function Xa(t){return Uint8Array.from(t)}function Nn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const Ep=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),ME=Ep("expand 16-byte k"),zE=Ep("expand 32-byte k"),HE=mr(ME),VE=mr(zE);function Q(t,e){return t<<e|t>>>32-e}function ec(t){return t.byteOffset%4===0}const hs=64,KE=16,$p=2**32-1,jl=new Uint32Array;function WE(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(hs),l=mr(u),h=ec(i)&&ec(s),d=h?mr(i):jl,p=h?mr(s):jl;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=$p)throw new Error("arx: counter overflow");const y=Math.min(hs,c-g);if(h&&y===hs){const f=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let v=0,b;v<KE;v++)b=f+v,p[b]=d[b]^l[v];g+=hs;continue}for(let f=0,v;f<y;f++)v=g+f,s[v]=i[v]^u[f];g+=y}}function GE(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=jE({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Go(i),Go(o),Bl(s),Bl(r),(a,c,u,l,h=0)=>{ut(a),ut(c),ut(u);const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),ut(l),Go(h),h<0||h>=$p)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const p=[];let g=a.length,y,f;if(g===32)p.push(y=Xa(a)),f=VE;else if(g===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),f=HE,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);ec(c)||p.push(c=Xa(c));const v=mr(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(f,v,mr(c.subarray(0,16)),v),c=c.subarray(16)}const b=16-i;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const x=new Uint8Array(12);x.set(c,s?0:12-c.length),c=x,p.push(c)}const E=mr(c);return WE(t,f,v,E,u,l,h,o),Nn(...p),l}}const Re=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let ZE=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Qa(e),ut(e,32);const r=Re(e,0),n=Re(e,2),i=Re(e,4),s=Re(e,6),o=Re(e,8),a=Re(e,10),c=Re(e,12),u=Re(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Re(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],p=o[6],g=o[7],y=o[8],f=o[9],v=Re(e,r+0),b=Re(e,r+2),E=Re(e,r+4),x=Re(e,r+6),T=Re(e,r+8),I=Re(e,r+10),O=Re(e,r+12),D=Re(e,r+14);let _=s[0]+(v&8191),B=s[1]+((v>>>13|b<<3)&8191),C=s[2]+((b>>>10|E<<6)&8191),R=s[3]+((E>>>7|x<<9)&8191),L=s[4]+((x>>>4|T<<12)&8191),$=s[5]+(T>>>1&8191),w=s[6]+((T>>>14|I<<2)&8191),m=s[7]+((I>>>11|O<<5)&8191),A=s[8]+((O>>>8|D<<8)&8191),P=s[9]+(D>>>5|i),S=0,N=S+_*a+B*(5*f)+C*(5*y)+R*(5*g)+L*(5*p);S=N>>>13,N&=8191,N+=$*(5*d)+w*(5*h)+m*(5*l)+A*(5*u)+P*(5*c),S+=N>>>13,N&=8191;let U=S+_*c+B*a+C*(5*f)+R*(5*y)+L*(5*g);S=U>>>13,U&=8191,U+=$*(5*p)+w*(5*d)+m*(5*h)+A*(5*l)+P*(5*u),S+=U>>>13,U&=8191;let j=S+_*u+B*c+C*a+R*(5*f)+L*(5*y);S=j>>>13,j&=8191,j+=$*(5*g)+w*(5*p)+m*(5*d)+A*(5*h)+P*(5*l),S+=j>>>13,j&=8191;let q=S+_*l+B*u+C*c+R*a+L*(5*f);S=q>>>13,q&=8191,q+=$*(5*y)+w*(5*g)+m*(5*p)+A*(5*d)+P*(5*h),S+=q>>>13,q&=8191;let k=S+_*h+B*l+C*u+R*c+L*a;S=k>>>13,k&=8191,k+=$*(5*f)+w*(5*y)+m*(5*g)+A*(5*p)+P*(5*d),S+=k>>>13,k&=8191;let z=S+_*d+B*h+C*l+R*u+L*c;S=z>>>13,z&=8191,z+=$*a+w*(5*f)+m*(5*y)+A*(5*g)+P*(5*p),S+=z>>>13,z&=8191;let H=S+_*p+B*d+C*h+R*l+L*u;S=H>>>13,H&=8191,H+=$*c+w*a+m*(5*f)+A*(5*y)+P*(5*g),S+=H>>>13,H&=8191;let G=S+_*g+B*p+C*d+R*h+L*l;S=G>>>13,G&=8191,G+=$*u+w*c+m*a+A*(5*f)+P*(5*y),S+=G>>>13,G&=8191;let K=S+_*y+B*g+C*p+R*d+L*h;S=K>>>13,K&=8191,K+=$*l+w*u+m*c+A*a+P*(5*f),S+=K>>>13,K&=8191;let V=S+_*f+B*y+C*g+R*p+L*d;S=V>>>13,V&=8191,V+=$*h+w*l+m*u+A*c+P*a,S+=V>>>13,V&=8191,S=(S<<2)+S|0,S=S+N|0,N=S&8191,S=S>>>13,U+=S,s[0]=N,s[1]=U,s[2]=j,s[3]=q,s[4]=k,s[5]=z,s[6]=H,s[7]=G,s[8]=K,s[9]=V}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Nn(n)}update(e){Rl(this);const{buffer:r,blockLen:n}=this;e=Qa(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Nn(this.h,this.r,this.buffer,this.pad)}digestInto(e){Rl(this),RE(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function YE(t){const e=(n,i)=>t(i).update(Qa(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const JE=YE(t=>new ZE(t));function QE(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],d=e[2],p=e[3],g=e[4],y=e[5],f=e[6],v=e[7],b=i,E=r[0],x=r[1],T=r[2],I=o,O=a,D=c,_=u,B=l,C=h,R=d,L=p,$=g,w=y,m=f,A=v,P=b,S=E,N=x,U=T;for(let q=0;q<s;q+=2)I=I+B|0,P=Q(P^I,16),$=$+P|0,B=Q(B^$,12),I=I+B|0,P=Q(P^I,8),$=$+P|0,B=Q(B^$,7),O=O+C|0,S=Q(S^O,16),w=w+S|0,C=Q(C^w,12),O=O+C|0,S=Q(S^O,8),w=w+S|0,C=Q(C^w,7),D=D+R|0,N=Q(N^D,16),m=m+N|0,R=Q(R^m,12),D=D+R|0,N=Q(N^D,8),m=m+N|0,R=Q(R^m,7),_=_+L|0,U=Q(U^_,16),A=A+U|0,L=Q(L^A,12),_=_+L|0,U=Q(U^_,8),A=A+U|0,L=Q(L^A,7),I=I+C|0,U=Q(U^I,16),m=m+U|0,C=Q(C^m,12),I=I+C|0,U=Q(U^I,8),m=m+U|0,C=Q(C^m,7),O=O+R|0,P=Q(P^O,16),A=A+P|0,R=Q(R^A,12),O=O+R|0,P=Q(P^O,8),A=A+P|0,R=Q(R^A,7),D=D+L|0,S=Q(S^D,16),$=$+S|0,L=Q(L^$,12),D=D+L|0,S=Q(S^D,8),$=$+S|0,L=Q(L^$,7),_=_+B|0,N=Q(N^_,16),w=w+N|0,B=Q(B^w,12),_=_+B|0,N=Q(N^_,8),w=w+N|0,B=Q(B^w,7);let j=0;n[j++]=o+I|0,n[j++]=a+O|0,n[j++]=c+D|0,n[j++]=u+_|0,n[j++]=l+B|0,n[j++]=h+C|0,n[j++]=d+R|0,n[j++]=p+L|0,n[j++]=g+$|0,n[j++]=y+w|0,n[j++]=f+m|0,n[j++]=v+A|0,n[j++]=b+P|0,n[j++]=E+S|0,n[j++]=x+N|0,n[j++]=T+U|0}const XE=GE(QE,{counterRight:!1,counterLength:4,allowShortKeys:!1}),e2=new Uint8Array(16),kl=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(e2.subarray(r))},t2=new Uint8Array(32);function ql(t,e,r,n,i){const s=t(e,r,t2),o=JE.create(s);i&&kl(o,i),kl(o,n);const a=new Uint8Array(16),c=BE(a);Ll(c,0,BigInt(i?i.length:0),!0),Ll(c,8,BigInt(n.length),!0),o.update(a);const u=o.digest();return Nn(s,a),u}const r2=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=Ul(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=ql(t,e,r,a,n);return s.set(c,o),Nn(c),s},decrypt(i,s){s=Ul(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=ql(t,e,r,o,n);if(!kE(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Nn(c),s}}),Ip=qE({blockSize:64,nonceLength:12,tagLength:16},r2(XE));let _p=class extends nu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,ru(e);const n=Tn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Cn(this),this.iHash.update(e),this}digestInto(e){Cn(this),Zi(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const io=(t,e,r)=>new _p(t,e).update(r).digest();io.create=(t,e)=>new _p(t,e);function n2(t,e,r){return ru(t),r===void 0&&(r=new Uint8Array(t.outputLen)),io(t,Tn(r),Tn(e))}const Zo=new Uint8Array([0]),Fl=new Uint8Array;function i2(t,e,r,n=32){if(ru(t),Ti(n),n>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/t.outputLen);r===void 0&&(r=Fl);const s=new Uint8Array(i*t.outputLen),o=io.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let u=0;u<i;u++)Zo[0]=u+1,a.update(u===0?Fl:c).update(r).update(Zo).digestInto(c),s.set(c,t.outputLen*u),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Zo.fill(0),s.slice(0,n)}const s2=(t,e,r,n,i)=>i2(t,n2(t,e,r),n,i);function o2(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function a2(t,e,r){return t&e^~t&r}function c2(t,e,r){return t&e^t&r^e&r}let u2=class extends nu{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Wo(this.buffer)}update(e){Cn(this);const{view:r,buffer:n,blockLen:i}=this;e=Tn(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Wo(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Cn(this),pp(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;o2(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Wo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const l2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),lr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),hr=new Uint32Array(64);let h2=class extends u2{constructor(){super(64,32,8,!1),this.A=lr[0]|0,this.B=lr[1]|0,this.C=lr[2]|0,this.D=lr[3]|0,this.E=lr[4]|0,this.F=lr[5]|0,this.G=lr[6]|0,this.H=lr[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)hr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=hr[h-15],p=hr[h-2],g=Nt(d,7)^Nt(d,18)^d>>>3,y=Nt(p,17)^Nt(p,19)^p>>>10;hr[h]=y+hr[h-7]+g+hr[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=Nt(a,6)^Nt(a,11)^Nt(a,25),p=l+d+a2(a,c,u)+l2[h]+hr[h]|0,g=(Nt(n,2)^Nt(n,13)^Nt(n,22))+c2(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){hr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Yi=gp(()=>new h2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const so=BigInt(0),oo=BigInt(1),d2=BigInt(2);function qr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ji(t){if(!qr(t))throw new Error("Uint8Array expected")}function Rn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const f2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Bn(t){Ji(t);let e="";for(let r=0;r<t.length;r++)e+=f2[t[r]];return e}function Sn(t){const e=t.toString(16);return e.length&1?"0"+e:e}function iu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?so:BigInt("0x"+t)}const Vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ml(t){if(t>=Vt._0&&t<=Vt._9)return t-Vt._0;if(t>=Vt.A&&t<=Vt.F)return t-(Vt.A-10);if(t>=Vt.a&&t<=Vt.f)return t-(Vt.a-10)}function Un(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Ml(t.charCodeAt(s)),a=Ml(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Rr(t){return iu(Bn(t))}function Ni(t){return Ji(t),iu(Bn(Uint8Array.from(t).reverse()))}function Ln(t,e){return Un(t.toString(16).padStart(e*2,"0"))}function ao(t,e){return Ln(t,e).reverse()}function p2(t){return Un(Sn(t))}function ot(t,e,r){let n;if(typeof e=="string")try{n=Un(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(qr(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Ri(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Ji(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}function g2(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function y2(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const Yo=t=>typeof t=="bigint"&&so<=t;function co(t,e,r){return Yo(t)&&Yo(e)&&Yo(r)&&e<=t&&t<r}function ir(t,e,r,n){if(!co(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Sp(t){let e;for(e=0;t>so;t>>=oo,e+=1);return e}function w2(t,e){return t>>BigInt(e)&oo}function m2(t,e,r){return t|(r?oo:so)<<BigInt(e)}const su=t=>(d2<<BigInt(t-1))-oo,Jo=t=>new Uint8Array(t),zl=t=>Uint8Array.from(t);function Op(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Jo(t),i=Jo(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...l)=>r(i,n,...l),c=(l=Jo())=>{i=a(zl([0]),l),n=a(),l.length!==0&&(i=a(zl([1]),l),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<e;){n=a();const d=n.slice();h.push(d),l+=n.length}return Ri(...h)};return(l,h)=>{o(),c(l);let d;for(;!(d=h(u()));)c();return o(),d}}const b2={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||qr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Qn(t,e,r={}){const n=(i,s,o)=>{const a=b2[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}const v2=()=>{throw new Error("not implemented")};function tc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}var E2=Object.freeze({__proto__:null,isBytes:qr,abytes:Ji,abool:Rn,bytesToHex:Bn,numberToHexUnpadded:Sn,hexToNumber:iu,hexToBytes:Un,bytesToNumberBE:Rr,bytesToNumberLE:Ni,numberToBytesBE:Ln,numberToBytesLE:ao,numberToVarBytesBE:p2,ensureBytes:ot,concatBytes:Ri,equalBytes:g2,utf8ToBytes:y2,inRange:co,aInRange:ir,bitLen:Sp,bitGet:w2,bitSet:m2,bitMask:su,createHmacDrbg:Op,validateObject:Qn,notImplemented:v2,memoized:tc});const Ce=BigInt(0),we=BigInt(1),Ar=BigInt(2),$2=BigInt(3),rc=BigInt(4),Hl=BigInt(5),Vl=BigInt(8);function Je(t,e){const r=t%e;return r>=Ce?r:e+r}function Ap(t,e,r){if(e<Ce)throw new Error("invalid exponent, negatives unsupported");if(r<=Ce)throw new Error("invalid modulus");if(r===we)return Ce;let n=we;for(;e>Ce;)e&we&&(n=n*t%r),t=t*t%r,e>>=we;return n}function At(t,e,r){let n=t;for(;e-- >Ce;)n*=n,n%=r;return n}function nc(t,e){if(t===Ce)throw new Error("invert: expected non-zero number");if(e<=Ce)throw new Error("invert: expected positive modulus, got "+e);let r=Je(t,e),n=e,i=Ce,s=we;for(;r!==Ce;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==we)throw new Error("invert: does not exist");return Je(i,e)}function I2(t){const e=(t-we)/Ar;let r,n,i;for(r=t-we,n=0;r%Ar===Ce;r/=Ar,n++);for(i=Ar;i<t&&Ap(i,e,t)!==t-we;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+we)/rc;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+we)/Ar;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let g=o.sqr(h);d<c&&!o.eql(g,o.ONE);d++)g=o.sqr(g);const p=o.pow(u,we<<BigInt(c-d-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=d}return l}}function _2(t){if(t%rc===$2){const e=(t+we)/rc;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%Vl===Hl){const e=(t-Hl)/Vl;return function(r,n){const i=r.mul(n,Ar),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Ar),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return I2(t)}const S2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function O2(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=S2.reduce((n,i)=>(n[i]="function",n),e);return Qn(t,r)}function A2(t,e,r){if(r<Ce)throw new Error("invalid exponent, negatives unsupported");if(r===Ce)return t.ONE;if(r===we)return e;let n=t.ONE,i=e;for(;r>Ce;)r&we&&(n=t.mul(n,i)),i=t.sqr(i),r>>=we;return n}function D2(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Dp(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function xp(t,e,r=!1,n={}){if(t<=Ce)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Dp(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:su(i),ZERO:Ce,ONE:we,create:c=>Je(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ce<=c&&c<t},is0:c=>c===Ce,isOdd:c=>(c&we)===we,neg:c=>Je(-c,t),eql:(c,u)=>c===u,sqr:c=>Je(c*c,t),add:(c,u)=>Je(c+u,t),sub:(c,u)=>Je(c-u,t),mul:(c,u)=>Je(c*u,t),pow:(c,u)=>A2(a,c,u),div:(c,u)=>Je(c*nc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>nc(c,t),sqrt:n.sqrt||(c=>(o||(o=_2(t)),o(a,c))),invertBatch:c=>D2(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?ao(c,s):Ln(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Ni(c):Rr(c)}});return Object.freeze(a)}function Pp(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Cp(t){const e=Pp(t);return e+Math.ceil(e/2)}function x2(t,e,r=!1){const n=t.length,i=Pp(e),s=Cp(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?Ni(t):Rr(t),a=Je(o,e-we)+we;return r?ao(a,i):Ln(a,i)}const Kl=BigInt(0),ds=BigInt(1);function Qo(t,e){const r=e.negate();return t?r:e}function Tp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Xo(t,e){Tp(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function P2(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function C2(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const ea=new WeakMap,Np=new WeakMap;function ta(t){return Np.get(t)||1}function T2(t,e){return{constTimeNegate:Qo,hasPrecomputes(r){return ta(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Kl;)n&ds&&(i=i.add(s)),s=s.double(),n>>=ds;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Xo(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Xo(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let d=0;d<s;d++){const p=d*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=ds);const y=p,f=p+Math.abs(g)-1,v=d%2!==0,b=g<0;g===0?c=c.add(Qo(v,n[y])):a=a.add(Qo(b,n[f]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Xo(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(i===Kl)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=ds),p===0)continue;let g=n[d+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=ea.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&ea.set(n,i(s))),s},wNAFCached(r,n,i){const s=ta(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=ta(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Tp(n,e),Np.set(r,n),ea.delete(r)}}}function N2(t,e,r,n){if(P2(r,t),C2(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Sp(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let d=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),d=d.add(g);if(l=l.add(d),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function Rp(t){return O2(t.Fp),Qn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Dp(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const en=BigInt(0),ra=BigInt(1);function R2(t){return Qn(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function B2(t){const e=R2(t),{P:r}=e,n=b=>Je(b,r),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(b=>b),c=e.powPminus2||(b=>Ap(b,r-BigInt(2),r));function u(b,E,x){const T=n(b*(E-x));return E=n(E-T),x=n(x+T),[E,x]}const l=(e.a-BigInt(2))/BigInt(4);function h(b,E){ir("u",b,en,r),ir("scalar",E,en,r);const x=E,T=b;let I=ra,O=en,D=b,_=ra,B=en,C;for(let L=BigInt(i-1);L>=en;L--){const $=x>>L&ra;B^=$,C=u(B,I,D),I=C[0],D=C[1],C=u(B,O,_),O=C[0],_=C[1],B=$;const w=I+O,m=n(w*w),A=I-O,P=n(A*A),S=m-P,N=D+_,U=D-_,j=n(U*w),q=n(N*A),k=j+q,z=j-q;D=n(k*k),_=n(T*n(z*z)),I=n(m*P),O=n(S*(m+n(l*S)))}C=u(B,I,D),I=C[0],D=C[1],C=u(B,O,_),O=C[0],_=C[1];const R=c(O);return n(I*R)}function d(b){return ao(n(b),s)}function p(b){const E=ot("u coordinate",b,s);return o===32&&(E[31]&=127),Ni(E)}function g(b){const E=ot("scalar",b),x=E.length;if(x!==s&&x!==o){let T=""+s+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+x)}return Ni(a(E))}function y(b,E){const x=p(E),T=g(b),I=h(x,T);if(I===en)throw new Error("invalid private or public key received");return d(I)}const f=d(e.Gu);function v(b){return y(b,f)}return{scalarMult:y,scalarMultBase:v,getSharedSecret:(b,E)=>y(b,E),getPublicKey:b=>v(b),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:f}}const ic=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const U2=BigInt(1),Wl=BigInt(2),L2=BigInt(3),j2=BigInt(5);BigInt(8);function k2(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=ic,o=t*t%s*t%s,a=At(o,Wl,s)*o%s,c=At(a,U2,s)*t%s,u=At(c,j2,s)*c%s,l=At(u,e,s)*u%s,h=At(l,r,s)*l%s,d=At(h,n,s)*h%s,p=At(d,i,s)*d%s,g=At(p,i,s)*d%s,y=At(g,e,s)*u%s;return{pow_p_5_8:At(y,Wl,s)*t%s,b2:o}}function q2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const sc=B2({P:ic,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=ic,{pow_p_5_8:r,b2:n}=k2(t);return Je(At(r,L2,e)*n,e)},adjustScalarBytes:q2,randomBytes:Jn});function Gl(t){t.lowS!==void 0&&Rn("lowS",t.lowS),t.prehash!==void 0&&Rn("prehash",t.prehash)}function F2(t){const e=Rp(t);Qn(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:M2,hexToBytes:z2}=E2;let H2=class extends Error{constructor(e=""){super(e)}};const Qt={Err:H2,_tlv:{encode:(t,e)=>{const{Err:r}=Qt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Sn(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Sn(i.length/2|128):"";return Sn(t)+s+i+e},decode(t,e){const{Err:r}=Qt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Qt;if(t<tr)throw new e("integer: negative integers are not allowed");let r=Sn(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Qt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return M2(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Qt,i=typeof t=="string"?z2(t):t;Ji(i);const{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Qt,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},tr=BigInt(0),Se=BigInt(1);BigInt(2);const Zl=BigInt(3);BigInt(4);function V2(t){const e=F2(t),{Fp:r}=e,n=xp(e.n,e.nBitLength),i=e.toBytes||((y,f,v)=>{const b=f.toAffine();return Ri(Uint8Array.from([4]),r.toBytes(b.x),r.toBytes(b.y))}),s=e.fromBytes||(y=>{const f=y.subarray(1),v=r.fromBytes(f.subarray(0,r.BYTES)),b=r.fromBytes(f.subarray(r.BYTES,2*r.BYTES));return{x:v,y:b}});function o(y){const{a:f,b:v}=e,b=r.sqr(y),E=r.mul(b,y);return r.add(r.add(E,r.mul(y,f)),v)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return co(y,Se,e.n)}function c(y){const{allowedPrivateKeyLengths:f,nByteLength:v,wrapPrivateKey:b,n:E}=e;if(f&&typeof y!="bigint"){if(qr(y)&&(y=Bn(y)),typeof y!="string"||!f.includes(y.length))throw new Error("invalid private key");y=y.padStart(v*2,"0")}let x;try{x=typeof y=="bigint"?y:Rr(ot("private key",y,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof y)}return b&&(x=Je(x,E)),ir("private key",x,Se,E),x}function u(y){if(!(y instanceof d))throw new Error("ProjectivePoint expected")}const l=tc((y,f)=>{const{px:v,py:b,pz:E}=y;if(r.eql(E,r.ONE))return{x:v,y:b};const x=y.is0();f==null&&(f=x?r.ONE:r.inv(E));const T=r.mul(v,f),I=r.mul(b,f),O=r.mul(E,f);if(x)return{x:r.ZERO,y:r.ZERO};if(!r.eql(O,r.ONE))throw new Error("invZ was invalid");return{x:T,y:I}}),h=tc(y=>{if(y.is0()){if(e.allowInfinityPoint&&!r.is0(y.py))return;throw new Error("bad point: ZERO")}const{x:f,y:v}=y.toAffine();if(!r.isValid(f)||!r.isValid(v))throw new Error("bad point: x or y not FE");const b=r.sqr(v),E=o(f);if(!r.eql(b,E))throw new Error("bad point: equation left != right");if(!y.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(f,v,b){if(this.px=f,this.py=v,this.pz=b,f==null||!r.isValid(f))throw new Error("x required");if(v==null||!r.isValid(v))throw new Error("y required");if(b==null||!r.isValid(b))throw new Error("z required");Object.freeze(this)}static fromAffine(f){const{x:v,y:b}=f||{};if(!f||!r.isValid(v)||!r.isValid(b))throw new Error("invalid affine point");if(f instanceof d)throw new Error("projective point not allowed");const E=x=>r.eql(x,r.ZERO);return E(v)&&E(b)?d.ZERO:new d(v,b,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){const v=r.invertBatch(f.map(b=>b.pz));return f.map((b,E)=>b.toAffine(v[E])).map(d.fromAffine)}static fromHex(f){const v=d.fromAffine(s(ot("pointHex",f)));return v.assertValidity(),v}static fromPrivateKey(f){return d.BASE.multiply(c(f))}static msm(f,v){return N2(d,n,f,v)}_setWindowSize(f){g.setWindowSize(this,f)}assertValidity(){h(this)}hasEvenY(){const{y:f}=this.toAffine();if(r.isOdd)return!r.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){u(f);const{px:v,py:b,pz:E}=this,{px:x,py:T,pz:I}=f,O=r.eql(r.mul(v,I),r.mul(x,E)),D=r.eql(r.mul(b,I),r.mul(T,E));return O&&D}negate(){return new d(this.px,r.neg(this.py),this.pz)}double(){const{a:f,b:v}=e,b=r.mul(v,Zl),{px:E,py:x,pz:T}=this;let I=r.ZERO,O=r.ZERO,D=r.ZERO,_=r.mul(E,E),B=r.mul(x,x),C=r.mul(T,T),R=r.mul(E,x);return R=r.add(R,R),D=r.mul(E,T),D=r.add(D,D),I=r.mul(f,D),O=r.mul(b,C),O=r.add(I,O),I=r.sub(B,O),O=r.add(B,O),O=r.mul(I,O),I=r.mul(R,I),D=r.mul(b,D),C=r.mul(f,C),R=r.sub(_,C),R=r.mul(f,R),R=r.add(R,D),D=r.add(_,_),_=r.add(D,_),_=r.add(_,C),_=r.mul(_,R),O=r.add(O,_),C=r.mul(x,T),C=r.add(C,C),_=r.mul(C,R),I=r.sub(I,_),D=r.mul(C,B),D=r.add(D,D),D=r.add(D,D),new d(I,O,D)}add(f){u(f);const{px:v,py:b,pz:E}=this,{px:x,py:T,pz:I}=f;let O=r.ZERO,D=r.ZERO,_=r.ZERO;const B=e.a,C=r.mul(e.b,Zl);let R=r.mul(v,x),L=r.mul(b,T),$=r.mul(E,I),w=r.add(v,b),m=r.add(x,T);w=r.mul(w,m),m=r.add(R,L),w=r.sub(w,m),m=r.add(v,E);let A=r.add(x,I);return m=r.mul(m,A),A=r.add(R,$),m=r.sub(m,A),A=r.add(b,E),O=r.add(T,I),A=r.mul(A,O),O=r.add(L,$),A=r.sub(A,O),_=r.mul(B,m),O=r.mul(C,$),_=r.add(O,_),O=r.sub(L,_),_=r.add(L,_),D=r.mul(O,_),L=r.add(R,R),L=r.add(L,R),$=r.mul(B,$),m=r.mul(C,m),L=r.add(L,$),$=r.sub(R,$),$=r.mul(B,$),m=r.add(m,$),R=r.mul(L,m),D=r.add(D,R),R=r.mul(A,m),O=r.mul(w,O),O=r.sub(O,R),R=r.mul(w,L),_=r.mul(A,_),_=r.add(_,R),new d(O,D,_)}subtract(f){return this.add(f.negate())}is0(){return this.equals(d.ZERO)}wNAF(f){return g.wNAFCached(this,f,d.normalizeZ)}multiplyUnsafe(f){const{endo:v,n:b}=e;ir("scalar",f,tr,b);const E=d.ZERO;if(f===tr)return E;if(this.is0()||f===Se)return this;if(!v||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,f,d.normalizeZ);let{k1neg:x,k1:T,k2neg:I,k2:O}=v.splitScalar(f),D=E,_=E,B=this;for(;T>tr||O>tr;)T&Se&&(D=D.add(B)),O&Se&&(_=_.add(B)),B=B.double(),T>>=Se,O>>=Se;return x&&(D=D.negate()),I&&(_=_.negate()),_=new d(r.mul(_.px,v.beta),_.py,_.pz),D.add(_)}multiply(f){const{endo:v,n:b}=e;ir("scalar",f,Se,b);let E,x;if(v){const{k1neg:T,k1:I,k2neg:O,k2:D}=v.splitScalar(f);let{p:_,f:B}=this.wNAF(I),{p:C,f:R}=this.wNAF(D);_=g.constTimeNegate(T,_),C=g.constTimeNegate(O,C),C=new d(r.mul(C.px,v.beta),C.py,C.pz),E=_.add(C),x=B.add(R)}else{const{p:T,f:I}=this.wNAF(f);E=T,x=I}return d.normalizeZ([E,x])[0]}multiplyAndAddUnsafe(f,v,b){const E=d.BASE,x=(I,O)=>O===tr||O===Se||!I.equals(E)?I.multiplyUnsafe(O):I.multiply(O),T=x(this,v).add(x(f,b));return T.is0()?void 0:T}toAffine(f){return l(this,f)}isTorsionFree(){const{h:f,isTorsionFree:v}=e;if(f===Se)return!0;if(v)return v(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:f,clearCofactor:v}=e;return f===Se?this:v?v(d,this):this.multiplyUnsafe(e.h)}toRawBytes(f=!0){return Rn("isCompressed",f),this.assertValidity(),i(d,this,f)}toHex(f=!0){return Rn("isCompressed",f),Bn(this.toRawBytes(f))}}d.BASE=new d(e.Gx,e.Gy,r.ONE),d.ZERO=new d(r.ZERO,r.ONE,r.ZERO);const p=e.nBitLength,g=T2(d,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function K2(t){const e=Rp(t);return Qn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function W2(t){const e=K2(t),{Fp:r,n}=e,i=r.BYTES+1,s=2*r.BYTES+1;function o($){return Je($,n)}function a($){return nc($,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=V2({...e,toBytes($,w,m){const A=w.toAffine(),P=r.toBytes(A.x),S=Ri;return Rn("isCompressed",m),m?S(Uint8Array.from([w.hasEvenY()?2:3]),P):S(Uint8Array.from([4]),P,r.toBytes(A.y))},fromBytes($){const w=$.length,m=$[0],A=$.subarray(1);if(w===i&&(m===2||m===3)){const P=Rr(A);if(!co(P,Se,r.ORDER))throw new Error("Point is not on curve");const S=l(P);let N;try{N=r.sqrt(S)}catch(j){const q=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+q)}const U=(N&Se)===Se;return(m&1)===1!==U&&(N=r.neg(N)),{x:P,y:N}}else if(w===s&&m===4){const P=r.fromBytes(A.subarray(0,r.BYTES)),S=r.fromBytes(A.subarray(r.BYTES,2*r.BYTES));return{x:P,y:S}}else{const P=i,S=s;throw new Error("invalid Point, expected length of "+P+", or uncompressed "+S+", got "+w)}}}),d=$=>Bn(Ln($,e.nByteLength));function p($){const w=n>>Se;return $>w}function g($){return p($)?o(-$):$}const y=($,w,m)=>Rr($.slice(w,m));class f{constructor(w,m,A){this.r=w,this.s=m,this.recovery=A,this.assertValidity()}static fromCompact(w){const m=e.nByteLength;return w=ot("compactSignature",w,m*2),new f(y(w,0,m),y(w,m,2*m))}static fromDER(w){const{r:m,s:A}=Qt.toSig(ot("DER",w));return new f(m,A)}assertValidity(){ir("r",this.r,Se,n),ir("s",this.s,Se,n)}addRecoveryBit(w){return new f(this.r,this.s,w)}recoverPublicKey(w){const{r:m,s:A,recovery:P}=this,S=I(ot("msgHash",w));if(P==null||![0,1,2,3].includes(P))throw new Error("recovery id invalid");const N=P===2||P===3?m+e.n:m;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=(P&1)===0?"02":"03",j=c.fromHex(U+d(N)),q=a(N),k=o(-S*q),z=o(A*q),H=c.BASE.multiplyAndAddUnsafe(j,k,z);if(!H)throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new f(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Un(this.toDERHex())}toDERHex(){return Qt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Un(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const v={isValidPrivateKey($){try{return u($),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const $=Cp(e.n);return x2(e.randomBytes($),e.n)},precompute($=8,w=c.BASE){return w._setWindowSize($),w.multiply(BigInt(3)),w}};function b($,w=!0){return c.fromPrivateKey($).toRawBytes(w)}function E($){const w=qr($),m=typeof $=="string",A=(w||m)&&$.length;return w?A===i||A===s:m?A===2*i||A===2*s:$ instanceof c}function x($,w,m=!0){if(E($))throw new Error("first arg must be private key");if(!E(w))throw new Error("second arg must be public key");return c.fromHex(w).multiply(u($)).toRawBytes(m)}const T=e.bits2int||function($){if($.length>8192)throw new Error("input is too large");const w=Rr($),m=$.length*8-e.nBitLength;return m>0?w>>BigInt(m):w},I=e.bits2int_modN||function($){return o(T($))},O=su(e.nBitLength);function D($){return ir("num < 2^"+e.nBitLength,$,tr,O),Ln($,e.nByteLength)}function _($,w,m=B){if(["recovered","canonical"].some(K=>K in m))throw new Error("sign() legacy options not supported");const{hash:A,randomBytes:P}=e;let{lowS:S,prehash:N,extraEntropy:U}=m;S==null&&(S=!0),$=ot("msgHash",$),Gl(m),N&&($=ot("prehashed msgHash",A($)));const j=I($),q=u(w),k=[D(q),D(j)];if(U!=null&&U!==!1){const K=U===!0?P(r.BYTES):U;k.push(ot("extraEntropy",K))}const z=Ri(...k),H=j;function G(K){const V=T(K);if(!h(V))return;const fe=a(V),se=c.BASE.multiply(V).toAffine(),ne=o(se.x);if(ne===tr)return;const oe=o(fe*o(H+ne*q));if(oe===tr)return;let pe=(se.x===ne?0:2)|Number(se.y&Se),gt=oe;return S&&p(oe)&&(gt=g(oe),pe^=1),new f(ne,gt,pe)}return{seed:z,k2sig:G}}const B={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function R($,w,m=B){const{seed:A,k2sig:P}=_($,w,m),S=e;return Op(S.hash.outputLen,S.nByteLength,S.hmac)(A,P)}c.BASE._setWindowSize(8);function L($,w,m,A=C){var oe;const P=$;w=ot("msgHash",w),m=ot("publicKey",m);const{lowS:S,prehash:N,format:U}=A;if(Gl(A),"strict"in A)throw new Error("options.strict was renamed to lowS");if(U!==void 0&&U!=="compact"&&U!=="der")throw new Error("format must be compact or der");const j=typeof P=="string"||qr(P),q=!j&&!U&&typeof P=="object"&&P!==null&&typeof P.r=="bigint"&&typeof P.s=="bigint";if(!j&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let k,z;try{if(q&&(k=new f(P.r,P.s)),j){try{U!=="compact"&&(k=f.fromDER(P))}catch(pe){if(!(pe instanceof Qt.Err))throw pe}!k&&U!=="der"&&(k=f.fromCompact(P))}z=c.fromHex(m)}catch{return!1}if(!k||S&&k.hasHighS())return!1;N&&(w=e.hash(w));const{r:H,s:G}=k,K=I(w),V=a(G),fe=o(K*V),se=o(H*V),ne=(oe=c.BASE.multiplyAndAddUnsafe(z,fe,se))==null?void 0:oe.toAffine();return ne?o(ne.x)===H:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:x,sign:R,verify:L,ProjectivePoint:c,Signature:f,utils:v}}function G2(t){return{hash:t,hmac:(e,...r)=>io(t,e,IE(...r)),randomBytes:Jn}}function Z2(t,e){const r=n=>W2({...t,...G2(n)});return{...r(e),create:r}}const Bp=xp(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),Y2=Bp.create(BigInt("-3")),J2=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Q2=Z2({a:Y2,b:J2,Fp:Bp,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},Yi),Up="base10",Ve="base16",Br="base64pad",ou="base64url",Qi="utf8",Lp=0,Xn=1,uo=2,X2=0,Yl=1,Ai=12,au=32;function e$(){const t=sc.utils.randomPrivateKey(),e=sc.getPublicKey(t);return{privateKey:ze(t,Ve),publicKey:ze(e,Ve)}}function oc(){const t=Jn(au);return ze(t,Ve)}function t$(t,e){const r=sc.getSharedSecret(tt(t,Ve),tt(e,Ve)),n=s2(Yi,r,void 0,void 0,au);return ze(n,Ve)}function r$(t){const e=Yi(tt(t,Ve));return ze(e,Ve)}function Ts(t){const e=Yi(tt(t,Qi));return ze(e,Ve)}function jp(t){return tt(`${t}`,Up)}function Fr(t){return Number(ze(t,Up))}function kp(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function qp(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function n$(t){const e=jp(typeof t.type<"u"?t.type:Lp);if(Fr(e)===Xn&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?tt(t.senderPublicKey,Ve):void 0,n=typeof t.iv<"u"?tt(t.iv,Ve):Jn(Ai),i=tt(t.symKey,Ve),s=Ip(i,n).encrypt(tt(t.message,Qi)),o=Fp({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===ou?kp(o):o}function i$(t){const e=tt(t.symKey,Ve),{sealed:r,iv:n}=Bi({encoded:t.encoded,encoding:t.encoding}),i=Ip(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return ze(i,Qi)}function s$(t,e){const r=jp(uo),n=Jn(Ai),i=tt(t,Qi),s=Fp({type:r,sealed:i,iv:n});return e===ou?kp(s):s}function o$(t,e){const{sealed:r}=Bi({encoded:t,encoding:e});return ze(r,Qi)}function Fp(t){if(Fr(t.type)===uo)return ze(Si([t.type,t.sealed]),Br);if(Fr(t.type)===Xn){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ze(Si([t.type,t.senderPublicKey,t.iv,t.sealed]),Br)}return ze(Si([t.type,t.iv,t.sealed]),Br)}function Bi(t){const e=(t.encoding||Br)===ou?qp(t.encoded):t.encoded,r=tt(e,Br),n=r.slice(X2,Yl),i=Yl;if(Fr(n)===Xn){const c=i+au,u=c+Ai,l=r.slice(i,c),h=r.slice(c,u),d=r.slice(u);return{type:n,sealed:d,iv:h,senderPublicKey:l}}if(Fr(n)===uo){const c=r.slice(i),u=Jn(Ai);return{type:n,sealed:c,iv:u}}const s=i+Ai,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function a$(t,e){const r=Bi({encoded:t,encoding:e==null?void 0:e.encoding});return Mp({type:Fr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ze(r.senderPublicKey,Ve):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Mp(t){const e=(t==null?void 0:t.type)||Lp;if(e===Xn){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Jl(t){return t.type===Xn&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Ql(t){return t.type===uo}function c$(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return Si([new Uint8Array([4]),e,r])}function u$(t,e){const[r,n,i]=t.split("."),s=Buffer.from(qp(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,u=Yi(c),l=c$(e);if(!Q2.verify(Si([o,a]),u,l))throw new Error("Invalid signature");return Za(t).payload}const l$="irn";function Ms(t){return(t==null?void 0:t.relay)||{protocol:l$}}function Ei(t){const e=Jv[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function h$(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function Xl(t){if(!t.includes("wc:")){const u=fp(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a={};o.forEach((u,l)=>{a[l]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:d$(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:h$(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function d$(t){return t.startsWith("//")?t.substring(2):t}function f$(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function eh(t){const e=new URLSearchParams,r=f$(t.relay);Object.keys(r).sort().forEach(i=>{e.set(i,r[i])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const n=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${n}`}const p$={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},g$={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ie(t,e){const{message:r,code:n}=g$[t];return{message:e?`${r} ${e}`:r,code:n}}function $i(t,e){const{message:r,code:n}=p$[t];return{message:e?`${r} ${e}`:r,code:n}}function ac(t){return typeof t>"u"}function zp(t,e){return typeof t=="string"&&!!t.trim().length}function y$(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(zp(t,!1)){if(e(t))return!0;const r=fp(t);return e(r)}}catch{}return!1}function w$(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function m$(t){return t==null?void 0:t.topic}function na(t){return typeof t<"u"&&typeof t!==null}function th(){const t=no();return new Promise(e=>{switch(t){case Pt.browser:e(b$());break;case Pt.reactNative:e(v$());break;case Pt.node:e(E$());break;default:e(!0)}})}function b$(){return Gi()&&(navigator==null?void 0:navigator.onLine)}async function v$(){if(Gr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function E$(){return!0}function $$(t){switch(no()){case Pt.browser:I$(t);break;case Pt.reactNative:_$(t);break}}function I$(t){!Gr()&&Gi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function _$(t){Gr()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function S$(){var t;return Gi()&&dt.getDocument()?((t=dt.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const O$="PARSE_ERROR",A$="INVALID_REQUEST",D$="METHOD_NOT_FOUND",x$="INVALID_PARAMS",Hp="INTERNAL_ERROR",cu="SERVER_ERROR",P$=[-32700,-32600,-32601,-32602,-32603],Di={[O$]:{code:-32700,message:"Parse error"},[A$]:{code:-32600,message:"Invalid Request"},[D$]:{code:-32601,message:"Method not found"},[x$]:{code:-32602,message:"Invalid params"},[Hp]:{code:-32603,message:"Internal error"},[cu]:{code:-32e3,message:"Server error"}},Vp=cu;function C$(t){return P$.includes(t)}function rh(t){return Object.keys(Di).includes(t)?Di[t]:Di[Vp]}function T$(t){const e=Object.values(Di).find(r=>r.code===t);return e||Di[Vp]}function Kp(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var ia={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var cc=function(t,e){return cc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},cc(t,e)};function N$(t,e){cc(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var uc=function(){return uc=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},uc.apply(this,arguments)};function R$(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function B$(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function U$(t,e){return function(r,n){e(r,n,t)}}function L$(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function j$(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function k$(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function q$(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function F$(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function lc(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Wp(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function M$(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Wp(arguments[e]));return t}function z$(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Ui(t){return this instanceof Ui?(this.v=t,this):new Ui(t)}function H$(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){n[d]&&(i[d]=function(p){return new Promise(function(g,y){s.push([d,p,g,y])>1||a(d,p)})})}function a(d,p){try{c(n[d](p))}catch(g){h(s[0][3],g)}}function c(d){d.value instanceof Ui?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,p){d(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function V$(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Ui(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function K$(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof lc=="function"?lc(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function W$(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function G$(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Z$(t){return t&&t.__esModule?t:{default:t}}function Y$(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function J$(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const Q$=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return uc},__asyncDelegator:V$,__asyncGenerator:H$,__asyncValues:K$,__await:Ui,__awaiter:j$,__classPrivateFieldGet:Y$,__classPrivateFieldSet:J$,__createBinding:q$,__decorate:B$,__exportStar:F$,__extends:N$,__generator:k$,__importDefault:Z$,__importStar:G$,__makeTemplateObject:W$,__metadata:L$,__param:U$,__read:Wp,__rest:R$,__spread:M$,__spreadArrays:z$,__values:lc},Symbol.toStringTag,{value:"Module"})),X$=$f(Q$);var Kt={},nh;function eI(){if(nh)return Kt;nh=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.isBrowserCryptoAvailable=Kt.getSubtleCrypto=Kt.getBrowerCrypto=void 0;function t(){return(Ft===null||Ft===void 0?void 0:Ft.crypto)||(Ft===null||Ft===void 0?void 0:Ft.msCrypto)||{}}Kt.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}Kt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Kt.isBrowserCryptoAvailable=r,Kt}var Wt={},ih;function tI(){if(ih)return Wt;ih=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.isBrowser=Wt.isNode=Wt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Wt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Wt.isNode=e;function r(){return!t()&&!e()}return Wt.isBrowser=r,Wt}var sh;function rI(){return sh||(sh=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=X$;e.__exportStar(eI(),t),e.__exportStar(tI(),t)})(ia)),ia}var nI=rI();function kt(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Tr(t=6){return BigInt(kt(t))}function wr(t,e,r){return{id:r||kt(),jsonrpc:"2.0",method:t,params:e}}function lo(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ho(t,e,r){return{id:t,jsonrpc:"2.0",error:iI(e)}}function iI(t,e){return typeof t>"u"?rh(Hp):(typeof t=="string"&&(t=Object.assign(Object.assign({},rh(cu)),{message:t})),C$(t.code)&&(t=T$(t.code)),t)}class sI{}class oI extends sI{constructor(){super()}}class aI extends oI{constructor(e){super()}}const cI="^https?:",uI="^wss?:";function lI(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Gp(t,e){const r=lI(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function oh(t){return Gp(t,cI)}function ah(t){return Gp(t,uI)}function hI(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Zp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function uu(t){return Zp(t)&&"method"in t}function fo(t){return Zp(t)&&(qt(t)||bt(t))}function qt(t){return"result"in t}function bt(t){return"error"in t}let vt=class extends aI{constructor(e){super(e),this.events=new pt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(wr(e.method,e.params||[],e.id||Tr().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{bt(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),fo(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const dI=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),fI=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ch=t=>t.split("?")[0],uh=10,pI=dI();let gI=class{constructor(e){if(this.url=e,this.events=new pt.EventEmitter,this.registering=!1,!ah(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ar(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!ah(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=nI.isReactNative()?void 0:{rejectUnauthorized:!hI(e)},s=new pI(e,[],i);fI()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?kr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=ho(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return Kp(e,ch(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>uh&&this.events.setMaxListeners(uh)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${ch(this.url)}`));return this.events.emit("register_error",r),r}};var yI={};const Yp="wc",Jp=2,hc="core",Mt=`${Yp}@2:${hc}:`,wI={logger:"error"},mI={database:":memory:"},bI="crypto",lh="client_ed25519_seed",vI=M.ONE_DAY,EI="keychain",$I="0.3",II="messages",_I="0.3",hh=M.SIX_HOURS,SI="publisher",Qp="irn",OI="error",Xp="wss://relay.walletconnect.org",AI="relayer",xe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},DI="_subscription",yt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},xI=.1,dc="2.21.1",de={link_mode:"link_mode",relay:"relay"},Ns={inbound:"inbound",outbound:"outbound"},PI="0.3",CI="WALLETCONNECT_CLIENT_ID",dh="WALLETCONNECT_LINK_MODE_APPS",st={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},TI="subscription",NI="0.3",RI="pairing",BI="0.3",li={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},Dr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},It={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},UI="history",LI="0.3",jI="expirer",mt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},kI="0.3",qI="verify-api",FI="https://verify.walletconnect.com",eg="https://verify.walletconnect.org",xi=eg,MI=`${xi}/v3`,zI=[FI,eg],HI="echo",VI="https://echo.walletconnect.com",jt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Jt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},_t={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ir={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},_r={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},hi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},KI=.1,WI="event-client",GI=86400,ZI="https://pulse.walletconnect.org/batch";function YI(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var y=0,f=0,v=0,b=g.length;v!==b&&g[v]===0;)v++,y++;for(var E=(b-v)*l+1>>>0,x=new Uint8Array(E);v!==b;){for(var T=g[v],I=0,O=E-1;(T!==0||I<f)&&O!==-1;O--,I++)T+=256*x[O]>>>0,x[O]=T%a>>>0,T=T/a>>>0;if(T!==0)throw new Error("Non-zero carry");f=I,v++}for(var D=E-f;D!==E&&x[D]===0;)D++;for(var _=c.repeat(y);D<E;++D)_+=t.charAt(x[D]);return _}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var y=0;if(g[y]!==" "){for(var f=0,v=0;g[y]===c;)f++,y++;for(var b=(g.length-y)*u+1>>>0,E=new Uint8Array(b);g[y];){var x=r[g.charCodeAt(y)];if(x===255)return;for(var T=0,I=b-1;(x!==0||T<v)&&I!==-1;I--,T++)x+=a*E[I]>>>0,E[I]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");v=T,y++}if(g[y]!==" "){for(var O=b-v;O!==b&&E[O]===0;)O++;for(var D=new Uint8Array(f+(b-O)),_=f;O!==b;)D[_++]=E[O++];return D}}}function p(g){var y=d(g);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var JI=YI,QI=JI;const tg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},XI=t=>new TextEncoder().encode(t),e_=t=>new TextDecoder().decode(t);let t_=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},r_=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return rg(this,e)}},n_=class{constructor(e){this.decoders=e}or(e){return rg(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const rg=(t,e)=>new n_({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let i_=class{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new t_(e,r,n),this.decoder=new r_(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const po=({name:t,prefix:e,encode:r,decode:n})=>new i_(t,e,r,n),Xi=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=QI(r,e);return po({prefix:t,name:e,encode:n,decode:s=>tg(i(s))})},s_=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},o_=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},Fe=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>po({prefix:e,name:t,encode(i){return o_(i,n,r)},decode(i){return s_(i,n,r,t)}}),a_=po({prefix:"\0",name:"identity",encode:t=>e_(t),decode:t=>XI(t)});var c_=Object.freeze({__proto__:null,identity:a_});const u_=Fe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var l_=Object.freeze({__proto__:null,base2:u_});const h_=Fe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var d_=Object.freeze({__proto__:null,base8:h_});const f_=Xi({prefix:"9",name:"base10",alphabet:"0123456789"});var p_=Object.freeze({__proto__:null,base10:f_});const g_=Fe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),y_=Fe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var w_=Object.freeze({__proto__:null,base16:g_,base16upper:y_});const m_=Fe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),b_=Fe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),v_=Fe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),E_=Fe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$_=Fe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),I_=Fe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),__=Fe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),S_=Fe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),O_=Fe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var A_=Object.freeze({__proto__:null,base32:m_,base32upper:b_,base32pad:v_,base32padupper:E_,base32hex:$_,base32hexupper:I_,base32hexpad:__,base32hexpadupper:S_,base32z:O_});const D_=Xi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),x_=Xi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var P_=Object.freeze({__proto__:null,base36:D_,base36upper:x_});const C_=Xi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),T_=Xi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var N_=Object.freeze({__proto__:null,base58btc:C_,base58flickr:T_});const R_=Fe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),B_=Fe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),U_=Fe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),L_=Fe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var j_=Object.freeze({__proto__:null,base64:R_,base64pad:B_,base64url:U_,base64urlpad:L_});const ng=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),k_=ng.reduce((t,e,r)=>(t[r]=e,t),[]),q_=ng.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function F_(t){return t.reduce((e,r)=>(e+=k_[r],e),"")}function M_(t){const e=[];for(const r of t){const n=q_[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const z_=po({prefix:"🚀",name:"base256emoji",encode:F_,decode:M_});var H_=Object.freeze({__proto__:null,base256emoji:z_}),V_=ig,fh=128,K_=-128,W_=Math.pow(2,31);function ig(t,e,r){e=e||[],r=r||0;for(var n=r;t>=W_;)e[r++]=t&255|fh,t/=128;for(;t&K_;)e[r++]=t&255|fh,t>>>=7;return e[r]=t|0,ig.bytes=r-n+1,e}var G_=fc,Z_=128,ph=127;function fc(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw fc.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&ph)<<i:(o&ph)*Math.pow(2,i),i+=7}while(o>=Z_);return fc.bytes=s-n,r}var Y_=Math.pow(2,7),J_=Math.pow(2,14),Q_=Math.pow(2,21),X_=Math.pow(2,28),e3=Math.pow(2,35),t3=Math.pow(2,42),r3=Math.pow(2,49),n3=Math.pow(2,56),i3=Math.pow(2,63),s3=function(t){return t<Y_?1:t<J_?2:t<Q_?3:t<X_?4:t<e3?5:t<t3?6:t<r3?7:t<n3?8:t<i3?9:10},o3={encode:V_,decode:G_,encodingLength:s3},sg=o3;const gh=(t,e,r=0)=>(sg.encode(t,e,r),e),yh=t=>sg.encodingLength(t),pc=(t,e)=>{const r=e.byteLength,n=yh(t),i=n+yh(r),s=new Uint8Array(i+r);return gh(t,s,0),gh(r,s,n),s.set(e,i),new a3(t,r,e,s)};let a3=class{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}};const og=({name:t,code:e,encode:r})=>new c3(t,e,r);class c3{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?pc(this.code,r):r.then(n=>pc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const ag=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),u3=og({name:"sha2-256",code:18,encode:ag("SHA-256")}),l3=og({name:"sha2-512",code:19,encode:ag("SHA-512")});var h3=Object.freeze({__proto__:null,sha256:u3,sha512:l3});const cg=0,d3="identity",ug=tg,f3=t=>pc(cg,ug(t)),p3={code:cg,name:d3,encode:ug,digest:f3};var g3=Object.freeze({__proto__:null,identity:p3});new TextEncoder,new TextDecoder;const wh={...c_,...l_,...d_,...p_,...w_,...A_,...P_,...N_,...j_,...H_};({...h3,...g3});function y3(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function lg(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const mh=lg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),sa=lg("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=y3(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),w3={utf8:mh,"utf-8":mh,hex:wh.base16,latin1:sa,ascii:sa,binary:sa,...wh};function m3(t,e="utf8"){const r=w3[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}var b3=Object.defineProperty,v3=(t,e,r)=>e in t?b3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rt=(t,e,r)=>v3(t,typeof e!="symbol"?e+"":e,r);let E3=class{constructor(e,r){this.core=e,this.logger=r,Rt(this,"keychain",new Map),Rt(this,"name",EI),Rt(this,"version",$I),Rt(this,"initialized",!1),Rt(this,"storagePrefix",Mt),Rt(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),Rt(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),Rt(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),Rt(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=ie("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),Rt(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Ke(r,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ya(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ja(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};var $3=Object.defineProperty,I3=(t,e,r)=>e in t?$3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Be=(t,e,r)=>I3(t,typeof e!="symbol"?e+"":e,r);let _3=class{constructor(e,r,n){this.core=e,this.logger=r,Be(this,"name",bI),Be(this,"keychain"),Be(this,"randomSessionIdentifier",oc()),Be(this,"initialized",!1),Be(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Be(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Be(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=ml(i);return rp(s.publicKey)}),Be(this,"generateKeyPair",()=>{this.isInitialized();const i=e$();return this.setPrivateKey(i.publicKey,i.privateKey)}),Be(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=ml(s),a=this.randomSessionIdentifier;return await L1(a,i,vI,o)}),Be(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=t$(a,s);return this.setSymKey(c,o)}),Be(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||r$(i);return await this.keychain.set(o,i),o}),Be(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Be(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Be(this,"encode",async(i,s,o)=>{this.isInitialized();const a=Mp(o),c=ar(s);if(Ql(a))return s$(c,o==null?void 0:o.encoding);if(Jl(a)){const d=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(d,p)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return n$({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),Be(this,"decode",async(i,s,o)=>{this.isInitialized();const a=a$(s,o);if(Ql(a)){const c=o$(s,o==null?void 0:o.encoding);return kr(c)}if(Jl(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=i$({symKey:c,encoded:s,encoding:o==null?void 0:o.encoding});return kr(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Be(this,"getPayloadType",(i,s=Br)=>{const o=Bi({encoded:i,encoding:s});return Fr(o.type)}),Be(this,"getPayloadSenderPublicKey",(i,s=Br)=>{const o=Bi({encoded:i,encoding:s});return o.senderPublicKey?ze(o.senderPublicKey,Ve):void 0}),this.core=e,this.logger=Ke(r,this.name),this.keychain=n||new E3(this.core,this.logger)}get context(){return rt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(lh)}catch{e=oc(),await this.keychain.set(lh,e)}return m3(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};var S3=Object.defineProperty,O3=Object.defineProperties,A3=Object.getOwnPropertyDescriptors,bh=Object.getOwnPropertySymbols,D3=Object.prototype.hasOwnProperty,x3=Object.prototype.propertyIsEnumerable,gc=(t,e,r)=>e in t?S3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,P3=(t,e)=>{for(var r in e||(e={}))D3.call(e,r)&&gc(t,r,e[r]);if(bh)for(var r of bh(e))x3.call(e,r)&&gc(t,r,e[r]);return t},C3=(t,e)=>O3(t,A3(e)),nt=(t,e,r)=>gc(t,typeof e!="symbol"?e+"":e,r);let T3=class extends Bm{constructor(e,r){super(e,r),this.logger=e,this.core=r,nt(this,"messages",new Map),nt(this,"messagesWithoutClientAck",new Map),nt(this,"name",II),nt(this,"version",_I),nt(this,"initialized",!1),nt(this,"storagePrefix",Mt),nt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),nt(this,"set",async(n,i,s)=>{this.isInitialized();const o=Ts(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===Ns.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,C3(P3({},c),{[o]:i}))}return await this.persist(),o}),nt(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),nt(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),nt(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=Ts(i);return typeof s[o]<"u"}),nt(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=Ts(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),nt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Ke(e,this.name),this.core=r}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ya(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Ya(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ja(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ja(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};var N3=Object.defineProperty,R3=Object.defineProperties,B3=Object.getOwnPropertyDescriptors,vh=Object.getOwnPropertySymbols,U3=Object.prototype.hasOwnProperty,L3=Object.prototype.propertyIsEnumerable,yc=(t,e,r)=>e in t?N3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fs=(t,e)=>{for(var r in e||(e={}))U3.call(e,r)&&yc(t,r,e[r]);if(vh)for(var r of vh(e))L3.call(e,r)&&yc(t,r,e[r]);return t},oa=(t,e)=>R3(t,B3(e)),St=(t,e,r)=>yc(t,typeof e!="symbol"?e+"":e,r);class j3 extends Um{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,St(this,"events",new pt.EventEmitter),St(this,"name",SI),St(this,"queue",new Map),St(this,"publishTimeout",M.toMiliseconds(M.ONE_MINUTE)),St(this,"initialPublishTimeout",M.toMiliseconds(M.ONE_SECOND*15)),St(this,"needsTransportRestart",!1),St(this,"publish",async(n,i,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const a=(s==null?void 0:s.ttl)||hh,c=Ms(s),u=(s==null?void 0:s.prompt)||!1,l=(s==null?void 0:s.tag)||0,h=(s==null?void 0:s.id)||Tr().toString(),d={topic:n,message:i,opts:{ttl:a,relay:c,prompt:u,tag:l,id:h,attestation:s==null?void 0:s.attestation,tvf:s==null?void 0:s.tvf}},p=`Failed to publish payload, please try again. id:${h} tag:${l}`;try{const g=new Promise(async y=>{const f=({id:b})=>{d.opts.id===b&&(this.removeRequestFromQueue(b),this.relayer.events.removeListener(xe.publish,f),y(d))};this.relayer.events.on(xe.publish,f);const v=yr(new Promise((b,E)=>{this.rpcPublish({topic:n,message:i,ttl:a,prompt:u,tag:l,id:h,attestation:s==null?void 0:s.attestation,tvf:s==null?void 0:s.tvf}).then(b).catch(x=>{this.logger.warn(x,x==null?void 0:x.message),E(x)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${l}`);try{await v,this.events.removeListener(xe.publish,f)}catch(b){this.queue.set(h,oa(fs({},d),{attempt:1})),this.logger.warn(b,b==null?void 0:b.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:n,message:i,opts:s}}),await yr(g,this.publishTimeout,p)}catch(g){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(g),(o=s==null?void 0:s.internal)!=null&&o.throwOnFailedPublish)throw g}finally{this.queue.delete(h)}}),St(this,"on",(n,i)=>{this.events.on(n,i)}),St(this,"once",(n,i)=>{this.events.once(n,i)}),St(this,"off",(n,i)=>{this.events.off(n,i)}),St(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Ke(r,this.name),this.registerEventListeners()}get context(){return rt(this.logger)}async rpcPublish(e){var r,n,i,s;const{topic:o,message:a,ttl:c=hh,prompt:u,tag:l,id:h,attestation:d,tvf:p}=e,g={method:Ei(Ms().protocol).publish,params:fs({topic:o,message:a,ttl:c,prompt:u,tag:l,attestation:d},p),id:h};ac((r=g.params)==null?void 0:r.prompt)&&((n=g.params)==null||delete n.prompt),ac((i=g.params)==null?void 0:i.tag)&&((s=g.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:g});const y=await this.relayer.request(g);return this.relayer.events.emit(xe.publish,e),this.logger.debug("Successfully Published Payload"),y}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{const n=e.attempt+1;this.queue.set(r,oa(fs({},e),{attempt:n}));const{topic:i,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${n}`),await this.rpcPublish(oa(fs({},e),{topic:i,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Wr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(xe.connection_stalled);return}this.checkQueue()}),this.relayer.on(xe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var k3=Object.defineProperty,q3=(t,e,r)=>e in t?k3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tn=(t,e,r)=>q3(t,typeof e!="symbol"?e+"":e,r);class F3{constructor(){tn(this,"map",new Map),tn(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),tn(this,"get",e=>this.map.get(e)||[]),tn(this,"exists",(e,r)=>this.get(e).includes(r)),tn(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),tn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var M3=Object.defineProperty,z3=Object.defineProperties,H3=Object.getOwnPropertyDescriptors,Eh=Object.getOwnPropertySymbols,V3=Object.prototype.hasOwnProperty,K3=Object.prototype.propertyIsEnumerable,wc=(t,e,r)=>e in t?M3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,di=(t,e)=>{for(var r in e||(e={}))V3.call(e,r)&&wc(t,r,e[r]);if(Eh)for(var r of Eh(e))K3.call(e,r)&&wc(t,r,e[r]);return t},aa=(t,e)=>z3(t,H3(e)),ce=(t,e,r)=>wc(t,typeof e!="symbol"?e+"":e,r);let W3=class extends km{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ce(this,"subscriptions",new Map),ce(this,"topicMap",new F3),ce(this,"events",new pt.EventEmitter),ce(this,"name",TI),ce(this,"version",NI),ce(this,"pending",new Map),ce(this,"cached",[]),ce(this,"initialized",!1),ce(this,"storagePrefix",Mt),ce(this,"subscribeTimeout",M.toMiliseconds(M.ONE_MINUTE)),ce(this,"initialSubscribeTimeout",M.toMiliseconds(M.ONE_SECOND*15)),ce(this,"clientId"),ce(this,"batchSubscribeTopicsLimit",500),ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ce(this,"subscribe",async(n,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const s=Ms(i),o={topic:n,relay:s,transportType:i==null?void 0:i.transportType};this.pending.set(n,o);const a=await this.rpcSubscribe(n,s,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),ce(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),ce(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),ce(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),ce(this,"on",(n,i)=>{this.events.on(n,i)}),ce(this,"once",(n,i)=>{this.events.once(n,i)}),ce(this,"off",(n,i)=>{this.events.off(n,i)}),ce(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),ce(this,"start",async()=>{await this.onConnect()}),ce(this,"stop",async()=>{await this.onDisconnect()}),ce(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ce(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),ce(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Wr.pulse,async()=>{await this.checkPending()}),this.events.on(st.created,async n=>{const i=st.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(st.deleted,async n=>{const i=st.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Ke(r,this.name),this.clientId=""}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=Ms(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=$i("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i;(!n||(n==null?void 0:n.transportType)===de.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const s={method:Ei(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(i=n==null?void 0:n.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((n==null?void 0:n.transportType)===de.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(l=>this.logger.warn(l))},M.toMiliseconds(M.ONE_SECOND)),a;const c=new Promise(async l=>{const h=d=>{d.topic===e&&(this.events.removeListener(st.created,h),l(d.id))};this.events.on(st.created,h);try{const d=await yr(new Promise((p,g)=>{this.relayer.request(s).catch(y=>{this.logger.warn(y,y==null?void 0:y.message),g(y)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(st.created,h),l(d)}catch{}}),u=await yr(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(xe.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:Ei(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await yr(new Promise(i=>{this.relayer.request(n).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(xe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:Ei(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await yr(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(xe.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:Ei(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,aa(di({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,di({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,di({},r)),this.topicMap.set(r.topic,e),this.events.emit(st.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(st.deleted,aa(di({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(st.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(st.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>aa(di({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await dE(M.toMiliseconds(M.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Ts(e+await this.getClientId())}};var G3=Object.defineProperty,$h=Object.getOwnPropertySymbols,Z3=Object.prototype.hasOwnProperty,Y3=Object.prototype.propertyIsEnumerable,mc=(t,e,r)=>e in t?G3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ih=(t,e)=>{for(var r in e||(e={}))Z3.call(e,r)&&mc(t,r,e[r]);if($h)for(var r of $h(e))Y3.call(e,r)&&mc(t,r,e[r]);return t},X=(t,e,r)=>mc(t,typeof e!="symbol"?e+"":e,r);let J3=class extends Lm{constructor(e){super(e),X(this,"protocol","wc"),X(this,"version",2),X(this,"core"),X(this,"logger"),X(this,"events",new pt.EventEmitter),X(this,"provider"),X(this,"messages"),X(this,"subscriber"),X(this,"publisher"),X(this,"name",AI),X(this,"transportExplicitlyClosed",!1),X(this,"initialized",!1),X(this,"connectionAttemptInProgress",!1),X(this,"relayUrl"),X(this,"projectId"),X(this,"packageName"),X(this,"bundleId"),X(this,"hasExperiencedNetworkDisruption",!1),X(this,"pingTimeout"),X(this,"heartBeatTimeout",M.toMiliseconds(M.THIRTY_SECONDS+M.FIVE_SECONDS)),X(this,"reconnectTimeout"),X(this,"connectPromise"),X(this,"reconnectInProgress",!1),X(this,"requestsInFlight",[]),X(this,"connectTimeout",M.toMiliseconds(M.ONE_SECOND*15)),X(this,"request",async r=>{var n,i;this.logger.debug("Publishing Request Payload");const s=r.id||Tr().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${s}:${((i=r.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),X(this,"resetPingTimeout",()=>{Fs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),X(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),X(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(xe.connect)}),X(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),X(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(xe.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),X(this,"registerProviderListeners",()=>{this.provider.on(yt.payload,this.onPayloadHandler),this.provider.on(yt.connect,this.onConnectHandler),this.provider.on(yt.disconnect,this.onDisconnectHandler),this.provider.on(yt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ke(e.logger,this.name):Hi(Qs({level:e.logger||OI})),this.messages=new T3(this.logger,e.core),this.subscriber=new W3(this,this.logger),this.publisher=new j3(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Xp,this.projectId=e.projectId,tE()?this.packageName=Ol():rE()&&(this.bundleId=Ol()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return rt(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:de.relay},Ns.outbound)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=r==null?void 0:r.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(st.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(st.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,Ih({internal:{throwOnFailedPublish:o}},r)).catch(d=>{o&&h(d)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await yr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await th())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=Oi(M.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(xe.message,e),await this.recordMessageEvent(e,Ns.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(yt.disconnect,s),await yr(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(yt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(yt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(yt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,M.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(Fs())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new vt(new gI(aE({sdkVersion:dc,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),uu(e)){if(!e.method.endsWith(DI))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:de.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ih({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else fo(e)&&this.events.emit(xe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Ns.inbound),this.events.emit(xe.message,e))}async acknowledgePayload(e){const r=lo(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(yt.payload,this.onPayloadHandler),this.provider.off(yt.connect,this.onConnectHandler),this.provider.off(yt.disconnect,this.onDisconnectHandler),this.provider.off(yt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await th();$$(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Wr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&S$())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(xe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},M.toMiliseconds(xI)))))}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function Q3(){}function _h(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function Sh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Oh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const X3="[object RegExp]",eS="[object String]",tS="[object Number]",rS="[object Boolean]",Ah="[object Arguments]",nS="[object Symbol]",iS="[object Date]",sS="[object Map]",oS="[object Set]",aS="[object Array]",cS="[object Function]",uS="[object ArrayBuffer]",ca="[object Object]",lS="[object Error]",hS="[object DataView]",dS="[object Uint8Array]",fS="[object Uint8ClampedArray]",pS="[object Uint16Array]",gS="[object Uint32Array]",yS="[object BigUint64Array]",wS="[object Int8Array]",mS="[object Int16Array]",bS="[object Int32Array]",vS="[object BigInt64Array]",ES="[object Float32Array]",$S="[object Float64Array]";function IS(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function _S(t,e,r){return Ii(t,e,void 0,void 0,void 0,void 0,r)}function Ii(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Pi(t,e,s,o)}return Pi(t,e,s,o)}function Pi(t,e,r,n){if(Object.is(t,e))return!0;let i=Oh(t),s=Oh(e);if(i===Ah&&(i=ca),s===Ah&&(s=ca),i!==s)return!1;switch(i){case eS:return t.toString()===e.toString();case tS:{const c=t.valueOf(),u=e.valueOf();return IS(c,u)}case rS:case iS:case nS:return Object.is(t.valueOf(),e.valueOf());case X3:return t.source===e.source&&t.flags===e.flags;case cS:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case sS:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Ii(u,e.get(c),c,t,e,r,n))return!1;return!0}case oS:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],d=u.findIndex(p=>Ii(h,p,void 0,t,e,r,n));if(d===-1)return!1;u.splice(d,1)}return!0}case aS:case dS:case fS:case pS:case gS:case yS:case wS:case mS:case bS:case vS:case ES:case $S:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ii(t[c],e[c],c,t,e,r,n))return!1;return!0}case uS:return t.byteLength!==e.byteLength?!1:Pi(new Uint8Array(t),new Uint8Array(e),r,n);case hS:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Pi(new Uint8Array(t),new Uint8Array(e),r,n);case lS:return t.name===e.name&&t.message===e.message;case ca:{if(!(Pi(t.constructor,e.constructor,r,n)||_h(t)&&_h(e)))return!1;const c=[...Object.keys(t),...Sh(t)],u=[...Object.keys(e),...Sh(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],d=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!Ii(d,p,h,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function SS(t,e){return _S(t,e,Q3)}var OS=Object.defineProperty,Dh=Object.getOwnPropertySymbols,AS=Object.prototype.hasOwnProperty,DS=Object.prototype.propertyIsEnumerable,bc=(t,e,r)=>e in t?OS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xh=(t,e)=>{for(var r in e||(e={}))AS.call(e,r)&&bc(t,r,e[r]);if(Dh)for(var r of Dh(e))DS.call(e,r)&&bc(t,r,e[r]);return t},Ge=(t,e,r)=>bc(t,typeof e!="symbol"?e+"":e,r);let Zr=class extends jm{constructor(e,r,n,i=Mt,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,Ge(this,"map",new Map),Ge(this,"version",PI),Ge(this,"cached",[]),Ge(this,"initialized",!1),Ge(this,"getKey"),Ge(this,"storagePrefix",Mt),Ge(this,"recentlyDeleted",[]),Ge(this,"recentlyDeletedLimit",200),Ge(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!ac(o)?this.map.set(this.getKey(o),o):w$(o)?this.map.set(o.id,o):m$(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ge(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ge(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ge(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>SS(a[c],o[c]))):this.values)),Ge(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=xh(xh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ge(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ke(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=ie("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};var xS=Object.defineProperty,PS=(t,e,r)=>e in t?xS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Y=(t,e,r)=>PS(t,typeof e!="symbol"?e+"":e,r);let CS=class{constructor(e,r){this.core=e,this.logger=r,Y(this,"name",RI),Y(this,"version",BI),Y(this,"events",new Wc),Y(this,"pairings"),Y(this,"initialized",!1),Y(this,"storagePrefix",Mt),Y(this,"ignoredPayloadTypes",[Xn]),Y(this,"registeredMethods",[]),Y(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Y(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),Y(this,"create",async n=>{this.isInitialized();const i=oc(),s=await this.core.crypto.setSymKey(i),o=Oi(M.FIVE_MINUTES),a={protocol:Qp},c={topic:s,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},u=eh({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(Dr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n==null?void 0:n.transportType}),{topic:s,uri:u}}),Y(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[jt.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Xl(n.uri);i.props.properties.topic=s,i.addTrace(jt.pairing_uri_validation_success),i.addTrace(jt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(jt.existing_pairing),l.active)throw i.setError(Jt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(jt.pairing_not_expired)}const h=c||Oi(M.FIVE_MINUTES),d={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,d),i.addTrace(jt.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(Dr.create,d),i.addTrace(jt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(jt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Jt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw i.setError(Jt.subscribe_pairing_topic_failure),p}return i.addTrace(jt.subscribe_pairing_topic_success),d}),Y(this,"activate",async({topic:n})=>{this.isInitialized();const i=Oi(M.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),Y(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=cE();this.events.once(Ko("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),Y(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),Y(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),Y(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Y(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",$i("USER_DISCONNECTED")),await this.deletePairing(i))}),Y(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return eh({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),Y(this,"sendRequest",async(n,i,s)=>{const o=wr(i,s),a=await this.core.crypto.encode(n,o),c=li[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),Y(this,"sendResult",async(n,i,s)=>{const o=lo(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=li[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),Y(this,"sendError",async(n,i,s)=>{const o=ho(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=li[c]?li[c].res:li.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),Y(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,$i("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),Y(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>Al(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),Y(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),Y(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),Y(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(Dr.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),Y(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{qt(i)?this.events.emit(Ko("pairing_ping",s),{}):bt(i)&&this.events.emit(Ko("pairing_ping",s),{error:i.error})},500)}),Y(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Dr.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),Y(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=$i("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),Y(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error($i("WC_METHOD_UNSUPPORTED",n))}),Y(this,"isValidPair",(n,i)=>{var s;if(!na(n)){const{message:a}=ie("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(Jt.malformed_pairing_uri),new Error(a)}if(!y$(n.uri)){const{message:a}=ie("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(Jt.malformed_pairing_uri),new Error(a)}const o=Xl(n==null?void 0:n.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=ie("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Jt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=ie("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Jt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&M.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(Jt.pairing_expired);const{message:a}=ie("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),Y(this,"isValidPing",async n=>{if(!na(n)){const{message:s}=ie("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),Y(this,"isValidDisconnect",async n=>{if(!na(n)){const{message:s}=ie("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),Y(this,"isValidPairingTopic",async n=>{if(!zp(n)){const{message:i}=ie("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=ie("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(Al(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=ie("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Ke(r,this.name),this.pairings=new Zr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return rt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(xe.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==de.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);uu(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):fo(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(mt.expired,async e=>{const{topic:r}=hE(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Dr.expire,{topic:r}))})}};var TS=Object.defineProperty,NS=(t,e,r)=>e in t?TS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ue=(t,e,r)=>NS(t,typeof e!="symbol"?e+"":e,r);let RS=class extends Rm{constructor(e,r){super(e,r),this.core=e,this.logger=r,Ue(this,"records",new Map),Ue(this,"events",new pt.EventEmitter),Ue(this,"name",UI),Ue(this,"version",LI),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"storagePrefix",Mt),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ue(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:Oi(M.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(It.created,o)}),Ue(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=bt(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(It.updated,i))}),Ue(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),Ue(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(It.deleted,s)}}),this.persist()}),Ue(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),Ue(this,"on",(n,i)=>{this.events.on(n,i)}),Ue(this,"once",(n,i)=>{this.events.once(n,i)}),Ue(this,"off",(n,i)=>{this.events.off(n,i)}),Ue(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Ke(r,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:wr(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(It.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(It.created,e=>{const r=It.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(It.updated,e=>{const r=It.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(It.deleted,e=>{const r=It.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(Wr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{M.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(It.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};var BS=Object.defineProperty,US=(t,e,r)=>e in t?BS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Me=(t,e,r)=>US(t,typeof e!="symbol"?e+"":e,r);let LS=class extends qm{constructor(e,r){super(e,r),this.core=e,this.logger=r,Me(this,"expirations",new Map),Me(this,"events",new pt.EventEmitter),Me(this,"name",jI),Me(this,"version",kI),Me(this,"cached",[]),Me(this,"initialized",!1),Me(this,"storagePrefix",Mt),Me(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Me(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),Me(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(mt.created,{target:s,expiration:o})}),Me(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),Me(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(mt.deleted,{target:i,expiration:s})}}),Me(this,"on",(n,i)=>{this.events.on(n,i)}),Me(this,"once",(n,i)=>{this.events.once(n,i)}),Me(this,"off",(n,i)=>{this.events.off(n,i)}),Me(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Ke(r,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return uE(e);if(typeof e=="number")return lE(e);const{message:r}=ie("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(mt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=ie("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=ie("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;M.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(mt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Wr.pulse,()=>this.checkExpirations()),this.events.on(mt.created,e=>{const r=mt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(mt.expired,e=>{const r=mt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(mt.deleted,e=>{const r=mt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=ie("NOT_INITIALIZED",this.name);throw new Error(e)}}};var jS=Object.defineProperty,kS=(t,e,r)=>e in t?jS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ve=(t,e,r)=>kS(t,typeof e!="symbol"?e+"":e,r);let qS=class extends Fm{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,ve(this,"name",qI),ve(this,"abortController"),ve(this,"isDevEnv"),ve(this,"verifyUrlV3",MI),ve(this,"storagePrefix",Mt),ve(this,"version",Jp),ve(this,"publicKey"),ve(this,"fetchPromise"),ve(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&M.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ve(this,"register",async i=>{if(!Gi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=dt.getDocument(),l=this.startAbortTimer(M.ONE_SECOND*5),h=await new Promise((d,p)=>{const g=()=>{window.removeEventListener("message",f),u.body.removeChild(y),p("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const y=u.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",g,{signal:this.abortController.signal});const f=v=>{if(v.data&&typeof v.data=="string")try{const b=JSON.parse(v.data);if(b.type==="verify_attestation"){if(Za(b.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(y),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",f),d(b.attestation===null?"":b.attestation)}}catch(b){this.logger.warn(b)}};u.body.appendChild(y),window.addEventListener("message",f,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),ve(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Za(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),ve(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(M.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ve(this,"getVerifyUrl",i=>{let s=i||xi;return zI.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${xi}`),s=xi),s}),ve(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(M.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),ve(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),ve(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ve(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ve(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ve(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),ve(this,"validateAttestation",(i,s)=>{const o=u$(i,s.publicKey),a={hasExpired:M.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ke(r,this.name),this.abortController=new AbortController,this.isDevEnv=dp(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return rt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}};var FS=Object.defineProperty,MS=(t,e,r)=>e in t?FS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ph=(t,e,r)=>MS(t,typeof e!="symbol"?e+"":e,r);let zS=class extends Mm{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Ph(this,"context",HI),Ph(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${VI}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Ke(r,this.context)}};var HS=Object.defineProperty,Ch=Object.getOwnPropertySymbols,VS=Object.prototype.hasOwnProperty,KS=Object.prototype.propertyIsEnumerable,vc=(t,e,r)=>e in t?HS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fi=(t,e)=>{for(var r in e||(e={}))VS.call(e,r)&&vc(t,r,e[r]);if(Ch)for(var r of Ch(e))KS.call(e,r)&&vc(t,r,e[r]);return t},$e=(t,e,r)=>vc(t,typeof e!="symbol"?e+"":e,r);class WS extends zm{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,$e(this,"context",WI),$e(this,"storagePrefix",Mt),$e(this,"storageVersion",KI),$e(this,"events",new Map),$e(this,"shouldPersist",!1),$e(this,"init",async()=>{if(!dp())try{const i={eventId:Dl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:lp(this.core.relayer.protocol,this.core.relayer.version,dc)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),$e(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=Dl(),l=this.core.projectId||"",h=Date.now(),d=fi({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,d),this.shouldPersist=!0),d}),$e(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return fi(fi({},a),this.setMethods(a.eventId))}),$e(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),$e(this,"setEventListeners",()=>{this.core.heartbeat.on(Wr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{M.fromMiliseconds(Date.now())-M.fromMiliseconds(i.timestamp)>GI&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),$e(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),$e(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),$e(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),$e(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),$e(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,fi(fi({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),$e(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),$e(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${ZI}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${dc}${s}`,{method:"POST",body:JSON.stringify(i)})}),$e(this,"getAppDomain",()=>iE().url),this.logger=Ke(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var GS=Object.defineProperty,Th=Object.getOwnPropertySymbols,ZS=Object.prototype.hasOwnProperty,YS=Object.prototype.propertyIsEnumerable,Ec=(t,e,r)=>e in t?GS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nh=(t,e)=>{for(var r in e||(e={}))ZS.call(e,r)&&Ec(t,r,e[r]);if(Th)for(var r of Th(e))YS.call(e,r)&&Ec(t,r,e[r]);return t},he=(t,e,r)=>Ec(t,typeof e!="symbol"?e+"":e,r);let JS=class hg extends Pm{constructor(e){var r;super(e),he(this,"protocol",Yp),he(this,"version",Jp),he(this,"name",hc),he(this,"relayUrl"),he(this,"projectId"),he(this,"customStoragePrefix"),he(this,"events",new pt.EventEmitter),he(this,"logger"),he(this,"heartbeat"),he(this,"relayer"),he(this,"crypto"),he(this,"storage"),he(this,"history"),he(this,"expirer"),he(this,"pairing"),he(this,"verify"),he(this,"echoClient"),he(this,"linkModeSupportedApps"),he(this,"eventClient"),he(this,"initialized",!1),he(this,"logChunkController"),he(this,"on",(a,c)=>this.events.on(a,c)),he(this,"once",(a,c)=>this.events.once(a,c)),he(this,"off",(a,c)=>this.events.off(a,c)),he(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),he(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:de.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Xp,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Qs({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:wI.logger,name:hc}),{logger:s,chunkLoggerController:o}=Am({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ke(s,this.name),this.heartbeat=new Nw,this.crypto=new _3(this,this.logger,e==null?void 0:e.keychain),this.history=new RS(this,this.logger),this.expirer=new LS(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new lm(Nh(Nh({},mI),e==null?void 0:e.storageOptions)),this.relayer=new J3({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new CS(this,this.logger),this.verify=new qS(this,this.logger,this.storage),this.echoClient=new zS(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new WS(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new hg(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(CI,n),r}get context(){return rt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(dh,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(dh)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&yI.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const QS=JS;function Li(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Rh(t){return Li(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const dg="2.23.2";let pi={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${dg}`};class Mr extends Error{constructor(e,r={}){var a;const n=(()=>{var c;return r.cause instanceof Mr?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),i=r.cause instanceof Mr&&r.cause.docsPath||r.docsPath,s=(a=pi.getDocsUrl)==null?void 0:a.call(pi,{...r,docsPath:i}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...n?[`Details: ${n}`]:[],...pi.version?[`Version: ${pi.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=i,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=dg}walk(e){return fg(this,e)}}function fg(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?fg(t.cause,e):e?null:t}class pg extends Mr{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function ei(t,{dir:e,size:r=32}={}){return typeof t=="string"?XS(t,{dir:e,size:r}):eO(t,{dir:e,size:r})}function XS(t,{dir:e,size:r=32}={}){if(r===null)return t;const n=t.replace("0x","");if(n.length>r*2)throw new pg({size:Math.ceil(n.length/2),targetSize:r,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function eO(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new pg({size:t.length,targetSize:r,type:"bytes"});const n=new Uint8Array(r);for(let i=0;i<r;i++){const s=e==="right";n[s?i:r-i-1]=t[s?i:t.length-i-1]}return n}class tO extends Mr{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${i*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}class rO extends Mr{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed ${r} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function ti(t,{size:e}){if(Rh(t)>e)throw new rO({givenSize:Rh(t),maxSize:e})}function $c(t,e={}){const{signed:r}=e;e.size&&ti(t,{size:e.size});const n=BigInt(t);if(!r)return n;const i=(t.length-2)/2,s=(1n<<BigInt(i)*8n-1n)-1n;return n<=s?n:n-BigInt(`0x${"f".padStart(i*2,"f")}`)-1n}function nO(t,e={}){return Number($c(t,e))}const iO=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ic(t,e={}){return typeof t=="number"||typeof t=="bigint"?yg(t,e):typeof t=="string"?aO(t,e):typeof t=="boolean"?sO(t,e):gg(t,e)}function sO(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(ti(r,{size:e.size}),ei(r,{size:e.size})):r}function gg(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=iO[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(ti(n,{size:e.size}),ei(n,{dir:"right",size:e.size})):n}function yg(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const c=typeof t=="bigint"?"n":"";throw new tO({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:r,size:n,value:`${t}${c}`})}const a=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?ei(a,{size:n}):a}const oO=new TextEncoder;function aO(t,e={}){const r=oO.encode(t);return gg(r,e)}const cO=new TextEncoder;function uO(t,e={}){return typeof t=="number"||typeof t=="bigint"?hO(t,e):typeof t=="boolean"?lO(t,e):Li(t)?wg(t,e):mg(t,e)}function lO(t,e={}){const r=new Uint8Array(1);return r[0]=Number(t),typeof e.size=="number"?(ti(r,{size:e.size}),ei(r,{size:e.size})):r}const Gt={zero:48,nine:57,A:65,F:70,a:97,f:102};function Bh(t){if(t>=Gt.zero&&t<=Gt.nine)return t-Gt.zero;if(t>=Gt.A&&t<=Gt.F)return t-(Gt.A-10);if(t>=Gt.a&&t<=Gt.f)return t-(Gt.a-10)}function wg(t,e={}){let r=t;e.size&&(ti(r,{size:e.size}),r=ei(r,{dir:"right",size:e.size}));let n=r.slice(2);n.length%2&&(n=`0${n}`);const i=n.length/2,s=new Uint8Array(i);for(let o=0,a=0;o<i;o++){const c=Bh(n.charCodeAt(a++)),u=Bh(n.charCodeAt(a++));if(c===void 0||u===void 0)throw new Mr(`Invalid byte sequence ("${n[a-2]}${n[a-1]}" in "${n}").`);s[o]=c*16+u}return s}function hO(t,e){const r=yg(t,e);return wg(r)}function mg(t,e={}){const r=cO.encode(t);return typeof e.size=="number"?(ti(r,{size:e.size}),ei(r,{dir:"right",size:e.size})):r}function zs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function dO(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function go(t,...e){if(!dO(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function IN(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");zs(t.outputLen),zs(t.blockLen)}function Uh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function fO(t,e){go(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const ps=BigInt(2**32-1),Lh=BigInt(32);function pO(t,e=!1){return e?{h:Number(t&ps),l:Number(t>>Lh&ps)}:{h:Number(t>>Lh&ps)|0,l:Number(t&ps)|0}}function gO(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=pO(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const yO=(t,e,r)=>t<<r|e>>>32-r,wO=(t,e,r)=>e<<r|t>>>32-r,mO=(t,e,r)=>e<<r-32|t>>>64-r,bO=(t,e,r)=>t<<r-32|e>>>64-r,rn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vO(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function _N(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function SN(t,e){return t<<32-e|t>>>e}const jh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function EO(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function kh(t){for(let e=0;e<t.length;e++)t[e]=EO(t[e])}function $O(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function bg(t){return typeof t=="string"&&(t=$O(t)),go(t),t}function ON(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];go(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class IO{clone(){return this._cloneInto()}}function _O(t){const e=n=>t().update(bg(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function AN(t=32){if(rn&&typeof rn.getRandomValues=="function")return rn.getRandomValues(new Uint8Array(t));if(rn&&typeof rn.randomBytes=="function")return rn.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const vg=[],Eg=[],$g=[],SO=BigInt(0),gi=BigInt(1),OO=BigInt(2),AO=BigInt(7),DO=BigInt(256),xO=BigInt(113);for(let t=0,e=gi,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],vg.push(2*(5*n+r)),Eg.push((t+1)*(t+2)/2%64);let i=SO;for(let s=0;s<7;s++)e=(e<<gi^(e>>AO)*xO)%DO,e&OO&&(i^=gi<<(gi<<BigInt(s))-gi);$g.push(i)}const[PO,CO]=gO($g,!0),qh=(t,e,r)=>r>32?mO(t,e,r):yO(t,e,r),Fh=(t,e,r)=>r>32?bO(t,e,r):wO(t,e,r);function TO(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=qh(u,l,1)^r[a],d=Fh(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Eg[o],c=qh(i,s,a),u=Fh(i,s,a),l=vg[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=PO[n],t[1]^=CO[n]}r.fill(0)}class lu extends IO{constructor(e,r,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,zs(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=vO(this.state)}keccak(){jh||kh(this.state32),TO(this.state32,this.rounds),jh||kh(this.state32),this.posOut=0,this.pos=0}update(e){Uh(this);const{blockLen:r,state:n}=this;e=bg(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Uh(this,!1),go(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return zs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(fO(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new lu(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const NO=(t,e,r)=>_O(()=>new lu(e,t,r)),RO=NO(1,136,256/8);function Ig(t,e){const r=e||"hex",n=RO(Li(t,{strict:!1})?uO(t):t);return r==="bytes"?n:Ic(n)}class BO extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const ua=new BO(8192);function UO(t,e){if(ua.has(`${t}.${e}`))return ua.get(`${t}.${e}`);const r=t.substring(2).toLowerCase(),n=Ig(mg(r),"bytes"),i=r.split("");for(let o=0;o<40;o+=2)n[o>>1]>>4>=8&&i[o]&&(i[o]=i[o].toUpperCase()),(n[o>>1]&15)>=8&&i[o+1]&&(i[o+1]=i[o+1].toUpperCase());const s=`0x${i.join("")}`;return ua.set(`${t}.${e}`,s),s}function LO(t){const e=Ig(`0x${t.substring(4)}`).substring(26);return UO(`0x${e}`)}async function jO({hash:t,signature:e}){const r=Li(t)?t:Ic(t),{secp256k1:n}=await If(async()=>{const{secp256k1:o}=await import("./secp256k1-DrJfIhyE.js");return{secp256k1:o}},__vite__mapDeps([0,1,2,3,4]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:u,s:l,v:h,yParity:d}=e,p=Number(d??h),g=Mh(p);return new n.Signature($c(u),$c(l)).addRecoveryBit(g)}const o=Li(e)?e:Ic(e),a=nO(`0x${o.slice(130)}`),c=Mh(a);return n.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(r.substring(2)).toHex(!1)}`}function Mh(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function kO({hash:t,signature:e}){return LO(await jO({hash:t,signature:e}))}function qO(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0;const p=u.length;for(;d!==p&&u[d]===0;)d++,l++;const g=(p-d)*s+1>>>0,y=new Uint8Array(g);for(;d!==p;){let b=u[d],E=0;for(let x=g-1;(b!==0||E<h)&&x!==-1;x--,E++)b+=256*y[x]>>>0,y[x]=b%r>>>0,b=b/r>>>0;if(b!==0)throw new Error("Non-zero carry");h=E,d++}let f=g-h;for(;f!==g&&y[f]===0;)f++;let v=n.repeat(l);for(;f<g;++f)v+=t.charAt(y[f]);return v}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===n;)h++,l++;const p=(u.length-l)*i+1>>>0,g=new Uint8Array(p);for(;l<u.length;){const b=u.charCodeAt(l);if(b>255)return;let E=e[b];if(E===255)return;let x=0;for(let T=p-1;(E!==0||x<d)&&T!==-1;T--,x++)E+=r*g[T]>>>0,g[T]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");d=x,l++}let y=p-d;for(;y!==p&&g[y]===0;)y++;const f=new Uint8Array(h+(p-y));let v=h;for(;y!==p;)f[v++]=g[y++];return f}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var FO="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const MO=qO(FO);var zO={};const HO=":";function Rs(t){const[e,r]=t.split(HO);return{namespace:e,reference:r}}function _g(t,e){return t.includes(":")?[t]:e.chains||[]}var VO=Object.defineProperty,KO=Object.defineProperties,WO=Object.getOwnPropertyDescriptors,zh=Object.getOwnPropertySymbols,GO=Object.prototype.hasOwnProperty,ZO=Object.prototype.propertyIsEnumerable,Hh=(t,e,r)=>e in t?VO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vh=(t,e)=>{for(var r in e||(e={}))GO.call(e,r)&&Hh(t,r,e[r]);if(zh)for(var r of zh(e))ZO.call(e,r)&&Hh(t,r,e[r]);return t},YO=(t,e)=>KO(t,WO(e));const JO="ReactNative",On={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};function Sg(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Og(){return!dt.getDocument()&&!!dt.getNavigator()&&navigator.product===JO}function Ag(){return!Sg()&&!!dt.getNavigator()&&!!dt.getDocument()}function QO(){return Og()?On.reactNative:Sg()?On.node:Ag()?On.browser:On.unknown}function XO(t){var e,r;const n=e8();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),YO(Vh(Vh({},n),t),{url:(t==null?void 0:t.url)||n.url,name:(t==null?void 0:t.name)||n.name,description:(t==null?void 0:t.description)||n.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:n.icons})}catch(i){return console.warn("Error populating app metadata",i),t||n}}function e8(){return ip.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Nr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function nn(t=M.FIVE_MINUTES,e){const r=M.toMiliseconds(t||M.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function t8(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function Ze(t,e){return M.fromMiliseconds(Date.now()+M.toMiliseconds(t))}function sn(t){return Date.now()>=M.toMiliseconds(t)}function ue(t,e){return`${t}${e?`:${e}`:""}`}function Ur(t=[],e=[]){return[...new Set([...t,...e])]}async function r8({id:t,topic:e,wcDeepLink:r}){var n;try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r,s=i==null?void 0:i.href;if(typeof s!="string")return;const o=n8(s,t,e),a=QO();if(a===On.browser){if(!((n=dt.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}i8(o)}else a===On.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function n8(t,e,r){const n=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${u8(n,!0)}`}else i=`${i}/wc?${n}`;return i}function i8(t){let e="_self";c8()?e="_top":(a8()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function s8(t,e){let r="";try{if(Ag()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(n){console.error(n)}return r}function Kh(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),n=r.indexOf(e);return r[n+2]}function o8(){return typeof process<"u"&&zO.IS_VITEST==="true"}function a8(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function c8(){try{return window.self!==window.top}catch{return!1}}function u8(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Hs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function l8(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function es(t,...e){if(!l8(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function h8(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hs(t.outputLen),Hs(t.blockLen)}function jn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Dg(t,e){es(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const gs=BigInt(2**32-1),Wh=BigInt(32);function d8(t,e=!1){return e?{h:Number(t&gs),l:Number(t>>Wh&gs)}:{h:Number(t>>Wh&gs)|0,l:Number(t&gs)|0}}function f8(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=d8(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const p8=(t,e,r)=>t<<r|e>>>32-r,g8=(t,e,r)=>e<<r|t>>>32-r,y8=(t,e,r)=>e<<r-32|t>>>64-r,w8=(t,e,r)=>t<<r-32|e>>>64-r,on=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function m8(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function la(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Bt(t,e){return t<<32-e|t>>>e}const Gh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function b8(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Zh(t){for(let e=0;e<t.length;e++)t[e]=b8(t[e])}function v8(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function yo(t){return typeof t=="string"&&(t=v8(t)),es(t),t}function E8(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];es(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let hu=class{clone(){return this._cloneInto()}};function xg(t){const e=n=>t().update(yo(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Pg(t=32){if(on&&typeof on.getRandomValues=="function")return on.getRandomValues(new Uint8Array(t));if(on&&typeof on.randomBytes=="function")return on.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Cg=[],Tg=[],Ng=[],$8=BigInt(0),yi=BigInt(1),I8=BigInt(2),_8=BigInt(7),S8=BigInt(256),O8=BigInt(113);for(let t=0,e=yi,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],Cg.push(2*(5*n+r)),Tg.push((t+1)*(t+2)/2%64);let i=$8;for(let s=0;s<7;s++)e=(e<<yi^(e>>_8)*O8)%S8,e&I8&&(i^=yi<<(yi<<BigInt(s))-yi);Ng.push(i)}const[A8,D8]=f8(Ng,!0),Yh=(t,e,r)=>r>32?y8(t,e,r):p8(t,e,r),Jh=(t,e,r)=>r>32?w8(t,e,r):g8(t,e,r);function x8(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=Yh(u,l,1)^r[a],d=Jh(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Tg[o],c=Yh(i,s,a),u=Jh(i,s,a),l=Cg[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=A8[n],t[1]^=D8[n]}r.fill(0)}let P8=class Rg extends hu{constructor(e,r,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Hs(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=m8(this.state)}keccak(){Gh||Zh(this.state32),x8(this.state32,this.rounds),Gh||Zh(this.state32),this.posOut=0,this.pos=0}update(e){jn(this);const{blockLen:r,state:n}=this;e=yo(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){jn(this,!1),es(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Hs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Dg(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Rg(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const C8=(t,e,r)=>xg(()=>new P8(e,t,r)),T8=C8(1,136,256/8),N8="https://rpc.walletconnect.org/v1";function Bg(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(T8(r)).toString("hex")}async function R8(t,e,r,n,i,s){switch(r.t){case"eip191":return await B8(t,e,r.s);case"eip1271":return await U8(t,e,r.s,n,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function B8(t,e,r){return(await kO({hash:Bg(e),signature:r})).toLowerCase()===t.toLowerCase()}async function U8(t,e,r,n,i,s){const o=Rs(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u="0000000000000000000000000000000000000000000000000000000000000041",l=r.substring(2),h=Bg(e).substring(2),d=a+h+c+u+l,p=await fetch(`${s||N8}/?chainId=${n}&projectId=${i}`,{method:"POST",body:JSON.stringify({id:L8(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:g}=await p.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function L8(){return Date.now()+Math.floor(Math.random()*1e3)}function j8(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const n=r[0];if(n===0)throw new Error("No signatures found");const i=1+n*64;if(r.length<i)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return MO.encode(s)}var k8=Object.defineProperty,q8=Object.defineProperties,F8=Object.getOwnPropertyDescriptors,Qh=Object.getOwnPropertySymbols,M8=Object.prototype.hasOwnProperty,z8=Object.prototype.propertyIsEnumerable,Xh=(t,e,r)=>e in t?k8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,H8=(t,e)=>{for(var r in e||(e={}))M8.call(e,r)&&Xh(t,r,e[r]);if(Qh)for(var r of Qh(e))z8.call(e,r)&&Xh(t,r,e[r]);return t},V8=(t,e)=>q8(t,F8(e));const K8="did:pkh:",du=t=>t==null?void 0:t.split(":"),W8=t=>{const e=t&&du(t);if(e)return t.includes(K8)?e[3]:e[1]},_c=t=>{const e=t&&du(t);if(e)return e[2]+":"+e[3]},Vs=t=>{const e=t&&du(t);if(e)return e.pop()};async function ed(t){const{cacao:e,projectId:r}=t,{s:n,p:i}=e,s=Ug(i,i.iss),o=Vs(i.iss);return await R8(o,s,n,_c(i.iss),r)}const Ug=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,n=Vs(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${W8(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(y=>`
- ${y}`).join("")}`:void 0,g=Bs(t.resources);if(g){const y=ji(g);i=rA(i,y)}return[r,n,"",i,"",s,o,a,c,u,l,h,d,p].filter(y=>y!=null).join(`
`)};function G8(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function Z8(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function zr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const n=t.att[r];if(Array.isArray(n))throw new Error(`Resource must be an object: ${r}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(n).forEach(i=>{const s=n[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function Y8(t,e,r,n={}){return r==null||r.sort((i,s)=>i.localeCompare(s)),{att:{[t]:J8(e,r,n)}}}function J8(t,e,r={}){e=e==null?void 0:e.sort((i,s)=>i.localeCompare(s));const n=e.map(i=>({[`${t}/${i}`]:[r]}));return Object.assign({},...n)}function Lg(t){return zr(t),`urn:recap:${G8(t).replace(/=/g,"")}`}function ji(t){const e=Z8(t.replace("urn:recap:",""));return zr(e),e}function Q8(t,e,r){const n=Y8(t,e,r);return Lg(n)}function X8(t){return t&&t.includes("urn:recap:")}function eA(t,e){const r=ji(t),n=ji(e),i=tA(r,n);return Lg(i)}function tA(t,e){zr(t),zr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),n={att:{}};return r.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;n.att[i]=V8(H8({},n.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((u=e.att[i])==null?void 0:u[a])})})}),n}function rA(t="",e){zr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const n=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(i++,`(${i}) '${h}': '${u[h].join("', '")}' for '${a}'.`));n.push(l.join(", ").replace(".,","."))});const s=n.join(" "),o=`${r}${s}`;return`${t?t+" ":""}${o}`}function td(t){var e;const r=ji(t);zr(r);const n=(e=r.att)==null?void 0:e.eip155;return n?Object.keys(n).map(i=>i.split("/")[1]):[]}function rd(t){const e=ji(t);zr(e);const r=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(i=>{var s;(s=i==null?void 0:i[0])!=null&&s.chains&&r.push(i[0].chains)})}),[...new Set(r.flat())]}function Bs(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return X8(e)?e:void 0}function ha(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function jg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function lt(t,...e){if(!jg(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function nd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function nA(t,e){lt(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function id(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const br=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),iA=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),sA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!sA)throw new Error("Non little-endian hardware is not supported");function oA(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Sc(t){if(typeof t=="string")t=oA(t);else if(jg(t))t=Oc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function aA(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function cA(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const uA=(t,e)=>{function r(n,...i){if(lt(n),t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?lt(u):lt(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&lt(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");lt(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,lt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(lt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function sd(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!lA(e))throw new Error("invalid output, must be aligned");return e}function od(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function lA(t){return t.byteOffset%4===0}function Oc(t){return Uint8Array.from(t)}function kn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const kg=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),hA=kg("expand 16-byte k"),dA=kg("expand 32-byte k"),fA=br(hA),pA=br(dA);function ee(t,e){return t<<e|t>>>32-e}function Ac(t){return t.byteOffset%4===0}const ys=64,gA=16,qg=2**32-1,ad=new Uint32Array;function yA(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(ys),l=br(u),h=Ac(i)&&Ac(s),d=h?br(i):ad,p=h?br(s):ad;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=qg)throw new Error("arx: counter overflow");const y=Math.min(ys,c-g);if(h&&y===ys){const f=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let v=0,b;v<gA;v++)b=f+v,p[b]=d[b]^l[v];g+=ys;continue}for(let f=0,v;f<y;f++)v=g+f,s[v]=i[v]^u[f];g+=y}}function wA(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=aA({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return ha(i),ha(o),id(s),id(r),(a,c,u,l,h=0)=>{lt(a),lt(c),lt(u);const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),lt(l),ha(h),h<0||h>=qg)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const p=[];let g=a.length,y,f;if(g===32)p.push(y=Oc(a)),f=pA;else if(g===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),f=fA,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Ac(c)||p.push(c=Oc(c));const v=br(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(f,v,br(c.subarray(0,16)),v),c=c.subarray(16)}const b=16-i;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const x=new Uint8Array(12);x.set(c,s?0:12-c.length),c=x,p.push(c)}const E=br(c);return yA(t,f,v,E,u,l,h,o),kn(...p),l}}const Le=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let mA=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Sc(e),lt(e,32);const r=Le(e,0),n=Le(e,2),i=Le(e,4),s=Le(e,6),o=Le(e,8),a=Le(e,10),c=Le(e,12),u=Le(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Le(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],p=o[6],g=o[7],y=o[8],f=o[9],v=Le(e,r+0),b=Le(e,r+2),E=Le(e,r+4),x=Le(e,r+6),T=Le(e,r+8),I=Le(e,r+10),O=Le(e,r+12),D=Le(e,r+14);let _=s[0]+(v&8191),B=s[1]+((v>>>13|b<<3)&8191),C=s[2]+((b>>>10|E<<6)&8191),R=s[3]+((E>>>7|x<<9)&8191),L=s[4]+((x>>>4|T<<12)&8191),$=s[5]+(T>>>1&8191),w=s[6]+((T>>>14|I<<2)&8191),m=s[7]+((I>>>11|O<<5)&8191),A=s[8]+((O>>>8|D<<8)&8191),P=s[9]+(D>>>5|i),S=0,N=S+_*a+B*(5*f)+C*(5*y)+R*(5*g)+L*(5*p);S=N>>>13,N&=8191,N+=$*(5*d)+w*(5*h)+m*(5*l)+A*(5*u)+P*(5*c),S+=N>>>13,N&=8191;let U=S+_*c+B*a+C*(5*f)+R*(5*y)+L*(5*g);S=U>>>13,U&=8191,U+=$*(5*p)+w*(5*d)+m*(5*h)+A*(5*l)+P*(5*u),S+=U>>>13,U&=8191;let j=S+_*u+B*c+C*a+R*(5*f)+L*(5*y);S=j>>>13,j&=8191,j+=$*(5*g)+w*(5*p)+m*(5*d)+A*(5*h)+P*(5*l),S+=j>>>13,j&=8191;let q=S+_*l+B*u+C*c+R*a+L*(5*f);S=q>>>13,q&=8191,q+=$*(5*y)+w*(5*g)+m*(5*p)+A*(5*d)+P*(5*h),S+=q>>>13,q&=8191;let k=S+_*h+B*l+C*u+R*c+L*a;S=k>>>13,k&=8191,k+=$*(5*f)+w*(5*y)+m*(5*g)+A*(5*p)+P*(5*d),S+=k>>>13,k&=8191;let z=S+_*d+B*h+C*l+R*u+L*c;S=z>>>13,z&=8191,z+=$*a+w*(5*f)+m*(5*y)+A*(5*g)+P*(5*p),S+=z>>>13,z&=8191;let H=S+_*p+B*d+C*h+R*l+L*u;S=H>>>13,H&=8191,H+=$*c+w*a+m*(5*f)+A*(5*y)+P*(5*g),S+=H>>>13,H&=8191;let G=S+_*g+B*p+C*d+R*h+L*l;S=G>>>13,G&=8191,G+=$*u+w*c+m*a+A*(5*f)+P*(5*y),S+=G>>>13,G&=8191;let K=S+_*y+B*g+C*p+R*d+L*h;S=K>>>13,K&=8191,K+=$*l+w*u+m*c+A*a+P*(5*f),S+=K>>>13,K&=8191;let V=S+_*f+B*y+C*g+R*p+L*d;S=V>>>13,V&=8191,V+=$*h+w*l+m*u+A*c+P*a,S+=V>>>13,V&=8191,S=(S<<2)+S|0,S=S+N|0,N=S&8191,S=S>>>13,U+=S,s[0]=N,s[1]=U,s[2]=j,s[3]=q,s[4]=k,s[5]=z,s[6]=H,s[7]=G,s[8]=K,s[9]=V}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;kn(n)}update(e){nd(this);const{buffer:r,blockLen:n}=this;e=Sc(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){kn(this.h,this.r,this.buffer,this.pad)}digestInto(e){nd(this),nA(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}};function bA(t){const e=(n,i)=>t(i).update(Sc(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const vA=bA(t=>new mA(t));function EA(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],d=e[2],p=e[3],g=e[4],y=e[5],f=e[6],v=e[7],b=i,E=r[0],x=r[1],T=r[2],I=o,O=a,D=c,_=u,B=l,C=h,R=d,L=p,$=g,w=y,m=f,A=v,P=b,S=E,N=x,U=T;for(let q=0;q<s;q+=2)I=I+B|0,P=ee(P^I,16),$=$+P|0,B=ee(B^$,12),I=I+B|0,P=ee(P^I,8),$=$+P|0,B=ee(B^$,7),O=O+C|0,S=ee(S^O,16),w=w+S|0,C=ee(C^w,12),O=O+C|0,S=ee(S^O,8),w=w+S|0,C=ee(C^w,7),D=D+R|0,N=ee(N^D,16),m=m+N|0,R=ee(R^m,12),D=D+R|0,N=ee(N^D,8),m=m+N|0,R=ee(R^m,7),_=_+L|0,U=ee(U^_,16),A=A+U|0,L=ee(L^A,12),_=_+L|0,U=ee(U^_,8),A=A+U|0,L=ee(L^A,7),I=I+C|0,U=ee(U^I,16),m=m+U|0,C=ee(C^m,12),I=I+C|0,U=ee(U^I,8),m=m+U|0,C=ee(C^m,7),O=O+R|0,P=ee(P^O,16),A=A+P|0,R=ee(R^A,12),O=O+R|0,P=ee(P^O,8),A=A+P|0,R=ee(R^A,7),D=D+L|0,S=ee(S^D,16),$=$+S|0,L=ee(L^$,12),D=D+L|0,S=ee(S^D,8),$=$+S|0,L=ee(L^$,7),_=_+B|0,N=ee(N^_,16),w=w+N|0,B=ee(B^w,12),_=_+B|0,N=ee(N^_,8),w=w+N|0,B=ee(B^w,7);let j=0;n[j++]=o+I|0,n[j++]=a+O|0,n[j++]=c+D|0,n[j++]=u+_|0,n[j++]=l+B|0,n[j++]=h+C|0,n[j++]=d+R|0,n[j++]=p+L|0,n[j++]=g+$|0,n[j++]=y+w|0,n[j++]=f+m|0,n[j++]=v+A|0,n[j++]=b+P|0,n[j++]=E+S|0,n[j++]=x+N|0,n[j++]=T+U|0}const $A=wA(EA,{counterRight:!1,counterLength:4,allowShortKeys:!1}),IA=new Uint8Array(16),cd=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(IA.subarray(r))},_A=new Uint8Array(32);function ud(t,e,r,n,i){const s=t(e,r,_A),o=vA.create(s);i&&cd(o,i),cd(o,n);const a=new Uint8Array(16),c=iA(a);od(c,0,BigInt(i?i.length:0),!0),od(c,8,BigInt(n.length),!0),o.update(a);const u=o.digest();return kn(s,a),u}const SA=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=sd(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=ud(t,e,r,a,n);return s.set(c,o),kn(c),s},decrypt(i,s){s=sd(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=ud(t,e,r,o,n);if(!cA(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),kn(c),s}});uA({blockSize:64,nonceLength:12,tagLength:16},SA($A));let Fg=class extends hu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,h8(e);const n=yo(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return jn(this),this.iHash.update(e),this}digestInto(e){jn(this),es(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Mg=(t,e,r)=>new Fg(t,e).update(r).digest();Mg.create=(t,e)=>new Fg(t,e);function OA(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function AA(t,e,r){return t&e^~t&r}function DA(t,e,r){return t&e^t&r^e&r}let xA=class extends hu{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=la(this.buffer)}update(e){jn(this);const{view:r,buffer:n,blockLen:i}=this;e=yo(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=la(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){jn(this),Dg(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;OA(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=la(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}};const PA=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),dr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),fr=new Uint32Array(64);let CA=class extends xA{constructor(){super(64,32,8,!1),this.A=dr[0]|0,this.B=dr[1]|0,this.C=dr[2]|0,this.D=dr[3]|0,this.E=dr[4]|0,this.F=dr[5]|0,this.G=dr[6]|0,this.H=dr[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)fr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=fr[h-15],p=fr[h-2],g=Bt(d,7)^Bt(d,18)^d>>>3,y=Bt(p,17)^Bt(p,19)^p>>>10;fr[h]=y+fr[h-7]+g+fr[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=Bt(a,6)^Bt(a,11)^Bt(a,25),p=l+d+AA(a,c,u)+PA[h]+fr[h]|0,g=(Bt(n,2)^Bt(n,13)^Bt(n,22))+DA(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){fr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const fu=xg(()=>new CA);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const wo=BigInt(0),mo=BigInt(1),TA=BigInt(2);function Hr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ts(t){if(!Hr(t))throw new Error("Uint8Array expected")}function qn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const NA=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Fn(t){ts(t);let e="";for(let r=0;r<t.length;r++)e+=NA[t[r]];return e}function An(t){const e=t.toString(16);return e.length&1?"0"+e:e}function pu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?wo:BigInt("0x"+t)}const Zt={_0:48,_9:57,A:65,F:70,a:97,f:102};function ld(t){if(t>=Zt._0&&t<=Zt._9)return t-Zt._0;if(t>=Zt.A&&t<=Zt.F)return t-(Zt.A-10);if(t>=Zt.a&&t<=Zt.f)return t-(Zt.a-10)}function Mn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=ld(t.charCodeAt(s)),a=ld(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Lr(t){return pu(Fn(t))}function ki(t){return ts(t),pu(Fn(Uint8Array.from(t).reverse()))}function zn(t,e){return Mn(t.toString(16).padStart(e*2,"0"))}function bo(t,e){return zn(t,e).reverse()}function RA(t){return Mn(An(t))}function at(t,e,r){let n;if(typeof e=="string")try{n=Mn(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Hr(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function qi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];ts(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}function BA(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function UA(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const da=t=>typeof t=="bigint"&&wo<=t;function vo(t,e,r){return da(t)&&da(e)&&da(r)&&e<=t&&t<r}function sr(t,e,r,n){if(!vo(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function zg(t){let e;for(e=0;t>wo;t>>=mo,e+=1);return e}function LA(t,e){return t>>BigInt(e)&mo}function jA(t,e,r){return t|(r?mo:wo)<<BigInt(e)}const gu=t=>(TA<<BigInt(t-1))-mo,fa=t=>new Uint8Array(t),hd=t=>Uint8Array.from(t);function Hg(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=fa(t),i=fa(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...l)=>r(i,n,...l),c=(l=fa())=>{i=a(hd([0]),l),n=a(),l.length!==0&&(i=a(hd([1]),l),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<e;){n=a();const d=n.slice();h.push(d),l+=n.length}return qi(...h)};return(l,h)=>{o(),c(l);let d;for(;!(d=h(u()));)c();return o(),d}}const kA={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Hr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ri(t,e,r={}){const n=(i,s,o)=>{const a=kA[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}const qA=()=>{throw new Error("not implemented")};function Dc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}var FA=Object.freeze({__proto__:null,isBytes:Hr,abytes:ts,abool:qn,bytesToHex:Fn,numberToHexUnpadded:An,hexToNumber:pu,hexToBytes:Mn,bytesToNumberBE:Lr,bytesToNumberLE:ki,numberToBytesBE:zn,numberToBytesLE:bo,numberToVarBytesBE:RA,ensureBytes:at,concatBytes:qi,equalBytes:BA,utf8ToBytes:UA,inRange:vo,aInRange:sr,bitLen:zg,bitGet:LA,bitSet:jA,bitMask:gu,createHmacDrbg:Hg,validateObject:ri,notImplemented:qA,memoized:Dc});const Te=BigInt(0),me=BigInt(1),xr=BigInt(2),MA=BigInt(3),xc=BigInt(4),dd=BigInt(5),fd=BigInt(8);function Qe(t,e){const r=t%e;return r>=Te?r:e+r}function Vg(t,e,r){if(e<Te)throw new Error("invalid exponent, negatives unsupported");if(r<=Te)throw new Error("invalid modulus");if(r===me)return Te;let n=me;for(;e>Te;)e&me&&(n=n*t%r),t=t*t%r,e>>=me;return n}function Dt(t,e,r){let n=t;for(;e-- >Te;)n*=n,n%=r;return n}function Pc(t,e){if(t===Te)throw new Error("invert: expected non-zero number");if(e<=Te)throw new Error("invert: expected positive modulus, got "+e);let r=Qe(t,e),n=e,i=Te,s=me;for(;r!==Te;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==me)throw new Error("invert: does not exist");return Qe(i,e)}function zA(t){const e=(t-me)/xr;let r,n,i;for(r=t-me,n=0;r%xr===Te;r/=xr,n++);for(i=xr;i<t&&Vg(i,e,t)!==t-me;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+me)/xc;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+me)/xr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let g=o.sqr(h);d<c&&!o.eql(g,o.ONE);d++)g=o.sqr(g);const p=o.pow(u,me<<BigInt(c-d-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=d}return l}}function HA(t){if(t%xc===MA){const e=(t+me)/xc;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%fd===dd){const e=(t-dd)/fd;return function(r,n){const i=r.mul(n,xr),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,xr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return zA(t)}const VA=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function KA(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=VA.reduce((n,i)=>(n[i]="function",n),e);return ri(t,r)}function WA(t,e,r){if(r<Te)throw new Error("invalid exponent, negatives unsupported");if(r===Te)return t.ONE;if(r===me)return e;let n=t.ONE,i=e;for(;r>Te;)r&me&&(n=t.mul(n,i)),i=t.sqr(i),r>>=me;return n}function GA(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function Kg(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Wg(t,e,r=!1,n={}){if(t<=Te)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Kg(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:gu(i),ZERO:Te,ONE:me,create:c=>Qe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Te<=c&&c<t},is0:c=>c===Te,isOdd:c=>(c&me)===me,neg:c=>Qe(-c,t),eql:(c,u)=>c===u,sqr:c=>Qe(c*c,t),add:(c,u)=>Qe(c+u,t),sub:(c,u)=>Qe(c-u,t),mul:(c,u)=>Qe(c*u,t),pow:(c,u)=>WA(a,c,u),div:(c,u)=>Qe(c*Pc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Pc(c,t),sqrt:n.sqrt||(c=>(o||(o=HA(t)),o(a,c))),invertBatch:c=>GA(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?bo(c,s):zn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?ki(c):Lr(c)}});return Object.freeze(a)}function Gg(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Zg(t){const e=Gg(t);return e+Math.ceil(e/2)}function ZA(t,e,r=!1){const n=t.length,i=Gg(e),s=Zg(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?ki(t):Lr(t),a=Qe(o,e-me)+me;return r?bo(a,i):zn(a,i)}const pd=BigInt(0),ws=BigInt(1);function pa(t,e){const r=e.negate();return t?r:e}function Yg(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ga(t,e){Yg(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function YA(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function JA(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const ya=new WeakMap,Jg=new WeakMap;function wa(t){return Jg.get(t)||1}function QA(t,e){return{constTimeNegate:pa,hasPrecomputes(r){return wa(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>pd;)n&ws&&(i=i.add(s)),s=s.double(),n>>=ws;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=ga(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=ga(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let d=0;d<s;d++){const p=d*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=ws);const y=p,f=p+Math.abs(g)-1,v=d%2!==0,b=g<0;g===0?c=c.add(pa(v,n[y])):a=a.add(pa(b,n[f]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=ga(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(i===pd)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=ws),p===0)continue;let g=n[d+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=ya.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&ya.set(n,i(s))),s},wNAFCached(r,n,i){const s=wa(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=wa(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Yg(n,e),Jg.set(r,n),ya.delete(r)}}}function XA(t,e,r,n){if(YA(r,t),JA(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=zg(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let d=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),d=d.add(g);if(l=l.add(d),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function Qg(t){return KA(t.Fp),ri(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Kg(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const an=BigInt(0),ma=BigInt(1);function eD(t){return ri(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function tD(t){const e=eD(t),{P:r}=e,n=b=>Qe(b,r),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(b=>b),c=e.powPminus2||(b=>Vg(b,r-BigInt(2),r));function u(b,E,x){const T=n(b*(E-x));return E=n(E-T),x=n(x+T),[E,x]}const l=(e.a-BigInt(2))/BigInt(4);function h(b,E){sr("u",b,an,r),sr("scalar",E,an,r);const x=E,T=b;let I=ma,O=an,D=b,_=ma,B=an,C;for(let L=BigInt(i-1);L>=an;L--){const $=x>>L&ma;B^=$,C=u(B,I,D),I=C[0],D=C[1],C=u(B,O,_),O=C[0],_=C[1],B=$;const w=I+O,m=n(w*w),A=I-O,P=n(A*A),S=m-P,N=D+_,U=D-_,j=n(U*w),q=n(N*A),k=j+q,z=j-q;D=n(k*k),_=n(T*n(z*z)),I=n(m*P),O=n(S*(m+n(l*S)))}C=u(B,I,D),I=C[0],D=C[1],C=u(B,O,_),O=C[0],_=C[1];const R=c(O);return n(I*R)}function d(b){return bo(n(b),s)}function p(b){const E=at("u coordinate",b,s);return o===32&&(E[31]&=127),ki(E)}function g(b){const E=at("scalar",b),x=E.length;if(x!==s&&x!==o){let T=""+s+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+x)}return ki(a(E))}function y(b,E){const x=p(E),T=g(b),I=h(x,T);if(I===an)throw new Error("invalid private or public key received");return d(I)}const f=d(e.Gu);function v(b){return y(b,f)}return{scalarMult:y,scalarMultBase:v,getSharedSecret:(b,E)=>y(b,E),getPublicKey:b=>v(b),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:f}}const Cc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const rD=BigInt(1),gd=BigInt(2),nD=BigInt(3),iD=BigInt(5);BigInt(8);function sD(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Cc,o=t*t%s*t%s,a=Dt(o,gd,s)*o%s,c=Dt(a,rD,s)*t%s,u=Dt(c,iD,s)*c%s,l=Dt(u,e,s)*u%s,h=Dt(l,r,s)*l%s,d=Dt(h,n,s)*h%s,p=Dt(d,i,s)*d%s,g=Dt(p,i,s)*d%s,y=Dt(g,e,s)*u%s;return{pow_p_5_8:Dt(y,gd,s)*t%s,b2:o}}function oD(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}tD({P:Cc,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=Cc,{pow_p_5_8:r,b2:n}=sD(t);return Qe(Dt(r,nD,e)*n,e)},adjustScalarBytes:oD,randomBytes:Pg});function yd(t){t.lowS!==void 0&&qn("lowS",t.lowS),t.prehash!==void 0&&qn("prehash",t.prehash)}function aD(t){const e=Qg(t);ri(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:cD,hexToBytes:uD}=FA;let lD=class extends Error{constructor(e=""){super(e)}};const Xt={Err:lD,_tlv:{encode:(t,e)=>{const{Err:r}=Xt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=An(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?An(i.length/2|128):"";return An(t)+s+i+e},decode(t,e){const{Err:r}=Xt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Xt;if(t<rr)throw new e("integer: negative integers are not allowed");let r=An(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Xt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return cD(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Xt,i=typeof t=="string"?uD(t):t;ts(i);const{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Xt,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},rr=BigInt(0),Oe=BigInt(1);BigInt(2);const wd=BigInt(3);BigInt(4);function hD(t){const e=aD(t),{Fp:r}=e,n=Wg(e.n,e.nBitLength),i=e.toBytes||((y,f,v)=>{const b=f.toAffine();return qi(Uint8Array.from([4]),r.toBytes(b.x),r.toBytes(b.y))}),s=e.fromBytes||(y=>{const f=y.subarray(1),v=r.fromBytes(f.subarray(0,r.BYTES)),b=r.fromBytes(f.subarray(r.BYTES,2*r.BYTES));return{x:v,y:b}});function o(y){const{a:f,b:v}=e,b=r.sqr(y),E=r.mul(b,y);return r.add(r.add(E,r.mul(y,f)),v)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return vo(y,Oe,e.n)}function c(y){const{allowedPrivateKeyLengths:f,nByteLength:v,wrapPrivateKey:b,n:E}=e;if(f&&typeof y!="bigint"){if(Hr(y)&&(y=Fn(y)),typeof y!="string"||!f.includes(y.length))throw new Error("invalid private key");y=y.padStart(v*2,"0")}let x;try{x=typeof y=="bigint"?y:Lr(at("private key",y,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof y)}return b&&(x=Qe(x,E)),sr("private key",x,Oe,E),x}function u(y){if(!(y instanceof d))throw new Error("ProjectivePoint expected")}const l=Dc((y,f)=>{const{px:v,py:b,pz:E}=y;if(r.eql(E,r.ONE))return{x:v,y:b};const x=y.is0();f==null&&(f=x?r.ONE:r.inv(E));const T=r.mul(v,f),I=r.mul(b,f),O=r.mul(E,f);if(x)return{x:r.ZERO,y:r.ZERO};if(!r.eql(O,r.ONE))throw new Error("invZ was invalid");return{x:T,y:I}}),h=Dc(y=>{if(y.is0()){if(e.allowInfinityPoint&&!r.is0(y.py))return;throw new Error("bad point: ZERO")}const{x:f,y:v}=y.toAffine();if(!r.isValid(f)||!r.isValid(v))throw new Error("bad point: x or y not FE");const b=r.sqr(v),E=o(f);if(!r.eql(b,E))throw new Error("bad point: equation left != right");if(!y.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(f,v,b){if(this.px=f,this.py=v,this.pz=b,f==null||!r.isValid(f))throw new Error("x required");if(v==null||!r.isValid(v))throw new Error("y required");if(b==null||!r.isValid(b))throw new Error("z required");Object.freeze(this)}static fromAffine(f){const{x:v,y:b}=f||{};if(!f||!r.isValid(v)||!r.isValid(b))throw new Error("invalid affine point");if(f instanceof d)throw new Error("projective point not allowed");const E=x=>r.eql(x,r.ZERO);return E(v)&&E(b)?d.ZERO:new d(v,b,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){const v=r.invertBatch(f.map(b=>b.pz));return f.map((b,E)=>b.toAffine(v[E])).map(d.fromAffine)}static fromHex(f){const v=d.fromAffine(s(at("pointHex",f)));return v.assertValidity(),v}static fromPrivateKey(f){return d.BASE.multiply(c(f))}static msm(f,v){return XA(d,n,f,v)}_setWindowSize(f){g.setWindowSize(this,f)}assertValidity(){h(this)}hasEvenY(){const{y:f}=this.toAffine();if(r.isOdd)return!r.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){u(f);const{px:v,py:b,pz:E}=this,{px:x,py:T,pz:I}=f,O=r.eql(r.mul(v,I),r.mul(x,E)),D=r.eql(r.mul(b,I),r.mul(T,E));return O&&D}negate(){return new d(this.px,r.neg(this.py),this.pz)}double(){const{a:f,b:v}=e,b=r.mul(v,wd),{px:E,py:x,pz:T}=this;let I=r.ZERO,O=r.ZERO,D=r.ZERO,_=r.mul(E,E),B=r.mul(x,x),C=r.mul(T,T),R=r.mul(E,x);return R=r.add(R,R),D=r.mul(E,T),D=r.add(D,D),I=r.mul(f,D),O=r.mul(b,C),O=r.add(I,O),I=r.sub(B,O),O=r.add(B,O),O=r.mul(I,O),I=r.mul(R,I),D=r.mul(b,D),C=r.mul(f,C),R=r.sub(_,C),R=r.mul(f,R),R=r.add(R,D),D=r.add(_,_),_=r.add(D,_),_=r.add(_,C),_=r.mul(_,R),O=r.add(O,_),C=r.mul(x,T),C=r.add(C,C),_=r.mul(C,R),I=r.sub(I,_),D=r.mul(C,B),D=r.add(D,D),D=r.add(D,D),new d(I,O,D)}add(f){u(f);const{px:v,py:b,pz:E}=this,{px:x,py:T,pz:I}=f;let O=r.ZERO,D=r.ZERO,_=r.ZERO;const B=e.a,C=r.mul(e.b,wd);let R=r.mul(v,x),L=r.mul(b,T),$=r.mul(E,I),w=r.add(v,b),m=r.add(x,T);w=r.mul(w,m),m=r.add(R,L),w=r.sub(w,m),m=r.add(v,E);let A=r.add(x,I);return m=r.mul(m,A),A=r.add(R,$),m=r.sub(m,A),A=r.add(b,E),O=r.add(T,I),A=r.mul(A,O),O=r.add(L,$),A=r.sub(A,O),_=r.mul(B,m),O=r.mul(C,$),_=r.add(O,_),O=r.sub(L,_),_=r.add(L,_),D=r.mul(O,_),L=r.add(R,R),L=r.add(L,R),$=r.mul(B,$),m=r.mul(C,m),L=r.add(L,$),$=r.sub(R,$),$=r.mul(B,$),m=r.add(m,$),R=r.mul(L,m),D=r.add(D,R),R=r.mul(A,m),O=r.mul(w,O),O=r.sub(O,R),R=r.mul(w,L),_=r.mul(A,_),_=r.add(_,R),new d(O,D,_)}subtract(f){return this.add(f.negate())}is0(){return this.equals(d.ZERO)}wNAF(f){return g.wNAFCached(this,f,d.normalizeZ)}multiplyUnsafe(f){const{endo:v,n:b}=e;sr("scalar",f,rr,b);const E=d.ZERO;if(f===rr)return E;if(this.is0()||f===Oe)return this;if(!v||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,f,d.normalizeZ);let{k1neg:x,k1:T,k2neg:I,k2:O}=v.splitScalar(f),D=E,_=E,B=this;for(;T>rr||O>rr;)T&Oe&&(D=D.add(B)),O&Oe&&(_=_.add(B)),B=B.double(),T>>=Oe,O>>=Oe;return x&&(D=D.negate()),I&&(_=_.negate()),_=new d(r.mul(_.px,v.beta),_.py,_.pz),D.add(_)}multiply(f){const{endo:v,n:b}=e;sr("scalar",f,Oe,b);let E,x;if(v){const{k1neg:T,k1:I,k2neg:O,k2:D}=v.splitScalar(f);let{p:_,f:B}=this.wNAF(I),{p:C,f:R}=this.wNAF(D);_=g.constTimeNegate(T,_),C=g.constTimeNegate(O,C),C=new d(r.mul(C.px,v.beta),C.py,C.pz),E=_.add(C),x=B.add(R)}else{const{p:T,f:I}=this.wNAF(f);E=T,x=I}return d.normalizeZ([E,x])[0]}multiplyAndAddUnsafe(f,v,b){const E=d.BASE,x=(I,O)=>O===rr||O===Oe||!I.equals(E)?I.multiplyUnsafe(O):I.multiply(O),T=x(this,v).add(x(f,b));return T.is0()?void 0:T}toAffine(f){return l(this,f)}isTorsionFree(){const{h:f,isTorsionFree:v}=e;if(f===Oe)return!0;if(v)return v(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:f,clearCofactor:v}=e;return f===Oe?this:v?v(d,this):this.multiplyUnsafe(e.h)}toRawBytes(f=!0){return qn("isCompressed",f),this.assertValidity(),i(d,this,f)}toHex(f=!0){return qn("isCompressed",f),Fn(this.toRawBytes(f))}}d.BASE=new d(e.Gx,e.Gy,r.ONE),d.ZERO=new d(r.ZERO,r.ONE,r.ZERO);const p=e.nBitLength,g=QA(d,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function dD(t){const e=Qg(t);return ri(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function fD(t){const e=dD(t),{Fp:r,n}=e,i=r.BYTES+1,s=2*r.BYTES+1;function o($){return Qe($,n)}function a($){return Pc($,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=hD({...e,toBytes($,w,m){const A=w.toAffine(),P=r.toBytes(A.x),S=qi;return qn("isCompressed",m),m?S(Uint8Array.from([w.hasEvenY()?2:3]),P):S(Uint8Array.from([4]),P,r.toBytes(A.y))},fromBytes($){const w=$.length,m=$[0],A=$.subarray(1);if(w===i&&(m===2||m===3)){const P=Lr(A);if(!vo(P,Oe,r.ORDER))throw new Error("Point is not on curve");const S=l(P);let N;try{N=r.sqrt(S)}catch(j){const q=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+q)}const U=(N&Oe)===Oe;return(m&1)===1!==U&&(N=r.neg(N)),{x:P,y:N}}else if(w===s&&m===4){const P=r.fromBytes(A.subarray(0,r.BYTES)),S=r.fromBytes(A.subarray(r.BYTES,2*r.BYTES));return{x:P,y:S}}else{const P=i,S=s;throw new Error("invalid Point, expected length of "+P+", or uncompressed "+S+", got "+w)}}}),d=$=>Fn(zn($,e.nByteLength));function p($){const w=n>>Oe;return $>w}function g($){return p($)?o(-$):$}const y=($,w,m)=>Lr($.slice(w,m));class f{constructor(w,m,A){this.r=w,this.s=m,this.recovery=A,this.assertValidity()}static fromCompact(w){const m=e.nByteLength;return w=at("compactSignature",w,m*2),new f(y(w,0,m),y(w,m,2*m))}static fromDER(w){const{r:m,s:A}=Xt.toSig(at("DER",w));return new f(m,A)}assertValidity(){sr("r",this.r,Oe,n),sr("s",this.s,Oe,n)}addRecoveryBit(w){return new f(this.r,this.s,w)}recoverPublicKey(w){const{r:m,s:A,recovery:P}=this,S=I(at("msgHash",w));if(P==null||![0,1,2,3].includes(P))throw new Error("recovery id invalid");const N=P===2||P===3?m+e.n:m;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=(P&1)===0?"02":"03",j=c.fromHex(U+d(N)),q=a(N),k=o(-S*q),z=o(A*q),H=c.BASE.multiplyAndAddUnsafe(j,k,z);if(!H)throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new f(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Mn(this.toDERHex())}toDERHex(){return Xt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Mn(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const v={isValidPrivateKey($){try{return u($),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const $=Zg(e.n);return ZA(e.randomBytes($),e.n)},precompute($=8,w=c.BASE){return w._setWindowSize($),w.multiply(BigInt(3)),w}};function b($,w=!0){return c.fromPrivateKey($).toRawBytes(w)}function E($){const w=Hr($),m=typeof $=="string",A=(w||m)&&$.length;return w?A===i||A===s:m?A===2*i||A===2*s:$ instanceof c}function x($,w,m=!0){if(E($))throw new Error("first arg must be private key");if(!E(w))throw new Error("second arg must be public key");return c.fromHex(w).multiply(u($)).toRawBytes(m)}const T=e.bits2int||function($){if($.length>8192)throw new Error("input is too large");const w=Lr($),m=$.length*8-e.nBitLength;return m>0?w>>BigInt(m):w},I=e.bits2int_modN||function($){return o(T($))},O=gu(e.nBitLength);function D($){return sr("num < 2^"+e.nBitLength,$,rr,O),zn($,e.nByteLength)}function _($,w,m=B){if(["recovered","canonical"].some(K=>K in m))throw new Error("sign() legacy options not supported");const{hash:A,randomBytes:P}=e;let{lowS:S,prehash:N,extraEntropy:U}=m;S==null&&(S=!0),$=at("msgHash",$),yd(m),N&&($=at("prehashed msgHash",A($)));const j=I($),q=u(w),k=[D(q),D(j)];if(U!=null&&U!==!1){const K=U===!0?P(r.BYTES):U;k.push(at("extraEntropy",K))}const z=qi(...k),H=j;function G(K){const V=T(K);if(!h(V))return;const fe=a(V),se=c.BASE.multiply(V).toAffine(),ne=o(se.x);if(ne===rr)return;const oe=o(fe*o(H+ne*q));if(oe===rr)return;let pe=(se.x===ne?0:2)|Number(se.y&Oe),gt=oe;return S&&p(oe)&&(gt=g(oe),pe^=1),new f(ne,gt,pe)}return{seed:z,k2sig:G}}const B={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function R($,w,m=B){const{seed:A,k2sig:P}=_($,w,m),S=e;return Hg(S.hash.outputLen,S.nByteLength,S.hmac)(A,P)}c.BASE._setWindowSize(8);function L($,w,m,A=C){var oe;const P=$;w=at("msgHash",w),m=at("publicKey",m);const{lowS:S,prehash:N,format:U}=A;if(yd(A),"strict"in A)throw new Error("options.strict was renamed to lowS");if(U!==void 0&&U!=="compact"&&U!=="der")throw new Error("format must be compact or der");const j=typeof P=="string"||Hr(P),q=!j&&!U&&typeof P=="object"&&P!==null&&typeof P.r=="bigint"&&typeof P.s=="bigint";if(!j&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let k,z;try{if(q&&(k=new f(P.r,P.s)),j){try{U!=="compact"&&(k=f.fromDER(P))}catch(pe){if(!(pe instanceof Xt.Err))throw pe}!k&&U!=="der"&&(k=f.fromCompact(P))}z=c.fromHex(m)}catch{return!1}if(!k||S&&k.hasHighS())return!1;N&&(w=e.hash(w));const{r:H,s:G}=k,K=I(w),V=a(G),fe=o(K*V),se=o(H*V),ne=(oe=c.BASE.multiplyAndAddUnsafe(z,fe,se))==null?void 0:oe.toAffine();return ne?o(ne.x)===H:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:x,sign:R,verify:L,ProjectivePoint:c,Signature:f,utils:v}}function pD(t){return{hash:t,hmac:(e,...r)=>Mg(t,e,E8(...r)),randomBytes:Pg}}function gD(t,e){const r=n=>fD({...t,...pD(n)});return{...r(e),create:r}}const Xg=Wg(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),yD=Xg.create(BigInt("-3")),wD=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");gD({a:yD,b:wD,Fp:Xg,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},fu);const Tc="base16",ms="base64pad",wi="base64url",mD="utf8",ba=1,bD=2;function va(t){const e=fu(tt(t,Tc));return ze(e,Tc)}function cn(t){const e=fu(tt(t,mD));return ze(e,Tc)}function bs(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var vD=Object.defineProperty,ED=Object.defineProperties,$D=Object.getOwnPropertyDescriptors,md=Object.getOwnPropertySymbols,ID=Object.prototype.hasOwnProperty,_D=Object.prototype.propertyIsEnumerable,bd=(t,e,r)=>e in t?vD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,SD=(t,e)=>{for(var r in e||(e={}))ID.call(e,r)&&bd(t,r,e[r]);if(md)for(var r of md(e))_D.call(e,r)&&bd(t,r,e[r]);return t},OD=(t,e)=>ED(t,$D(e));function ni(t){const e=[];return t.forEach(r=>{const[n,i]=r.split(":");e.push(`${n}:${i}`)}),e}function AD(t){const e=[];return Object.values(t).forEach(r=>{e.push(...ni(r.accounts))}),e}function DD(t,e){const r=[];return Object.values(t).forEach(n=>{ni(n.accounts).includes(e)&&r.push(...n.methods)}),r}function xD(t,e){const r=[];return Object.values(t).forEach(n=>{ni(n.accounts).includes(e)&&r.push(...n.events)}),r}function ey(t){return t.includes(":")}function PD(t){return ey(t)?t.split(":")[0]:t}function vd(t){var e,r,n;const i={};if(!Fi(t))return i;for(const[s,o]of Object.entries(t)){const a=ey(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=PD(s);i[l]=OD(SD({},i[l]),{chains:Ur(a,(e=i[l])==null?void 0:e.chains),methods:Ur(c,(r=i[l])==null?void 0:r.methods),events:Ur(u,(n=i[l])==null?void 0:n.events)})}return i}function CD(t){const e={};return t==null||t.forEach(r=>{var n;const[i,s]=r.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(r),(n=e[i].chains)==null||n.push(`${i}:${s}`)}),e}function Ed(t,e){e=e.map(n=>n.replace("did:pkh:",""));const r=CD(e);for(const[n,i]of Object.entries(r))i.methods?i.methods=Ur(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return r}function TD(t,e){var r,n,i,s,o,a;const c=vd(t),u=vd(e),l={},h=Object.keys(c).concat(Object.keys(u));for(const d of h)l[d]={chains:Ur((r=c[d])==null?void 0:r.chains,(n=u[d])==null?void 0:n.chains),methods:Ur((i=c[d])==null?void 0:i.methods,(s=u[d])==null?void 0:s.methods),events:Ur((o=c[d])==null?void 0:o.events,(a=u[d])==null?void 0:a.events)};return l}const ND={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},RD={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function W(t,e){const{message:r,code:n}=RD[t];return{message:e?`${r} ${e}`:r,code:n}}function ge(t,e){const{message:r,code:n}=ND[t];return{message:e?`${r} ${e}`:r,code:n}}function rs(t,e){return!!Array.isArray(t)}function Fi(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Xe(t){return typeof t>"u"}function De(t,e){return e&&Xe(t)?!0:typeof t=="string"&&!!t.trim().length}function yu(t,e){return e&&Xe(t)?!0:typeof t=="number"&&!isNaN(t)}function BD(t,e){const{requiredNamespaces:r}=e,n=Object.keys(t.namespaces),i=Object.keys(r);let s=!0;return Nr(i,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=ni(a),h=r[o];(!Nr(_g(o,h),l)||!Nr(h.methods,c)||!Nr(h.events,u))&&(s=!1)}),s):!1}function Ks(t){return De(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function UD(t){if(De(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Ks(r)}}return!1}function LD(t,e){let r=null;return De(t==null?void 0:t.publicKey,!1)||(r=W("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function $d(t){let e=!0;return rs(t)?t.length&&(e=t.every(r=>De(r,!1))):e=!1,e}function jD(t,e,r){let n=null;return rs(e)&&e.length?e.forEach(i=>{n||Ks(i)||(n=ge("UNSUPPORTED_CHAINS",`${r}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):Ks(t)||(n=ge("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function kD(t,e,r){let n=null;return Object.entries(t).forEach(([i,s])=>{if(n)return;const o=jD(i,_g(i,s),`${e} ${r}`);o&&(n=o)}),n}function qD(t,e){let r=null;return rs(t)?t.forEach(n=>{r||UD(n)||(r=ge("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):r=ge("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function FD(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=qD(n==null?void 0:n.accounts,`${e} namespace`);i&&(r=i)}),r}function MD(t,e){let r=null;return $d(t==null?void 0:t.methods)?$d(t==null?void 0:t.events)||(r=ge("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=ge("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ty(t,e){let r=null;return Object.values(t).forEach(n=>{if(r)return;const i=MD(n,`${e}, namespace`);i&&(r=i)}),r}function zD(t,e,r){let n=null;if(t&&Fi(t)){const i=ty(t,e);i&&(n=i);const s=kD(t,e,r);s&&(n=s)}else n=W("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return n}function Ea(t,e){let r=null;if(t&&Fi(t)){const n=ty(t,e);n&&(r=n);const i=FD(t,e);i&&(r=i)}else r=W("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function ry(t){return De(t.protocol,!0)}function HD(t,e){let r=!1;return t?t&&rs(t)&&t.length&&t.forEach(n=>{r=ry(n)}):r=!0,r}function VD(t){return typeof t=="number"}function Ot(t){return typeof t<"u"&&typeof t!==null}function KD(t){return!(!t||typeof t!="object"||!t.code||!yu(t.code,!1)||!t.message||!De(t.message,!1))}function WD(t){return!(Xe(t)||!De(t.method,!1))}function GD(t){return!(Xe(t)||Xe(t.result)&&Xe(t.error)||!yu(t.id,!1)||!De(t.jsonrpc,!1))}function ZD(t){return!(Xe(t)||!De(t.name,!1))}function Id(t,e){return!(!Ks(e)||!AD(t).includes(e))}function YD(t,e,r){return De(r,!1)?DD(t,e).includes(r):!1}function JD(t,e,r){return De(r,!1)?xD(t,e).includes(r):!1}function _d(t,e,r){let n=null;const i=QD(t),s=XD(e),o=Object.keys(i),a=Object.keys(s),c=Sd(Object.keys(t)),u=Sd(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(n=W("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Nr(o,a)||(n=W("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const d=ni(e[h].accounts);d.includes(h)||(n=W("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{n||(Nr(i[h].methods,s[h].methods)?Nr(i[h].events,s[h].events)||(n=W("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):n=W("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function QD(t){const e={};return Object.keys(t).forEach(r=>{var n;r.includes(":")?e[r]=t[r]:(n=t[r].chains)==null||n.forEach(i=>{e[i]={methods:t[r].methods,events:t[r].events}})}),e}function Sd(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function XD(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const n=ni(t[r].accounts);n==null||n.forEach(i=>{e[i]={accounts:t[r].accounts.filter(s=>s.includes(`${i}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function ex(t,e){return yu(t,!1)&&t<=e.max&&t>=e.min}const $a={};class mi{static get(e){return $a[e]}static set(e,r){$a[e]=r}static delete(e){delete $a[e]}}const ny="wc",iy=2,sy="client",wu=`${ny}@${iy}:${sy}:`,Ia={name:sy,logger:"error"},Od="WALLETCONNECT_DEEPLINK_CHOICE",tx="proposal",Ad="Proposal expired",rx="session",un=M.SEVEN_DAYS,nx="engine",Ie={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1119}}},_a={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},Ut={idle:"IDLE",active:"ACTIVE"},Dd={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},ix="request",sx=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],ox="wc",ax="auth",cx="authKeys",ux="pairingTopics",lx="requests",Eo=`${ox}@${1.5}:${ax}:`,Us=`${Eo}:PUB_KEY`;var hx=Object.defineProperty,dx=Object.defineProperties,fx=Object.getOwnPropertyDescriptors,xd=Object.getOwnPropertySymbols,px=Object.prototype.hasOwnProperty,gx=Object.prototype.propertyIsEnumerable,Nc=(t,e,r)=>e in t?hx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,le=(t,e)=>{for(var r in e||(e={}))px.call(e,r)&&Nc(t,r,e[r]);if(xd)for(var r of xd(e))gx.call(e,r)&&Nc(t,r,e[r]);return t},He=(t,e)=>dx(t,fx(e)),F=(t,e,r)=>Nc(t,typeof e!="symbol"?e+"":e,r);let yx=class extends Wm{constructor(e){super(e),F(this,"name",nx),F(this,"events",new Wc),F(this,"initialized",!1),F(this,"requestQueue",{state:Ut.idle,queue:[]}),F(this,"sessionRequestQueue",{state:Ut.idle,queue:[]}),F(this,"requestQueueDelay",M.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ie)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=He(le({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=TD(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=n;let l=i,h,d=!1;try{if(l){const I=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=I.active}}catch(I){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),I}if(!l||!d){const{topic:I,uri:O}=await this.client.core.pairing.create();l=I,h=O}if(!l){const{message:I}=W("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(I)}const p=await this.client.core.crypto.generateKeyPair(),g=Ie.wc_sessionPropose.req.ttl||M.FIVE_MINUTES,y=Ze(g),f=He(le(le({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:Qp}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:y,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:kt()}),v=ue("session_connect",f.id),{reject:b,resolve:E,done:x}=nn(g,Ad),T=({id:I})=>{I===f.id&&(this.client.events.off("proposal_expire",T),this.pendingSessions.delete(f.id),this.events.emit(v,{error:{message:Ad,code:0}}))};return this.client.events.on("proposal_expire",T),this.events.once(v,({error:I,session:O})=>{this.client.events.off("proposal_expire",T),I?b(I):O&&E(O)}),await this.sendRequest({topic:l,method:"wc_sessionPropose",params:f,throwOnFailedPublish:!0,clientRpcId:f.id}),await this.setProposal(f.id,f),{uri:h,approval:x}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(n){throw this.client.logger.error("pair() failed"),n}}),F(this,"approve",async r=>{var n,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=r==null?void 0:r.id)==null?void 0:n.toString(),trace:[_t.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(_){throw o.setError(Ir.no_internet_connection),_}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(_){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(Ir.proposal_not_found),_}try{await this.isValidApprove(r)}catch(_){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ir.session_approve_namespace_validation_failure),_}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=r,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:y,requiredNamespaces:f,optionalNamespaces:v}=p;let b=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});b||(b=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:_t.session_approve_started,properties:{topic:g,trace:[_t.session_approve_started,_t.session_namespaces_validation_success]}}));const E=await this.client.core.crypto.generateKeyPair(),x=y.publicKey,T=await this.client.core.crypto.generateSharedKey(E,x),I=le(le(le({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:E,metadata:this.client.metadata},expiry:Ze(un)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),O=de.relay;b.addTrace(_t.subscribing_session_topic);try{await this.client.core.relayer.subscribe(T,{transportType:O})}catch(_){throw b.setError(Ir.subscribe_session_topic_failure),_}b.addTrace(_t.subscribe_session_topic_success);const D=He(le({},I),{topic:T,requiredNamespaces:f,optionalNamespaces:v,pairingTopic:g,acknowledged:!1,self:I.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:E,transportType:de.relay});await this.client.session.set(T,D),b.addTrace(_t.store_session);try{b.addTrace(_t.publishing_session_settle),await this.sendRequest({topic:T,method:"wc_sessionSettle",params:I,throwOnFailedPublish:!0}).catch(_=>{throw b==null||b.setError(Ir.session_settle_publish_failure),_}),b.addTrace(_t.session_settle_publish_success),b.addTrace(_t.publishing_session_approve),await this.sendResult({id:a,topic:g,result:{relay:{protocol:c??"irn"},responderPublicKey:E},throwOnFailedPublish:!0}).catch(_=>{throw b==null||b.setError(Ir.session_approve_publish_failure),_}),b.addTrace(_t.session_approve_publish_success)}catch(_){throw this.client.logger.error(_),this.client.session.delete(T,ge("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(T),_}return this.client.core.eventClient.deleteEvent({eventId:b.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:y.metadata}),await this.client.proposal.delete(a,ge("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(T,Ze(un)),{topic:T,acknowledged:()=>Promise.resolve(this.client.session.get(T))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:i}=r;let s;try{s=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}s&&(await this.sendError({id:n,topic:s,error:i,rpcOpts:Ie.wc_sessionPropose.reject}),await this.client.proposal.delete(n,ge("USER_DISCONNECTED")))}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:i}=r,{done:s,resolve:o,reject:a}=nn(),c=kt(),u=Tr().toString(),l=this.client.session.get(n).namespaces;return this.events.once(ue("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:i}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:l}),a(h)}),{acknowledged:s}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=r,i=kt(),{done:s,resolve:o,reject:a}=nn();return this.events.once(ue("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Ze(un)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(v){throw this.client.logger.error("request() -> isValidRequest() failed"),v}const{chainId:n,request:i,topic:s,expiry:o=Ie.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(s);(a==null?void 0:a.transportType)===de.relay&&await this.confirmOnlineStateOrThrow();const c=kt(),u=Tr().toString(),{done:l,resolve:h,reject:d}=nn(o,"Request expired. Please try again.");this.events.once(ue("session_request",c),({error:v,result:b})=>{v?d(v):h(b)});const p="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:{request:He(le({},i),{expiryTimestamp:Ze(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(v=>d(v)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),await l();const y={request:He(le({},i),{expiryTimestamp:Ze(o)}),chainId:n},f=this.shouldSetTVF(p,y);return await Promise.all([new Promise(async v=>{await this.sendRequest(le({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:y,expiry:o,throwOnFailedPublish:!0},f&&{tvf:this.getTVFParams(c,y)})).catch(b=>d(b)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:n,id:c}),v()}),new Promise(async v=>{var b;if(!((b=a.sessionConfig)!=null&&b.disableDeepLink)){const E=await s8(this.client.core.storage,Od);await r8({id:c,topic:s,wcDeepLink:E})}v()}),l()]).then(v=>v[2])}),F(this,"respond",async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:i}=r,{id:s}=i,o=this.client.session.get(n);o.transportType===de.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);qt(i)?await this.sendResult({id:s,topic:n,result:i.result,throwOnFailedPublish:!0,appLink:a}):bt(i)&&await this.sendError({id:s,topic:n,error:i.error,appLink:a}),this.cleanupAfterResponse(r)}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:n}=r;if(this.client.session.keys.includes(n)){const i=kt(),s=Tr().toString(),{done:o,resolve:a,reject:c}=nn();this.events.once(ue("session_ping",i),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:n,event:i,chainId:s}=r,o=Tr().toString(),a=kt();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:ge("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:i}=W("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(i)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(n=>BD(n,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,n)=>{var i;this.isInitialized(),this.isValidAuthenticate(r);const s=n&&this.client.core.linkModeSupportedApps.includes(n)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?de.link_mode:de.relay;o===de.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:d,exp:p,nbf:g,methods:y=[],expiry:f}=r,v=[...r.resources||[]],{topic:b,uri:E}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:b,uri:E}});const x=await this.client.core.crypto.generateKeyPair(),T=va(x);if(await Promise.all([this.client.auth.authKeys.set(Us,{responseTopic:T,publicKey:x}),this.client.auth.pairingTopics.set(T,{topic:T,pairingTopic:b})]),await this.client.core.relayer.subscribe(T,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${b}`),y.length>0){const{namespace:S}=Rs(a[0]);let N=Q8(S,"request",y);Bs(v)&&(N=eA(N,v.pop())),v.push(N)}const I=f&&f>Ie.wc_sessionAuthenticate.req.ttl?f:Ie.wc_sessionAuthenticate.req.ttl,O={authPayload:{type:d??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:g,resources:v},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Ze(I)},D={eip155:{chains:a,methods:[...new Set(["personal_sign",...y])],events:["chainChanged","accountsChanged"]}},_={requiredNamespaces:{},optionalNamespaces:D,relays:[{protocol:"irn"}],pairingTopic:b,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Ze(Ie.wc_sessionPropose.req.ttl),id:kt()},{done:B,resolve:C,reject:R}=nn(I,"Request expired"),L=kt(),$=ue("session_connect",_.id),w=ue("session_request",L),m=async({error:S,session:N})=>{this.events.off(w,A),S?R(S):N&&C({session:N})},A=async S=>{var N,U,j;if(await this.deletePendingAuthRequest(L,{message:"fulfilled",code:0}),S.error){const V=ge("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return S.error.code===V.code?void 0:(this.events.off($,m),R(S.error.message))}await this.deleteProposal(_.id),this.events.off($,m);const{cacaos:q,responder:k}=S.result,z=[],H=[];for(const V of q){await ed({cacao:V,projectId:this.client.core.projectId})||(this.client.logger.error(V,"Signature verification failed"),R(ge("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:fe}=V,se=Bs(fe.resources),ne=[_c(fe.iss)],oe=Vs(fe.iss);if(se){const pe=td(se),gt=rd(se);z.push(...pe),ne.push(...gt)}for(const pe of ne)H.push(`${pe}:${oe}`)}const G=await this.client.core.crypto.generateSharedKey(x,k.publicKey);let K;z.length>0&&(K={topic:G,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:k,controller:k.publicKey,expiry:Ze(un),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:b,namespaces:Ed([...new Set(z)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,K),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:k.metadata}),K=this.client.session.get(G)),(N=this.client.metadata.redirect)!=null&&N.linkMode&&(U=k.metadata.redirect)!=null&&U.linkMode&&(j=k.metadata.redirect)!=null&&j.universal&&n&&(this.client.core.addLinkModeSupportedApp(k.metadata.redirect.universal),this.client.session.update(G,{transportType:de.link_mode})),C({auths:q,session:K})};this.events.once($,m),this.events.once(w,A);let P;try{if(s){const S=wr("wc_sessionAuthenticate",O,L);this.client.core.history.set(b,S);const N=await this.client.core.crypto.encode("",S,{type:bD,encoding:wi});P=bs(n,b,N)}else await Promise.all([this.sendRequest({topic:b,method:"wc_sessionAuthenticate",params:O,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:L}),this.sendRequest({topic:b,method:"wc_sessionPropose",params:_,expiry:Ie.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:_.id})])}catch(S){throw this.events.off($,m),this.events.off(w,A),S}return await this.setProposal(_.id,_),await this.setAuthRequest(L,{request:He(le({},O),{verifyContext:{}}),pairingTopic:b,transportType:o}),{uri:P??E,response:B}}),F(this,"approveSessionAuthenticate",async r=>{const{id:n,auths:i}=r,s=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[_r.authenticated_session_approve_started]}});try{this.isInitialized()}catch(f){throw s.setError(hi.no_internet_connection),f}const o=this.getPendingAuthRequest(n);if(!o)throw s.setError(hi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||de.relay;a===de.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=va(c),h={type:ba,receiverPublicKey:c,senderPublicKey:u},d=[],p=[];for(const f of i){if(!await ed({cacao:f,projectId:this.client.core.projectId})){s.setError(hi.invalid_cacao);const T=ge("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:l,error:T,encodeOpts:h}),new Error(T.message)}s.addTrace(_r.cacaos_verified);const{p:v}=f,b=Bs(v.resources),E=[_c(v.iss)],x=Vs(v.iss);if(b){const T=td(b),I=rd(b);d.push(...T),E.push(...I)}for(const T of E)p.push(`${T}:${x}`)}const g=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(_r.create_authenticated_session_topic);let y;if((d==null?void 0:d.length)>0){y={topic:g,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ze(un),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Ed([...new Set(d)],[...new Set(p)]),transportType:a},s.addTrace(_r.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(f){throw s.setError(hi.subscribe_authenticated_session_topic_failure),f}s.addTrace(_r.subscribe_authenticated_session_topic_success),await this.client.session.set(g,y),s.addTrace(_r.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(_r.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:n,result:{cacaos:i,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(f){throw s.setError(hi.authenticated_session_approve_publish_failure),f}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:y}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:n,reason:i}=r,s=this.getPendingAuthRequest(n);if(!s)throw new Error(`Could not find pending auth request with id ${n}`);s.transportType===de.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=va(o),u={type:ba,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:i,encodeOpts:u,rpcOpts:Ie.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.client.proposal.delete(n,ge("USER_DISCONNECTED"))}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:n,iss:i}=r;return Ug(n,i)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&s.topic&&s.topic!==n.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),F(this,"deleteSession",async r=>{var n;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,ge("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Od).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===i&&this.deletePendingSessionRequest(u.id,ge("USER_DISCONNECTED"))}),i===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=Ut.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),F(this,"deleteProposal",async(r,n)=>{if(n)try{const i=this.client.proposal.get(r),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s==null||s.setError(Ir.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,ge("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,n,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),i&&(this.sessionRequestQueue.state=Ut.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,n,i=!1)=>{await Promise.all([this.client.auth.requests.delete(r,n),i?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,n)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,n),await this.client.session.update(r,{expiry:n}))}),F(this,"setProposal",async(r,n)=>{this.client.core.expirer.set(r,Ze(Ie.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,n)}),F(this,"setAuthRequest",async(r,n)=>{const{request:i,pairingTopic:s,transportType:o=de.relay}=n;this.client.core.expirer.set(r,i.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:r,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:n,topic:i,params:s,verifyContext:o}=r,a=s.request.expiryTimestamp||Ze(Ie.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:i,params:s,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:n,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h}=r,d=wr(i,s,c);let p;const g=!!l;try{const v=g?wi:ms;p=await this.client.core.crypto.encode(n,d,{encoding:v})}catch(v){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),v}let y;if(sx.includes(i)){const v=cn(JSON.stringify(d)),b=cn(p);y=await this.client.core.verify.register({id:b,decryptedId:v})}const f=Ie[i].req;if(f.attestation=y,o&&(f.ttl=o),a&&(f.id=a),this.client.core.history.set(n,d),g){const v=bs(l,n,p);await global.Linking.openURL(v,this.client.name)}else{const v=Ie[i].req;o&&(v.ttl=o),a&&(v.id=a),v.tvf=He(le({},h),{correlationId:d.id}),u?(v.internal=He(le({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,p,v)):this.client.core.relayer.publish(n,p,v).catch(b=>this.client.logger.error(b))}return d.id}),F(this,"sendResult",async r=>{const{id:n,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=lo(n,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=h?wi:ms;l=await this.client.core.crypto.encode(i,u,He(le({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),g}let d,p;try{d=await this.client.core.history.get(i,n);const g=d.request;try{this.shouldSetTVF(g.method,g.params)&&(p=this.getTVFParams(n,g.params,s))}catch(y){this.client.logger.warn("sendResult() -> getTVFParams() failed",y)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${n}) failed`),g}if(h){const g=bs(c,i,l);await global.Linking.openURL(g,this.client.name)}else{const g=d.request.method,y=Ie[g].res;y.tvf=He(le({},p),{correlationId:n}),o?(y.internal=He(le({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,l,y)):this.client.core.relayer.publish(i,l,y).catch(f=>this.client.logger.error(f))}await this.client.core.history.resolve(u)}),F(this,"sendError",async r=>{const{id:n,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=ho(n,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?wi:ms;l=await this.client.core.crypto.encode(i,u,He(le({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),p}let d;try{d=await this.client.core.history.get(i,n)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${i}, ${n}) failed`),p}if(h){const p=bs(c,i,l);await global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=a||Ie[p].res;this.client.core.relayer.publish(i,l,g)}await this.client.core.history.resolve(u)}),F(this,"cleanup",async()=>{const r=[],n=[];this.client.session.getAll().forEach(i=>{let s=!1;sn(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&r.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{sn(i.expiryTimestamp)&&n.push(i.id)}),await Promise.all([...r.map(i=>this.deleteSession({topic:i})),...n.map(i=>this.deleteProposal(i))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Ut.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ut.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Ut.idle}),F(this,"processRequest",async r=>{const{topic:n,payload:i,attestation:s,transportType:o,encryptedId:a}=r,c=i.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,i);case"wc_sessionPing":return await this.onSessionPingRequest(n,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:n,payload:i,transportType:s}=r,o=(await this.client.core.history.get(n,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(n,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,i);case"wc_sessionExtend":return this.onSessionExtendResponse(n,i);case"wc_sessionPing":return this.onSessionPingResponse(n,i);case"wc_sessionRequest":return this.onSessionRequestResponse(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:n}=r,{message:i}=W("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:n,requestMethod:i}=r,s=this.expectedPairingMethodMap.get(n);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:n,payload:i,attestation:s,encryptedId:o}=r,{params:a,id:c}=i;try{const u=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u==null||u.setError(Jt.proposal_listener_not_found)),this.isValidConnect(le({},i.params));const l=a.expiryTimestamp||Ze(Ie.wc_sessionPropose.req.ttl),h=le({id:c,pairingTopic:n,expiryTimestamp:l},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:s,hash:cn(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});u==null||u.addTrace(jt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(u){await this.sendError({id:c,topic:n,error:u,rpcOpts:Ie.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),F(this,"onSessionProposeResponse",async(r,n,i)=>{const{id:s}=n;if(qt(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:r,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(bt(n)){await this.client.proposal.delete(s,ge("USER_DISCONNECTED"));const o=ue("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),F(this,"onSessionSettleRequest",async(r,n)=>{const{id:i,params:s}=n;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=n.params,p=[...this.pendingSessions.values()].find(f=>f.sessionTopic===r);if(!p)return this.client.logger.error(`Pending session not found for topic ${r}`);const g=this.client.proposal.get(p.proposalId),y=He(le(le(le({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:de.relay});await this.client.session.set(y.topic,y),await this.setExpiry(y.topic,y.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:y.peer.metadata}),this.client.events.emit("session_connect",{session:y}),this.events.emit(ue("session_connect",p.proposalId),{session:y}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(y),await this.sendResult({id:n.id,topic:r,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,n)=>{const{id:i}=n;qt(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ue("session_approve",i),{})):bt(n)&&(await this.client.session.delete(r,ge("USER_DISCONNECTED")),this.events.emit(ue("session_approve",i),{error:n.error}))}),F(this,"onSessionUpdateRequest",async(r,n)=>{const{params:i,id:s}=n;try{const o=`${r}_session_update`,a=mi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:r,error:ge("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(le({topic:r},i));try{mi.set(o,s),await this.client.session.update(r,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0})}catch(c){throw mi.delete(o),c}this.client.events.emit("session_update",{id:s,topic:r,params:i})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,n)=>n.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,n)=>{const{id:i}=n,s=ue("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);qt(n)?this.events.emit(ue("session_update",i),{}):bt(n)&&this.events.emit(ue("session_update",i),{error:n.error})}),F(this,"onSessionExtendRequest",async(r,n)=>{const{id:i}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ze(un)),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionExtendResponse",(r,n)=>{const{id:i}=n,s=ue("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);qt(n)?this.events.emit(ue("session_extend",i),{}):bt(n)&&this.events.emit(ue("session_extend",i),{error:n.error})}),F(this,"onSessionPingRequest",async(r,n)=>{const{id:i}=n;try{this.isValidPing({topic:r}),await this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:r})}catch(s){await this.sendError({id:i,topic:r,error:s}),this.client.logger.error(s)}}),F(this,"onSessionPingResponse",(r,n)=>{const{id:i}=n,s=ue("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);qt(n)?this.events.emit(ue("session_ping",i),{}):bt(n)&&this.events.emit(ue("session_ping",i),{error:n.error})},500)}),F(this,"onSessionDeleteRequest",async(r,n)=>{const{id:i}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),Promise.all([new Promise(s=>{this.client.core.relayer.once(xe.publish,async()=>{s(await this.deleteSession({topic:r,id:i}))})}),this.sendResult({id:i,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:ge("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),F(this,"onSessionRequest",async r=>{var n,i,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=r,{id:h,params:d}=a;try{await this.isValidRequest(le({topic:o},d));const p=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:cn(JSON.stringify(wr("wc_sessionRequest",d,h))),encryptedId:u,metadata:p.peer.metadata,transportType:l}),y={id:h,topic:o,params:d,verifyContext:g};await this.setPendingSessionRequest(y),l===de.link_mode&&(n=p.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((i=p.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(y):(this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(r,n)=>{const{id:i}=n,s=ue("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);qt(n)?this.events.emit(ue("session_request",i),{result:n.result}):bt(n)&&this.events.emit(ue("session_request",i),{error:n.error})}),F(this,"onSessionEventRequest",async(r,n)=>{const{id:i,params:s}=n;try{const o=`${r}_session_event_${s.event.name}`,a=mi.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(le({topic:r},s)),this.client.events.emit("session_event",{id:i,topic:r,params:s}),mi.set(o,i)}catch(o){await this.sendError({id:i,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,n)=>{const{id:i}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:n}),qt(n)?this.events.emit(ue("session_request",i),{result:n.result}):bt(n)&&this.events.emit(ue("session_request",i),{error:n.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var n;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:u,authPayload:l,expiryTimestamp:h}=s.params,d=await this.getVerifyContext({attestationId:o,hash:cn(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),p={requester:u,pairingTopic:i,id:s.id,authPayload:l,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:i,transportType:c}),c===de.link_mode&&(n=u.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:d})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:ba,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:i,error:u,encodeOpts:p,rpcOpts:Ie.wc_sessionAuthenticate.autoReject,appLink:d})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ut.idle,this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:n})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=ue("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ue("session_request",s.request.id),{error:n})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Ut.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ut.active,this.emitSessionRequest(r)}catch(n){this.client.logger.error(n)}}),F(this,"emitSessionRequest",r=>{this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const n=this.client.proposal.getAll().find(i=>i.pairingTopic===r.topic);n&&this.onSessionProposeRequest({topic:r.topic,payload:wr("wc_sessionPropose",He(le({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id)})}),F(this,"isValidConnect",async r=>{if(!Ot(r)){const{message:u}=W("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Xe(n)||await this.isValidPairingTopic(n),!HD(c)){const{message:u}=W("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!Xe(i)&&Fi(i)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(i,"requiredNamespaces")}if(!Xe(s)&&Fi(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Xe(o)||this.validateSessionProps(o,"sessionProperties"),!Xe(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),F(this,"validateNamespaces",(r,n)=>{const i=zD(r,"connect()",n);if(i)throw new Error(i.message)}),F(this,"isValidApprove",async r=>{if(!Ot(r))throw new Error(W("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),u=Ea(i,"approve()");if(u)throw new Error(u.message);const l=_d(c.requiredNamespaces,i,"approve()");if(l)throw new Error(l.message);if(!De(s,!0)){const{message:h}=W("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(Xe(o)||this.validateSessionProps(o,"sessionProperties"),!Xe(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(d=>h.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Ot(r)){const{message:s}=W("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:n,reason:i}=r;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!KD(i)){const{message:s}=W("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Ot(r)){const{message:u}=W("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}const{relay:n,controller:i,namespaces:s,expiry:o}=r;if(!ry(n)){const{message:u}=W("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=LD(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Ea(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(sn(o)){const{message:u}=W("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),F(this,"isValidUpdate",async r=>{if(!Ot(r)){const{message:c}=W("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:n,namespaces:i}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const s=this.client.session.get(n),o=Ea(i,"update()");if(o)throw new Error(o.message);const a=_d(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Ot(r)){const{message:i}=W("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(i)}const{topic:n}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),F(this,"isValidRequest",async r=>{if(!Ot(r)){const{message:c}=W("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:n,request:i,chainId:s,expiry:o}=r;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!Id(a,s)){const{message:c}=W("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!WD(i)){const{message:c}=W("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!YD(a,s,i.method)){const{message:c}=W("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!ex(o,_a)){const{message:c}=W("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${_a.min} and ${_a.max}`);throw new Error(c)}}),F(this,"isValidRespond",async r=>{var n;if(!Ot(r)){const{message:o}=W("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:i,response:s}=r;try{await this.isValidSessionTopic(i)}catch(o){throw(n=r==null?void 0:r.response)!=null&&n.id&&this.cleanupAfterResponse(r),o}if(!GD(s)){const{message:o}=W("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),F(this,"isValidPing",async r=>{if(!Ot(r)){const{message:i}=W("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),F(this,"isValidEmit",async r=>{if(!Ot(r)){const{message:a}=W("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:n,event:i,chainId:s}=r;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!Id(o,s)){const{message:a}=W("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!ZD(i)){const{message:a}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!JD(o,s,i.name)){const{message:a}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Ot(r)){const{message:i}=W("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(i)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)}),F(this,"isValidAuthenticate",r=>{const{chains:n,uri:i,domain:s,nonce:o}=r;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!De(i,!1))throw new Error("uri is required parameter");if(!De(s,!1))throw new Error("domain is required parameter");if(!De(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Rs(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Rs(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:n,hash:i,encryptedId:s,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||xi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===de.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:n,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,n)=>{Object.values(r).forEach((i,s)=>{if(i==null){const{message:o}=W("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${i} for key ${Object.keys(r)[s]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const n=this.client.auth.requests.get(r);return typeof n=="object"?n:void 0}),F(this,"addToRecentlyDeleted",(r,n)=>{if(this.recentlyDeletedMap.set(r,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const n=this.recentlyDeletedMap.get(r);if(n){const{message:i}=W("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${r}`);throw new Error(i)}}),F(this,"isLinkModeEnabled",(r,n)=>{var i,s,o,a,c,u,l,h,d;return!r||n!==de.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=r==null?void 0:r.redirect)==null?void 0:l.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((d=r==null?void 0:r.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,n)=>{var i;return this.isLinkModeEnabled(r,n)?(i=r==null?void 0:r.redirect)==null?void 0:i.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const n=Kh(r,"topic")||"",i=decodeURIComponent(Kh(r,"wc_ev")||""),s=this.client.session.keys.includes(n);s&&this.client.session.update(n,{transportType:de.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:i,sessionExists:s})}),F(this,"registerLinkModeListeners",async()=>{var r;if(o8()||Og()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await n.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),F(this,"shouldSetTVF",(r,n)=>{if(!n||r!=="wc_sessionRequest")return!1;const{request:i}=n;return Object.keys(Dd).includes(i.method)}),F(this,"getTVFParams",(r,n,i)=>{var s,o;try{const a=n.request.method,c=this.extractTxHashesFromResult(a,i);return He(le({correlationId:r,rpcMethods:[a],chainId:n.chainId},this.isValidContractData(n.request.params)&&{contractAddresses:[(o=(s=n.request.params)==null?void 0:s[0])==null?void 0:o.to]}),{txHashes:c})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),F(this,"isValidContractData",r=>{var n;if(!r)return!1;try{const i=(r==null?void 0:r.data)||((n=r==null?void 0:r[0])==null?void 0:n.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,n)=>{try{const i=Dd[r];if(typeof n=="string")return[n];const s=n[i.key];if(rs(s))return r==="solana_signAllTransactions"?s.map(o=>j8(o)):s;if(typeof s=="string")return[s]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,i]of Object.entries(r))for(const s of i)try{await this.onProviderMessageEvent({topic:n,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(xe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:n,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Us)?this.client.auth.authKeys.get(Us):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,n,{receiverPublicKey:o,encoding:s===de.link_mode?wi:ms});uu(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:i,transportType:s,encryptedId:cn(n)})):fo(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:s}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(r,n)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(mt.expired,async e=>{const{topic:r,id:n}=t8(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,W("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,W("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Dr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Dr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!De(e,!1)){const{message:r}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(sn(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=W("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!De(e,!1)){const{message:r}=W("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=W("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(sn(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=W("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=W("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(De(e,!1)){const{message:r}=W("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=W("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!VD(e)){const{message:r}=W("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=W("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(sn(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=W("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}},wx=class extends Zr{constructor(e,r){super(e,r,tx,wu),this.core=e,this.logger=r}},mx=class extends Zr{constructor(e,r){super(e,r,rx,wu),this.core=e,this.logger=r}},bx=class extends Zr{constructor(e,r){super(e,r,ix,wu,n=>n.id),this.core=e,this.logger=r}},vx=class extends Zr{constructor(e,r){super(e,r,cx,Eo,()=>Us),this.core=e,this.logger=r}},Ex=class extends Zr{constructor(e,r){super(e,r,ux,Eo),this.core=e,this.logger=r}},$x=class extends Zr{constructor(e,r){super(e,r,lx,Eo,n=>n.id),this.core=e,this.logger=r}};var Ix=Object.defineProperty,_x=(t,e,r)=>e in t?Ix(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sa=(t,e,r)=>_x(t,typeof e!="symbol"?e+"":e,r);let Sx=class{constructor(e,r){this.core=e,this.logger=r,Sa(this,"authKeys"),Sa(this,"pairingTopics"),Sa(this,"requests"),this.authKeys=new vx(this.core,this.logger),this.pairingTopics=new Ex(this.core,this.logger),this.requests=new $x(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}};var Ox=Object.defineProperty,Ax=(t,e,r)=>e in t?Ox(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,J=(t,e,r)=>Ax(t,typeof e!="symbol"?e+"":e,r);let Dx=class oy extends Km{constructor(e){super(e),J(this,"protocol",ny),J(this,"version",iy),J(this,"name",Ia.name),J(this,"metadata"),J(this,"core"),J(this,"logger"),J(this,"events",new pt.EventEmitter),J(this,"engine"),J(this,"session"),J(this,"proposal"),J(this,"pendingRequest"),J(this,"auth"),J(this,"signConfig"),J(this,"on",(n,i)=>this.events.on(n,i)),J(this,"once",(n,i)=>this.events.once(n,i)),J(this,"off",(n,i)=>this.events.off(n,i)),J(this,"removeListener",(n,i)=>this.events.removeListener(n,i)),J(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),J(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"update",async n=>{try{return await this.engine.update(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"request",async n=>{try{return await this.engine.request(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"find",n=>{try{return this.engine.find(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),J(this,"authenticate",async(n,i)=>{try{return await this.engine.authenticate(n,i)}catch(s){throw this.logger.error(s.message),s}}),J(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),J(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Ia.name,this.metadata=XO(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Hi(Qs({level:(e==null?void 0:e.logger)||Ia.logger}));this.core=(e==null?void 0:e.core)||new QS(e),this.logger=Ke(r,this.name),this.session=new mx(this.core,this.logger),this.proposal=new wx(this.core,this.logger),this.pendingRequest=new bx(this.core,this.logger),this.engine=new yx(this),this.auth=new Sx(this.core,this.logger)}static async init(e){const r=new oy(e);return await r.initialize(),r}get context(){return rt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},M.toMiliseconds(M.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var vs={exports:{}},Pd;function xx(){return Pd||(Pd=1,(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Ft<"u"&&Ft,n=(function(){function s(){this.fetch=!1,this.DOMException=r.DOMException}return s.prototype=r,new s})();(function(s){(function(o){var a=typeof s<"u"&&s||typeof self<"u"&&self||typeof Ft<"u"&&Ft||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function u(w){return w&&DataView.prototype.isPrototypeOf(w)}if(c.arrayBuffer)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(w){return w&&l.indexOf(Object.prototype.toString.call(w))>-1};function d(w){if(typeof w!="string"&&(w=String(w)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(w)||w==="")throw new TypeError('Invalid character in header field name: "'+w+'"');return w.toLowerCase()}function p(w){return typeof w!="string"&&(w=String(w)),w}function g(w){var m={next:function(){var A=w.shift();return{done:A===void 0,value:A}}};return c.iterable&&(m[Symbol.iterator]=function(){return m}),m}function y(w){this.map={},w instanceof y?w.forEach(function(m,A){this.append(A,m)},this):Array.isArray(w)?w.forEach(function(m){if(m.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+m.length);this.append(m[0],m[1])},this):w&&Object.getOwnPropertyNames(w).forEach(function(m){this.append(m,w[m])},this)}y.prototype.append=function(w,m){w=d(w),m=p(m);var A=this.map[w];this.map[w]=A?A+", "+m:m},y.prototype.delete=function(w){delete this.map[d(w)]},y.prototype.get=function(w){return w=d(w),this.has(w)?this.map[w]:null},y.prototype.has=function(w){return this.map.hasOwnProperty(d(w))},y.prototype.set=function(w,m){this.map[d(w)]=p(m)},y.prototype.forEach=function(w,m){for(var A in this.map)this.map.hasOwnProperty(A)&&w.call(m,this.map[A],A,this)},y.prototype.keys=function(){var w=[];return this.forEach(function(m,A){w.push(A)}),g(w)},y.prototype.values=function(){var w=[];return this.forEach(function(m){w.push(m)}),g(w)},y.prototype.entries=function(){var w=[];return this.forEach(function(m,A){w.push([A,m])}),g(w)},c.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function f(w){if(!w._noBody){if(w.bodyUsed)return Promise.reject(new TypeError("Already read"));w.bodyUsed=!0}}function v(w){return new Promise(function(m,A){w.onload=function(){m(w.result)},w.onerror=function(){A(w.error)}})}function b(w){var m=new FileReader,A=v(m);return m.readAsArrayBuffer(w),A}function E(w){var m=new FileReader,A=v(m),P=/charset=([A-Za-z0-9_-]+)/.exec(w.type),S=P?P[1]:"utf-8";return m.readAsText(w,S),A}function x(w){for(var m=new Uint8Array(w),A=new Array(m.length),P=0;P<m.length;P++)A[P]=String.fromCharCode(m[P]);return A.join("")}function T(w){if(w.slice)return w.slice(0);var m=new Uint8Array(w.byteLength);return m.set(new Uint8Array(w)),m.buffer}function I(){return this.bodyUsed=!1,this._initBody=function(w){this.bodyUsed=this.bodyUsed,this._bodyInit=w,w?typeof w=="string"?this._bodyText=w:c.blob&&Blob.prototype.isPrototypeOf(w)?this._bodyBlob=w:c.formData&&FormData.prototype.isPrototypeOf(w)?this._bodyFormData=w:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)?this._bodyText=w.toString():c.arrayBuffer&&c.blob&&u(w)?(this._bodyArrayBuffer=T(w.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(w)||h(w))?this._bodyArrayBuffer=T(w):this._bodyText=w=Object.prototype.toString.call(w):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof w=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var w=f(this);if(w)return w;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var w=f(this);return w||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(b);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var w=f(this);if(w)return w;if(this._bodyBlob)return E(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(x(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(B)}),this.json=function(){return this.text().then(JSON.parse)},this}var O=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function D(w){var m=w.toUpperCase();return O.indexOf(m)>-1?m:w}function _(w,m){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');m=m||{};var A=m.body;if(w instanceof _){if(w.bodyUsed)throw new TypeError("Already read");this.url=w.url,this.credentials=w.credentials,m.headers||(this.headers=new y(w.headers)),this.method=w.method,this.mode=w.mode,this.signal=w.signal,!A&&w._bodyInit!=null&&(A=w._bodyInit,w.bodyUsed=!0)}else this.url=String(w);if(this.credentials=m.credentials||this.credentials||"same-origin",(m.headers||!this.headers)&&(this.headers=new y(m.headers)),this.method=D(m.method||this.method||"GET"),this.mode=m.mode||this.mode||null,this.signal=m.signal||this.signal||(function(){if("AbortController"in a){var N=new AbortController;return N.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&A)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(A),(this.method==="GET"||this.method==="HEAD")&&(m.cache==="no-store"||m.cache==="no-cache")){var P=/([?&])_=[^&]*/;if(P.test(this.url))this.url=this.url.replace(P,"$1_="+new Date().getTime());else{var S=/\?/;this.url+=(S.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}_.prototype.clone=function(){return new _(this,{body:this._bodyInit})};function B(w){var m=new FormData;return w.trim().split("&").forEach(function(A){if(A){var P=A.split("="),S=P.shift().replace(/\+/g," "),N=P.join("=").replace(/\+/g," ");m.append(decodeURIComponent(S),decodeURIComponent(N))}}),m}function C(w){var m=new y,A=w.replace(/\r?\n[\t ]+/g," ");return A.split("\r").map(function(P){return P.indexOf(`
`)===0?P.substr(1,P.length):P}).forEach(function(P){var S=P.split(":"),N=S.shift().trim();if(N){var U=S.join(":").trim();try{m.append(N,U)}catch(j){console.warn("Response "+j.message)}}}),m}I.call(_.prototype);function R(w,m){if(!(this instanceof R))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(m||(m={}),this.type="default",this.status=m.status===void 0?200:m.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=m.statusText===void 0?"":""+m.statusText,this.headers=new y(m.headers),this.url=m.url||"",this._initBody(w)}I.call(R.prototype),R.prototype.clone=function(){return new R(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},R.error=function(){var w=new R(null,{status:200,statusText:""});return w.ok=!1,w.status=0,w.type="error",w};var L=[301,302,303,307,308];R.redirect=function(w,m){if(L.indexOf(m)===-1)throw new RangeError("Invalid status code");return new R(null,{status:m,headers:{location:w}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(m,A){this.message=m,this.name=A;var P=Error(m);this.stack=P.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function $(w,m){return new Promise(function(A,P){var S=new _(w,m);if(S.signal&&S.signal.aborted)return P(new o.DOMException("Aborted","AbortError"));var N=new XMLHttpRequest;function U(){N.abort()}N.onload=function(){var k={statusText:N.statusText,headers:C(N.getAllResponseHeaders()||"")};S.url.indexOf("file://")===0&&(N.status<200||N.status>599)?k.status=200:k.status=N.status,k.url="responseURL"in N?N.responseURL:k.headers.get("X-Request-URL");var z="response"in N?N.response:N.responseText;setTimeout(function(){A(new R(z,k))},0)},N.onerror=function(){setTimeout(function(){P(new TypeError("Network request failed"))},0)},N.ontimeout=function(){setTimeout(function(){P(new TypeError("Network request timed out"))},0)},N.onabort=function(){setTimeout(function(){P(new o.DOMException("Aborted","AbortError"))},0)};function j(k){try{return k===""&&a.location.href?a.location.href:k}catch{return k}}if(N.open(S.method,j(S.url),!0),S.credentials==="include"?N.withCredentials=!0:S.credentials==="omit"&&(N.withCredentials=!1),"responseType"in N&&(c.blob?N.responseType="blob":c.arrayBuffer&&(N.responseType="arraybuffer")),m&&typeof m.headers=="object"&&!(m.headers instanceof y||a.Headers&&m.headers instanceof a.Headers)){var q=[];Object.getOwnPropertyNames(m.headers).forEach(function(k){q.push(d(k)),N.setRequestHeader(k,p(m.headers[k]))}),S.headers.forEach(function(k,z){q.indexOf(z)===-1&&N.setRequestHeader(z,k)})}else S.headers.forEach(function(k,z){N.setRequestHeader(z,k)});S.signal&&(S.signal.addEventListener("abort",U),N.onreadystatechange=function(){N.readyState===4&&S.signal.removeEventListener("abort",U)}),N.send(typeof S._bodyInit>"u"?null:S._bodyInit)})}return $.polyfill=!0,a.fetch||(a.fetch=$,a.Headers=y,a.Request=_,a.Response=R),o.Headers=y,o.Request=_,o.Response=R,o.fetch=$,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=r.fetch?r:n;e=i.fetch,e.default=i.fetch,e.fetch=i.fetch,e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response,t.exports=e})(vs,vs.exports)),vs.exports}var Px=xx();const Cd=Kc(Px);var Cx=Object.defineProperty,Tx=Object.defineProperties,Nx=Object.getOwnPropertyDescriptors,Td=Object.getOwnPropertySymbols,Rx=Object.prototype.hasOwnProperty,Bx=Object.prototype.propertyIsEnumerable,Nd=(t,e,r)=>e in t?Cx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rd=(t,e)=>{for(var r in e||(e={}))Rx.call(e,r)&&Nd(t,r,e[r]);if(Td)for(var r of Td(e))Bx.call(e,r)&&Nd(t,r,e[r]);return t},Bd=(t,e)=>Tx(t,Nx(e));const Ux={Accept:"application/json","Content-Type":"application/json"},Lx="POST",Ud={headers:Ux,method:Lx},Ld=10;let Ct=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new pt.EventEmitter,this.isAvailable=!1,this.registering=!1,!oh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=ar(e),n=await(await Cd(this.url,Bd(Rd({},Ud),{body:r}))).json();this.onPayload({data:n})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!oh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return i(new Error("HTTP connection is missing or invalid"));n()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=ar({id:1,jsonrpc:"2.0",method:"test",params:[]});await Cd(e,Bd(Rd({},Ud),{body:r}))}this.onOpen()}catch(r){const n=this.parseError(r);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?kr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=ho(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return Kp(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Ld&&this.events.setMaxListeners(Ld)}};function jx(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0;const p=u.length;for(;d!==p&&u[d]===0;)d++,l++;const g=(p-d)*s+1>>>0,y=new Uint8Array(g);for(;d!==p;){let b=u[d],E=0;for(let x=g-1;(b!==0||E<h)&&x!==-1;x--,E++)b+=256*y[x]>>>0,y[x]=b%r>>>0,b=b/r>>>0;if(b!==0)throw new Error("Non-zero carry");h=E,d++}let f=g-h;for(;f!==g&&y[f]===0;)f++;let v=n.repeat(l);for(;f<g;++f)v+=t.charAt(y[f]);return v}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===n;)h++,l++;const p=(u.length-l)*i+1>>>0,g=new Uint8Array(p);for(;l<u.length;){const b=u.charCodeAt(l);if(b>255)return;let E=e[b];if(E===255)return;let x=0;for(let T=p-1;(E!==0||x<d)&&T!==-1;T--,x++)E+=r*g[T]>>>0,g[T]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");d=x,l++}let y=p-d;for(;y!==p&&g[y]===0;)y++;const f=new Uint8Array(h+(p-y));let v=h;for(;y!==p;)f[v++]=g[y++];return f}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var kx="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";jx(kx);const qx=":";function ay(t){const[e,r]=t.split(qx);return{namespace:e,reference:r}}function jd(t,e=[]){const r=[];return Object.keys(t).forEach(n=>{if(e.length&&!e.includes(n))return;const i=t[n];r.push(...i.accounts)}),r}function Oa(t=[],e=[]){return[...new Set([...t,...e])]}function Ws(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Fx(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ns(t,...e){if(!Fx(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Mx(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ws(t.outputLen),Ws(t.blockLen)}function Hn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function cy(t,e){ns(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Es=BigInt(2**32-1),kd=BigInt(32);function zx(t,e=!1){return e?{h:Number(t&Es),l:Number(t>>kd&Es)}:{h:Number(t>>kd&Es)|0,l:Number(t&Es)|0}}function Hx(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=zx(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const Vx=(t,e,r)=>t<<r|e>>>32-r,Kx=(t,e,r)=>e<<r|t>>>32-r,Wx=(t,e,r)=>e<<r-32|t>>>64-r,Gx=(t,e,r)=>t<<r-32|e>>>64-r,ln=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Zx(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Aa(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Lt(t,e){return t<<32-e|t>>>e}const qd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Yx(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Fd(t){for(let e=0;e<t.length;e++)t[e]=Yx(t[e])}function Jx(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function $o(t){return typeof t=="string"&&(t=Jx(t)),ns(t),t}function Qx(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];ns(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}let mu=class{clone(){return this._cloneInto()}};function uy(t){const e=n=>t().update($o(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function ly(t=32){if(ln&&typeof ln.getRandomValues=="function")return ln.getRandomValues(new Uint8Array(t));if(ln&&typeof ln.randomBytes=="function")return ln.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const hy=[],dy=[],fy=[],Xx=BigInt(0),bi=BigInt(1),eP=BigInt(2),tP=BigInt(7),rP=BigInt(256),nP=BigInt(113);for(let t=0,e=bi,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],hy.push(2*(5*n+r)),dy.push((t+1)*(t+2)/2%64);let i=Xx;for(let s=0;s<7;s++)e=(e<<bi^(e>>tP)*nP)%rP,e&eP&&(i^=bi<<(bi<<BigInt(s))-bi);fy.push(i)}const[iP,sP]=Hx(fy,!0),Md=(t,e,r)=>r>32?Wx(t,e,r):Vx(t,e,r),zd=(t,e,r)=>r>32?Gx(t,e,r):Kx(t,e,r);function oP(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=Md(u,l,1)^r[a],d=zd(u,l,1)^r[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=dy[o],c=Md(i,s,a),u=zd(i,s,a),l=hy[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=iP[n],t[1]^=sP[n]}r.fill(0)}class bu extends mu{constructor(e,r,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ws(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Zx(this.state)}keccak(){qd||Fd(this.state32),oP(this.state32,this.rounds),qd||Fd(this.state32),this.posOut=0,this.pos=0}update(e){Hn(this);const{blockLen:r,state:n}=this;e=$o(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Hn(this,!1),ns(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ws(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(cy(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new bu(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const aP=(t,e,r)=>uy(()=>new bu(e,t,r));aP(1,136,256/8);function Da(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function py(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ht(t,...e){if(!py(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Hd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function cP(t,e){ht(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Vd(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const vr=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),uP=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),lP=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!lP)throw new Error("Non little-endian hardware is not supported");function hP(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Rc(t){if(typeof t=="string")t=hP(t);else if(py(t))t=Bc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function dP(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function fP(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const pP=(t,e)=>{function r(n,...i){if(ht(n),t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?ht(u):ht(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&ht(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");ht(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,ht(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(ht(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Kd(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!gP(e))throw new Error("invalid output, must be aligned");return e}function Wd(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function gP(t){return t.byteOffset%4===0}function Bc(t){return Uint8Array.from(t)}function Vn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const gy=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),yP=gy("expand 16-byte k"),wP=gy("expand 32-byte k"),mP=vr(yP),bP=vr(wP);function te(t,e){return t<<e|t>>>32-e}function Uc(t){return t.byteOffset%4===0}const $s=64,vP=16,yy=2**32-1,Gd=new Uint32Array;function EP(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array($s),l=vr(u),h=Uc(i)&&Uc(s),d=h?vr(i):Gd,p=h?vr(s):Gd;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=yy)throw new Error("arx: counter overflow");const y=Math.min($s,c-g);if(h&&y===$s){const f=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let v=0,b;v<vP;v++)b=f+v,p[b]=d[b]^l[v];g+=$s;continue}for(let f=0,v;f<y;f++)v=g+f,s[v]=i[v]^u[f];g+=y}}function $P(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=dP({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Da(i),Da(o),Vd(s),Vd(r),(a,c,u,l,h=0)=>{ht(a),ht(c),ht(u);const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),ht(l),Da(h),h<0||h>=yy)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const p=[];let g=a.length,y,f;if(g===32)p.push(y=Bc(a)),f=bP;else if(g===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),f=mP,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Uc(c)||p.push(c=Bc(c));const v=vr(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(f,v,vr(c.subarray(0,16)),v),c=c.subarray(16)}const b=16-i;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const x=new Uint8Array(12);x.set(c,s?0:12-c.length),c=x,p.push(c)}const E=vr(c);return EP(t,f,v,E,u,l,h,o),Vn(...p),l}}const je=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class IP{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Rc(e),ht(e,32);const r=je(e,0),n=je(e,2),i=je(e,4),s=je(e,6),o=je(e,8),a=je(e,10),c=je(e,12),u=je(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=je(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],p=o[6],g=o[7],y=o[8],f=o[9],v=je(e,r+0),b=je(e,r+2),E=je(e,r+4),x=je(e,r+6),T=je(e,r+8),I=je(e,r+10),O=je(e,r+12),D=je(e,r+14);let _=s[0]+(v&8191),B=s[1]+((v>>>13|b<<3)&8191),C=s[2]+((b>>>10|E<<6)&8191),R=s[3]+((E>>>7|x<<9)&8191),L=s[4]+((x>>>4|T<<12)&8191),$=s[5]+(T>>>1&8191),w=s[6]+((T>>>14|I<<2)&8191),m=s[7]+((I>>>11|O<<5)&8191),A=s[8]+((O>>>8|D<<8)&8191),P=s[9]+(D>>>5|i),S=0,N=S+_*a+B*(5*f)+C*(5*y)+R*(5*g)+L*(5*p);S=N>>>13,N&=8191,N+=$*(5*d)+w*(5*h)+m*(5*l)+A*(5*u)+P*(5*c),S+=N>>>13,N&=8191;let U=S+_*c+B*a+C*(5*f)+R*(5*y)+L*(5*g);S=U>>>13,U&=8191,U+=$*(5*p)+w*(5*d)+m*(5*h)+A*(5*l)+P*(5*u),S+=U>>>13,U&=8191;let j=S+_*u+B*c+C*a+R*(5*f)+L*(5*y);S=j>>>13,j&=8191,j+=$*(5*g)+w*(5*p)+m*(5*d)+A*(5*h)+P*(5*l),S+=j>>>13,j&=8191;let q=S+_*l+B*u+C*c+R*a+L*(5*f);S=q>>>13,q&=8191,q+=$*(5*y)+w*(5*g)+m*(5*p)+A*(5*d)+P*(5*h),S+=q>>>13,q&=8191;let k=S+_*h+B*l+C*u+R*c+L*a;S=k>>>13,k&=8191,k+=$*(5*f)+w*(5*y)+m*(5*g)+A*(5*p)+P*(5*d),S+=k>>>13,k&=8191;let z=S+_*d+B*h+C*l+R*u+L*c;S=z>>>13,z&=8191,z+=$*a+w*(5*f)+m*(5*y)+A*(5*g)+P*(5*p),S+=z>>>13,z&=8191;let H=S+_*p+B*d+C*h+R*l+L*u;S=H>>>13,H&=8191,H+=$*c+w*a+m*(5*f)+A*(5*y)+P*(5*g),S+=H>>>13,H&=8191;let G=S+_*g+B*p+C*d+R*h+L*l;S=G>>>13,G&=8191,G+=$*u+w*c+m*a+A*(5*f)+P*(5*y),S+=G>>>13,G&=8191;let K=S+_*y+B*g+C*p+R*d+L*h;S=K>>>13,K&=8191,K+=$*l+w*u+m*c+A*a+P*(5*f),S+=K>>>13,K&=8191;let V=S+_*f+B*y+C*g+R*p+L*d;S=V>>>13,V&=8191,V+=$*h+w*l+m*u+A*c+P*a,S+=V>>>13,V&=8191,S=(S<<2)+S|0,S=S+N|0,N=S&8191,S=S>>>13,U+=S,s[0]=N,s[1]=U,s[2]=j,s[3]=q,s[4]=k,s[5]=z,s[6]=H,s[7]=G,s[8]=K,s[9]=V}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Vn(n)}update(e){Hd(this);const{buffer:r,blockLen:n}=this;e=Rc(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Vn(this.h,this.r,this.buffer,this.pad)}digestInto(e){Hd(this),cP(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function _P(t){const e=(n,i)=>t(i).update(Rc(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const SP=_P(t=>new IP(t));function OP(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],d=e[2],p=e[3],g=e[4],y=e[5],f=e[6],v=e[7],b=i,E=r[0],x=r[1],T=r[2],I=o,O=a,D=c,_=u,B=l,C=h,R=d,L=p,$=g,w=y,m=f,A=v,P=b,S=E,N=x,U=T;for(let q=0;q<s;q+=2)I=I+B|0,P=te(P^I,16),$=$+P|0,B=te(B^$,12),I=I+B|0,P=te(P^I,8),$=$+P|0,B=te(B^$,7),O=O+C|0,S=te(S^O,16),w=w+S|0,C=te(C^w,12),O=O+C|0,S=te(S^O,8),w=w+S|0,C=te(C^w,7),D=D+R|0,N=te(N^D,16),m=m+N|0,R=te(R^m,12),D=D+R|0,N=te(N^D,8),m=m+N|0,R=te(R^m,7),_=_+L|0,U=te(U^_,16),A=A+U|0,L=te(L^A,12),_=_+L|0,U=te(U^_,8),A=A+U|0,L=te(L^A,7),I=I+C|0,U=te(U^I,16),m=m+U|0,C=te(C^m,12),I=I+C|0,U=te(U^I,8),m=m+U|0,C=te(C^m,7),O=O+R|0,P=te(P^O,16),A=A+P|0,R=te(R^A,12),O=O+R|0,P=te(P^O,8),A=A+P|0,R=te(R^A,7),D=D+L|0,S=te(S^D,16),$=$+S|0,L=te(L^$,12),D=D+L|0,S=te(S^D,8),$=$+S|0,L=te(L^$,7),_=_+B|0,N=te(N^_,16),w=w+N|0,B=te(B^w,12),_=_+B|0,N=te(N^_,8),w=w+N|0,B=te(B^w,7);let j=0;n[j++]=o+I|0,n[j++]=a+O|0,n[j++]=c+D|0,n[j++]=u+_|0,n[j++]=l+B|0,n[j++]=h+C|0,n[j++]=d+R|0,n[j++]=p+L|0,n[j++]=g+$|0,n[j++]=y+w|0,n[j++]=f+m|0,n[j++]=v+A|0,n[j++]=b+P|0,n[j++]=E+S|0,n[j++]=x+N|0,n[j++]=T+U|0}const AP=$P(OP,{counterRight:!1,counterLength:4,allowShortKeys:!1}),DP=new Uint8Array(16),Zd=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(DP.subarray(r))},xP=new Uint8Array(32);function Yd(t,e,r,n,i){const s=t(e,r,xP),o=SP.create(s);i&&Zd(o,i),Zd(o,n);const a=new Uint8Array(16),c=uP(a);Wd(c,0,BigInt(i?i.length:0),!0),Wd(c,8,BigInt(n.length),!0),o.update(a);const u=o.digest();return Vn(s,a),u}const PP=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=Kd(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=Yd(t,e,r,a,n);return s.set(c,o),Vn(c),s},decrypt(i,s){s=Kd(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=Yd(t,e,r,o,n);if(!fP(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Vn(c),s}});pP({blockSize:64,nonceLength:12,tagLength:16},PP(AP));class wy extends mu{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Mx(e);const n=$o(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Hn(this),this.iHash.update(e),this}digestInto(e){Hn(this),ns(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const my=(t,e,r)=>new wy(t,e).update(r).digest();my.create=(t,e)=>new wy(t,e);function CP(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function TP(t,e,r){return t&e^~t&r}function NP(t,e,r){return t&e^t&r^e&r}class RP extends mu{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Aa(this.buffer)}update(e){Hn(this);const{view:r,buffer:n,blockLen:i}=this;e=$o(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Aa(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Hn(this),cy(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;CP(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Aa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}}const BP=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),pr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),gr=new Uint32Array(64);class UP extends RP{constructor(){super(64,32,8,!1),this.A=pr[0]|0,this.B=pr[1]|0,this.C=pr[2]|0,this.D=pr[3]|0,this.E=pr[4]|0,this.F=pr[5]|0,this.G=pr[6]|0,this.H=pr[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)gr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const d=gr[h-15],p=gr[h-2],g=Lt(d,7)^Lt(d,18)^d>>>3,y=Lt(p,17)^Lt(p,19)^p>>>10;gr[h]=y+gr[h-7]+g+gr[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=Lt(a,6)^Lt(a,11)^Lt(a,25),p=l+d+TP(a,c,u)+BP[h]+gr[h]|0,g=(Lt(n,2)^Lt(n,13)^Lt(n,22))+NP(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){gr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const LP=uy(()=>new UP);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Io=BigInt(0),_o=BigInt(1),jP=BigInt(2);function Vr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function is(t){if(!Vr(t))throw new Error("Uint8Array expected")}function Kn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const kP=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Wn(t){is(t);let e="";for(let r=0;r<t.length;r++)e+=kP[t[r]];return e}function Dn(t){const e=t.toString(16);return e.length&1?"0"+e:e}function vu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Io:BigInt("0x"+t)}const Yt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Jd(t){if(t>=Yt._0&&t<=Yt._9)return t-Yt._0;if(t>=Yt.A&&t<=Yt.F)return t-(Yt.A-10);if(t>=Yt.a&&t<=Yt.f)return t-(Yt.a-10)}function Gn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=Jd(t.charCodeAt(s)),a=Jd(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function jr(t){return vu(Wn(t))}function Mi(t){return is(t),vu(Wn(Uint8Array.from(t).reverse()))}function Zn(t,e){return Gn(t.toString(16).padStart(e*2,"0"))}function So(t,e){return Zn(t,e).reverse()}function qP(t){return Gn(Dn(t))}function ct(t,e,r){let n;if(typeof e=="string")try{n=Gn(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Vr(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function zi(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];is(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}function FP(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function MP(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}const xa=t=>typeof t=="bigint"&&Io<=t;function Oo(t,e,r){return xa(t)&&xa(e)&&xa(r)&&e<=t&&t<r}function or(t,e,r,n){if(!Oo(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function by(t){let e;for(e=0;t>Io;t>>=_o,e+=1);return e}function zP(t,e){return t>>BigInt(e)&_o}function HP(t,e,r){return t|(r?_o:Io)<<BigInt(e)}const Eu=t=>(jP<<BigInt(t-1))-_o,Pa=t=>new Uint8Array(t),Qd=t=>Uint8Array.from(t);function vy(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Pa(t),i=Pa(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...l)=>r(i,n,...l),c=(l=Pa())=>{i=a(Qd([0]),l),n=a(),l.length!==0&&(i=a(Qd([1]),l),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<e;){n=a();const d=n.slice();h.push(d),l+=n.length}return zi(...h)};return(l,h)=>{o(),c(l);let d;for(;!(d=h(u()));)c();return o(),d}}const VP={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Vr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ii(t,e,r={}){const n=(i,s,o)=>{const a=VP[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}const KP=()=>{throw new Error("not implemented")};function Lc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}var WP=Object.freeze({__proto__:null,isBytes:Vr,abytes:is,abool:Kn,bytesToHex:Wn,numberToHexUnpadded:Dn,hexToNumber:vu,hexToBytes:Gn,bytesToNumberBE:jr,bytesToNumberLE:Mi,numberToBytesBE:Zn,numberToBytesLE:So,numberToVarBytesBE:qP,ensureBytes:ct,concatBytes:zi,equalBytes:FP,utf8ToBytes:MP,inRange:Oo,aInRange:or,bitLen:by,bitGet:zP,bitSet:HP,bitMask:Eu,createHmacDrbg:vy,validateObject:ii,notImplemented:KP,memoized:Lc});const Ne=BigInt(0),be=BigInt(1),Pr=BigInt(2),GP=BigInt(3),jc=BigInt(4),Xd=BigInt(5),ef=BigInt(8);function et(t,e){const r=t%e;return r>=Ne?r:e+r}function Ey(t,e,r){if(e<Ne)throw new Error("invalid exponent, negatives unsupported");if(r<=Ne)throw new Error("invalid modulus");if(r===be)return Ne;let n=be;for(;e>Ne;)e&be&&(n=n*t%r),t=t*t%r,e>>=be;return n}function xt(t,e,r){let n=t;for(;e-- >Ne;)n*=n,n%=r;return n}function kc(t,e){if(t===Ne)throw new Error("invert: expected non-zero number");if(e<=Ne)throw new Error("invert: expected positive modulus, got "+e);let r=et(t,e),n=e,i=Ne,s=be;for(;r!==Ne;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==be)throw new Error("invert: does not exist");return et(i,e)}function ZP(t){const e=(t-be)/Pr;let r,n,i;for(r=t-be,n=0;r%Pr===Ne;r/=Pr,n++);for(i=Pr;i<t&&Ey(i,e,t)!==t-be;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+be)/jc;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+be)/Pr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let g=o.sqr(h);d<c&&!o.eql(g,o.ONE);d++)g=o.sqr(g);const p=o.pow(u,be<<BigInt(c-d-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=d}return l}}function YP(t){if(t%jc===GP){const e=(t+be)/jc;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%ef===Xd){const e=(t-Xd)/ef;return function(r,n){const i=r.mul(n,Pr),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,Pr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return ZP(t)}const JP=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function QP(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=JP.reduce((n,i)=>(n[i]="function",n),e);return ii(t,r)}function XP(t,e,r){if(r<Ne)throw new Error("invalid exponent, negatives unsupported");if(r===Ne)return t.ONE;if(r===be)return e;let n=t.ONE,i=e;for(;r>Ne;)r&be&&(n=t.mul(n,i)),i=t.sqr(i),r>>=be;return n}function e5(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function $y(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Iy(t,e,r=!1,n={}){if(t<=Ne)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=$y(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Eu(i),ZERO:Ne,ONE:be,create:c=>et(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ne<=c&&c<t},is0:c=>c===Ne,isOdd:c=>(c&be)===be,neg:c=>et(-c,t),eql:(c,u)=>c===u,sqr:c=>et(c*c,t),add:(c,u)=>et(c+u,t),sub:(c,u)=>et(c-u,t),mul:(c,u)=>et(c*u,t),pow:(c,u)=>XP(a,c,u),div:(c,u)=>et(c*kc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>kc(c,t),sqrt:n.sqrt||(c=>(o||(o=YP(t)),o(a,c))),invertBatch:c=>e5(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?So(c,s):Zn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Mi(c):jr(c)}});return Object.freeze(a)}function _y(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Sy(t){const e=_y(t);return e+Math.ceil(e/2)}function t5(t,e,r=!1){const n=t.length,i=_y(e),s=Sy(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?Mi(t):jr(t),a=et(o,e-be)+be;return r?So(a,i):Zn(a,i)}const tf=BigInt(0),Is=BigInt(1);function Ca(t,e){const r=e.negate();return t?r:e}function Oy(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ta(t,e){Oy(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function r5(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function n5(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Na=new WeakMap,Ay=new WeakMap;function Ra(t){return Ay.get(t)||1}function i5(t,e){return{constTimeNegate:Ca,hasPrecomputes(r){return Ra(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>tf;)n&Is&&(i=i.add(s)),s=s.double(),n>>=Is;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=Ta(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=Ta(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let d=0;d<s;d++){const p=d*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=Is);const y=p,f=p+Math.abs(g)-1,v=d%2!==0,b=g<0;g===0?c=c.add(Ca(v,n[y])):a=a.add(Ca(b,n[f]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=Ta(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const d=h*a;if(i===tf)break;let p=Number(i&c);if(i>>=l,p>a&&(p-=u,i+=Is),p===0)continue;let g=n[d+Math.abs(p)-1];p<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=Na.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&Na.set(n,i(s))),s},wNAFCached(r,n,i){const s=Ra(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Ra(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Oy(n,e),Ay.set(r,n),Na.delete(r)}}}function s5(t,e,r,n){if(r5(r,t),n5(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=by(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let p=0;p<n.length;p++){const g=n[p],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[p])}let d=i;for(let p=c.length-1,g=i;p>0;p--)g=g.add(c[p]),d=d.add(g);if(l=l.add(d),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function Dy(t){return QP(t.Fp),ii(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...$y(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const hn=BigInt(0),Ba=BigInt(1);function o5(t){return ii(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function a5(t){const e=o5(t),{P:r}=e,n=b=>et(b,r),i=e.montgomeryBits,s=Math.ceil(i/8),o=e.nByteLength,a=e.adjustScalarBytes||(b=>b),c=e.powPminus2||(b=>Ey(b,r-BigInt(2),r));function u(b,E,x){const T=n(b*(E-x));return E=n(E-T),x=n(x+T),[E,x]}const l=(e.a-BigInt(2))/BigInt(4);function h(b,E){or("u",b,hn,r),or("scalar",E,hn,r);const x=E,T=b;let I=Ba,O=hn,D=b,_=Ba,B=hn,C;for(let L=BigInt(i-1);L>=hn;L--){const $=x>>L&Ba;B^=$,C=u(B,I,D),I=C[0],D=C[1],C=u(B,O,_),O=C[0],_=C[1],B=$;const w=I+O,m=n(w*w),A=I-O,P=n(A*A),S=m-P,N=D+_,U=D-_,j=n(U*w),q=n(N*A),k=j+q,z=j-q;D=n(k*k),_=n(T*n(z*z)),I=n(m*P),O=n(S*(m+n(l*S)))}C=u(B,I,D),I=C[0],D=C[1],C=u(B,O,_),O=C[0],_=C[1];const R=c(O);return n(I*R)}function d(b){return So(n(b),s)}function p(b){const E=ct("u coordinate",b,s);return o===32&&(E[31]&=127),Mi(E)}function g(b){const E=ct("scalar",b),x=E.length;if(x!==s&&x!==o){let T=""+s+" or "+o;throw new Error("invalid scalar, expected "+T+" bytes, got "+x)}return Mi(a(E))}function y(b,E){const x=p(E),T=g(b),I=h(x,T);if(I===hn)throw new Error("invalid private or public key received");return d(I)}const f=d(e.Gu);function v(b){return y(b,f)}return{scalarMult:y,scalarMultBase:v,getSharedSecret:(b,E)=>y(b,E),getPublicKey:b=>v(b),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:f}}const qc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const c5=BigInt(1),rf=BigInt(2),u5=BigInt(3),l5=BigInt(5);BigInt(8);function h5(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=qc,o=t*t%s*t%s,a=xt(o,rf,s)*o%s,c=xt(a,c5,s)*t%s,u=xt(c,l5,s)*c%s,l=xt(u,e,s)*u%s,h=xt(l,r,s)*l%s,d=xt(h,n,s)*h%s,p=xt(d,i,s)*d%s,g=xt(p,i,s)*d%s,y=xt(g,e,s)*u%s;return{pow_p_5_8:xt(y,rf,s)*t%s,b2:o}}function d5(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}a5({P:qc,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=qc,{pow_p_5_8:r,b2:n}=h5(t);return et(xt(r,u5,e)*n,e)},adjustScalarBytes:d5,randomBytes:ly});function nf(t){t.lowS!==void 0&&Kn("lowS",t.lowS),t.prehash!==void 0&&Kn("prehash",t.prehash)}function f5(t){const e=Dy(t);ii(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:p5,hexToBytes:g5}=WP;class y5 extends Error{constructor(e=""){super(e)}}const er={Err:y5,_tlv:{encode:(t,e)=>{const{Err:r}=er;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Dn(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Dn(i.length/2|128):"";return Dn(t)+s+i+e},decode(t,e){const{Err:r}=er;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=er;if(t<nr)throw new e("integer: negative integers are not allowed");let r=Dn(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=er;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return p5(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=er,i=typeof t=="string"?g5(t):t;is(i);const{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=er,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},nr=BigInt(0),Ae=BigInt(1);BigInt(2);const sf=BigInt(3);BigInt(4);function w5(t){const e=f5(t),{Fp:r}=e,n=Iy(e.n,e.nBitLength),i=e.toBytes||((y,f,v)=>{const b=f.toAffine();return zi(Uint8Array.from([4]),r.toBytes(b.x),r.toBytes(b.y))}),s=e.fromBytes||(y=>{const f=y.subarray(1),v=r.fromBytes(f.subarray(0,r.BYTES)),b=r.fromBytes(f.subarray(r.BYTES,2*r.BYTES));return{x:v,y:b}});function o(y){const{a:f,b:v}=e,b=r.sqr(y),E=r.mul(b,y);return r.add(r.add(E,r.mul(y,f)),v)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return Oo(y,Ae,e.n)}function c(y){const{allowedPrivateKeyLengths:f,nByteLength:v,wrapPrivateKey:b,n:E}=e;if(f&&typeof y!="bigint"){if(Vr(y)&&(y=Wn(y)),typeof y!="string"||!f.includes(y.length))throw new Error("invalid private key");y=y.padStart(v*2,"0")}let x;try{x=typeof y=="bigint"?y:jr(ct("private key",y,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof y)}return b&&(x=et(x,E)),or("private key",x,Ae,E),x}function u(y){if(!(y instanceof d))throw new Error("ProjectivePoint expected")}const l=Lc((y,f)=>{const{px:v,py:b,pz:E}=y;if(r.eql(E,r.ONE))return{x:v,y:b};const x=y.is0();f==null&&(f=x?r.ONE:r.inv(E));const T=r.mul(v,f),I=r.mul(b,f),O=r.mul(E,f);if(x)return{x:r.ZERO,y:r.ZERO};if(!r.eql(O,r.ONE))throw new Error("invZ was invalid");return{x:T,y:I}}),h=Lc(y=>{if(y.is0()){if(e.allowInfinityPoint&&!r.is0(y.py))return;throw new Error("bad point: ZERO")}const{x:f,y:v}=y.toAffine();if(!r.isValid(f)||!r.isValid(v))throw new Error("bad point: x or y not FE");const b=r.sqr(v),E=o(f);if(!r.eql(b,E))throw new Error("bad point: equation left != right");if(!y.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class d{constructor(f,v,b){if(this.px=f,this.py=v,this.pz=b,f==null||!r.isValid(f))throw new Error("x required");if(v==null||!r.isValid(v))throw new Error("y required");if(b==null||!r.isValid(b))throw new Error("z required");Object.freeze(this)}static fromAffine(f){const{x:v,y:b}=f||{};if(!f||!r.isValid(v)||!r.isValid(b))throw new Error("invalid affine point");if(f instanceof d)throw new Error("projective point not allowed");const E=x=>r.eql(x,r.ZERO);return E(v)&&E(b)?d.ZERO:new d(v,b,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(f){const v=r.invertBatch(f.map(b=>b.pz));return f.map((b,E)=>b.toAffine(v[E])).map(d.fromAffine)}static fromHex(f){const v=d.fromAffine(s(ct("pointHex",f)));return v.assertValidity(),v}static fromPrivateKey(f){return d.BASE.multiply(c(f))}static msm(f,v){return s5(d,n,f,v)}_setWindowSize(f){g.setWindowSize(this,f)}assertValidity(){h(this)}hasEvenY(){const{y:f}=this.toAffine();if(r.isOdd)return!r.isOdd(f);throw new Error("Field doesn't support isOdd")}equals(f){u(f);const{px:v,py:b,pz:E}=this,{px:x,py:T,pz:I}=f,O=r.eql(r.mul(v,I),r.mul(x,E)),D=r.eql(r.mul(b,I),r.mul(T,E));return O&&D}negate(){return new d(this.px,r.neg(this.py),this.pz)}double(){const{a:f,b:v}=e,b=r.mul(v,sf),{px:E,py:x,pz:T}=this;let I=r.ZERO,O=r.ZERO,D=r.ZERO,_=r.mul(E,E),B=r.mul(x,x),C=r.mul(T,T),R=r.mul(E,x);return R=r.add(R,R),D=r.mul(E,T),D=r.add(D,D),I=r.mul(f,D),O=r.mul(b,C),O=r.add(I,O),I=r.sub(B,O),O=r.add(B,O),O=r.mul(I,O),I=r.mul(R,I),D=r.mul(b,D),C=r.mul(f,C),R=r.sub(_,C),R=r.mul(f,R),R=r.add(R,D),D=r.add(_,_),_=r.add(D,_),_=r.add(_,C),_=r.mul(_,R),O=r.add(O,_),C=r.mul(x,T),C=r.add(C,C),_=r.mul(C,R),I=r.sub(I,_),D=r.mul(C,B),D=r.add(D,D),D=r.add(D,D),new d(I,O,D)}add(f){u(f);const{px:v,py:b,pz:E}=this,{px:x,py:T,pz:I}=f;let O=r.ZERO,D=r.ZERO,_=r.ZERO;const B=e.a,C=r.mul(e.b,sf);let R=r.mul(v,x),L=r.mul(b,T),$=r.mul(E,I),w=r.add(v,b),m=r.add(x,T);w=r.mul(w,m),m=r.add(R,L),w=r.sub(w,m),m=r.add(v,E);let A=r.add(x,I);return m=r.mul(m,A),A=r.add(R,$),m=r.sub(m,A),A=r.add(b,E),O=r.add(T,I),A=r.mul(A,O),O=r.add(L,$),A=r.sub(A,O),_=r.mul(B,m),O=r.mul(C,$),_=r.add(O,_),O=r.sub(L,_),_=r.add(L,_),D=r.mul(O,_),L=r.add(R,R),L=r.add(L,R),$=r.mul(B,$),m=r.mul(C,m),L=r.add(L,$),$=r.sub(R,$),$=r.mul(B,$),m=r.add(m,$),R=r.mul(L,m),D=r.add(D,R),R=r.mul(A,m),O=r.mul(w,O),O=r.sub(O,R),R=r.mul(w,L),_=r.mul(A,_),_=r.add(_,R),new d(O,D,_)}subtract(f){return this.add(f.negate())}is0(){return this.equals(d.ZERO)}wNAF(f){return g.wNAFCached(this,f,d.normalizeZ)}multiplyUnsafe(f){const{endo:v,n:b}=e;or("scalar",f,nr,b);const E=d.ZERO;if(f===nr)return E;if(this.is0()||f===Ae)return this;if(!v||g.hasPrecomputes(this))return g.wNAFCachedUnsafe(this,f,d.normalizeZ);let{k1neg:x,k1:T,k2neg:I,k2:O}=v.splitScalar(f),D=E,_=E,B=this;for(;T>nr||O>nr;)T&Ae&&(D=D.add(B)),O&Ae&&(_=_.add(B)),B=B.double(),T>>=Ae,O>>=Ae;return x&&(D=D.negate()),I&&(_=_.negate()),_=new d(r.mul(_.px,v.beta),_.py,_.pz),D.add(_)}multiply(f){const{endo:v,n:b}=e;or("scalar",f,Ae,b);let E,x;if(v){const{k1neg:T,k1:I,k2neg:O,k2:D}=v.splitScalar(f);let{p:_,f:B}=this.wNAF(I),{p:C,f:R}=this.wNAF(D);_=g.constTimeNegate(T,_),C=g.constTimeNegate(O,C),C=new d(r.mul(C.px,v.beta),C.py,C.pz),E=_.add(C),x=B.add(R)}else{const{p:T,f:I}=this.wNAF(f);E=T,x=I}return d.normalizeZ([E,x])[0]}multiplyAndAddUnsafe(f,v,b){const E=d.BASE,x=(I,O)=>O===nr||O===Ae||!I.equals(E)?I.multiplyUnsafe(O):I.multiply(O),T=x(this,v).add(x(f,b));return T.is0()?void 0:T}toAffine(f){return l(this,f)}isTorsionFree(){const{h:f,isTorsionFree:v}=e;if(f===Ae)return!0;if(v)return v(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:f,clearCofactor:v}=e;return f===Ae?this:v?v(d,this):this.multiplyUnsafe(e.h)}toRawBytes(f=!0){return Kn("isCompressed",f),this.assertValidity(),i(d,this,f)}toHex(f=!0){return Kn("isCompressed",f),Wn(this.toRawBytes(f))}}d.BASE=new d(e.Gx,e.Gy,r.ONE),d.ZERO=new d(r.ZERO,r.ONE,r.ZERO);const p=e.nBitLength,g=i5(d,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function m5(t){const e=Dy(t);return ii(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function b5(t){const e=m5(t),{Fp:r,n}=e,i=r.BYTES+1,s=2*r.BYTES+1;function o($){return et($,n)}function a($){return kc($,n)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=w5({...e,toBytes($,w,m){const A=w.toAffine(),P=r.toBytes(A.x),S=zi;return Kn("isCompressed",m),m?S(Uint8Array.from([w.hasEvenY()?2:3]),P):S(Uint8Array.from([4]),P,r.toBytes(A.y))},fromBytes($){const w=$.length,m=$[0],A=$.subarray(1);if(w===i&&(m===2||m===3)){const P=jr(A);if(!Oo(P,Ae,r.ORDER))throw new Error("Point is not on curve");const S=l(P);let N;try{N=r.sqrt(S)}catch(j){const q=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+q)}const U=(N&Ae)===Ae;return(m&1)===1!==U&&(N=r.neg(N)),{x:P,y:N}}else if(w===s&&m===4){const P=r.fromBytes(A.subarray(0,r.BYTES)),S=r.fromBytes(A.subarray(r.BYTES,2*r.BYTES));return{x:P,y:S}}else{const P=i,S=s;throw new Error("invalid Point, expected length of "+P+", or uncompressed "+S+", got "+w)}}}),d=$=>Wn(Zn($,e.nByteLength));function p($){const w=n>>Ae;return $>w}function g($){return p($)?o(-$):$}const y=($,w,m)=>jr($.slice(w,m));class f{constructor(w,m,A){this.r=w,this.s=m,this.recovery=A,this.assertValidity()}static fromCompact(w){const m=e.nByteLength;return w=ct("compactSignature",w,m*2),new f(y(w,0,m),y(w,m,2*m))}static fromDER(w){const{r:m,s:A}=er.toSig(ct("DER",w));return new f(m,A)}assertValidity(){or("r",this.r,Ae,n),or("s",this.s,Ae,n)}addRecoveryBit(w){return new f(this.r,this.s,w)}recoverPublicKey(w){const{r:m,s:A,recovery:P}=this,S=I(ct("msgHash",w));if(P==null||![0,1,2,3].includes(P))throw new Error("recovery id invalid");const N=P===2||P===3?m+e.n:m;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=(P&1)===0?"02":"03",j=c.fromHex(U+d(N)),q=a(N),k=o(-S*q),z=o(A*q),H=c.BASE.multiplyAndAddUnsafe(j,k,z);if(!H)throw new Error("point at infinify");return H.assertValidity(),H}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new f(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Gn(this.toDERHex())}toDERHex(){return er.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Gn(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const v={isValidPrivateKey($){try{return u($),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const $=Sy(e.n);return t5(e.randomBytes($),e.n)},precompute($=8,w=c.BASE){return w._setWindowSize($),w.multiply(BigInt(3)),w}};function b($,w=!0){return c.fromPrivateKey($).toRawBytes(w)}function E($){const w=Vr($),m=typeof $=="string",A=(w||m)&&$.length;return w?A===i||A===s:m?A===2*i||A===2*s:$ instanceof c}function x($,w,m=!0){if(E($))throw new Error("first arg must be private key");if(!E(w))throw new Error("second arg must be public key");return c.fromHex(w).multiply(u($)).toRawBytes(m)}const T=e.bits2int||function($){if($.length>8192)throw new Error("input is too large");const w=jr($),m=$.length*8-e.nBitLength;return m>0?w>>BigInt(m):w},I=e.bits2int_modN||function($){return o(T($))},O=Eu(e.nBitLength);function D($){return or("num < 2^"+e.nBitLength,$,nr,O),Zn($,e.nByteLength)}function _($,w,m=B){if(["recovered","canonical"].some(K=>K in m))throw new Error("sign() legacy options not supported");const{hash:A,randomBytes:P}=e;let{lowS:S,prehash:N,extraEntropy:U}=m;S==null&&(S=!0),$=ct("msgHash",$),nf(m),N&&($=ct("prehashed msgHash",A($)));const j=I($),q=u(w),k=[D(q),D(j)];if(U!=null&&U!==!1){const K=U===!0?P(r.BYTES):U;k.push(ct("extraEntropy",K))}const z=zi(...k),H=j;function G(K){const V=T(K);if(!h(V))return;const fe=a(V),se=c.BASE.multiply(V).toAffine(),ne=o(se.x);if(ne===nr)return;const oe=o(fe*o(H+ne*q));if(oe===nr)return;let pe=(se.x===ne?0:2)|Number(se.y&Ae),gt=oe;return S&&p(oe)&&(gt=g(oe),pe^=1),new f(ne,gt,pe)}return{seed:z,k2sig:G}}const B={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function R($,w,m=B){const{seed:A,k2sig:P}=_($,w,m),S=e;return vy(S.hash.outputLen,S.nByteLength,S.hmac)(A,P)}c.BASE._setWindowSize(8);function L($,w,m,A=C){var oe;const P=$;w=ct("msgHash",w),m=ct("publicKey",m);const{lowS:S,prehash:N,format:U}=A;if(nf(A),"strict"in A)throw new Error("options.strict was renamed to lowS");if(U!==void 0&&U!=="compact"&&U!=="der")throw new Error("format must be compact or der");const j=typeof P=="string"||Vr(P),q=!j&&!U&&typeof P=="object"&&P!==null&&typeof P.r=="bigint"&&typeof P.s=="bigint";if(!j&&!q)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let k,z;try{if(q&&(k=new f(P.r,P.s)),j){try{U!=="compact"&&(k=f.fromDER(P))}catch(pe){if(!(pe instanceof er.Err))throw pe}!k&&U!=="der"&&(k=f.fromCompact(P))}z=c.fromHex(m)}catch{return!1}if(!k||S&&k.hasHighS())return!1;N&&(w=e.hash(w));const{r:H,s:G}=k,K=I(w),V=a(G),fe=o(K*V),se=o(H*V),ne=(oe=c.BASE.multiplyAndAddUnsafe(z,fe,se))==null?void 0:oe.toAffine();return ne?o(ne.x)===H:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:x,sign:R,verify:L,ProjectivePoint:c,Signature:f,utils:v}}function v5(t){return{hash:t,hmac:(e,...r)=>my(t,e,Qx(...r)),randomBytes:ly}}function E5(t,e){const r=n=>b5({...t,...v5(n)});return{...r(e),create:r}}const xy=Iy(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),$5=xy.create(BigInt("-3")),I5=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b");E5({a:$5,b:I5,Fp:xy,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},LP);function $u(t){return t.includes(":")}function _i(t){return $u(t)?t.split(":")[0]:t}const _5={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Fc(t,e){const{message:r,code:n}=_5[t];return{message:r,code:n}}function Pn(t,e){return!!Array.isArray(t)}function Ua(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}const of="error",S5="wss://relay.walletconnect.org",O5="wc",A5="universal_provider",_s=`${O5}@2:${A5}:`,Py="https://rpc.walletconnect.org/v1/",_n="generic",D5=`${Py}bundler`,Et={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function x5(){}function Iu(t){return t==null||typeof t!="object"&&typeof t!="function"}function _u(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function P5(t){if(Iu(t))return t;if(Array.isArray(t)||_u(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const n=new r(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){const n=new r(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(e);return Object.assign(n,t)}return t}function af(t){return typeof t=="object"&&t!==null}function Cy(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Ty(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const C5="[object RegExp]",Ny="[object String]",Ry="[object Number]",By="[object Boolean]",Uy="[object Arguments]",T5="[object Symbol]",N5="[object Date]",R5="[object Map]",B5="[object Set]",U5="[object Array]",L5="[object ArrayBuffer]",j5="[object Object]",k5="[object DataView]",q5="[object Uint8Array]",F5="[object Uint8ClampedArray]",M5="[object Uint16Array]",z5="[object Uint32Array]",H5="[object Int8Array]",V5="[object Int16Array]",K5="[object Int32Array]",W5="[object Float32Array]",G5="[object Float64Array]";function Z5(t,e){return xn(t,void 0,t,new Map,e)}function xn(t,e,r,n=new Map,i=void 0){const s=i==null?void 0:i(t,e,r,n);if(s!=null)return s;if(Iu(t))return t;if(n.has(t))return n.get(t);if(Array.isArray(t)){const o=new Array(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=xn(t[a],a,r,n,i);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;n.set(t,o);for(const[a,c]of t)o.set(a,xn(c,a,r,n,i));return o}if(t instanceof Set){const o=new Set;n.set(t,o);for(const a of t)o.add(xn(a,void 0,r,n,i));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(_u(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=xn(t[a],a,r,n,i);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return n.set(t,o),Cr(o,t,r,n,i),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return n.set(t,o),Cr(o,t,r,n,i),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return n.set(t,o),Cr(o,t,r,n,i),o}if(t instanceof Error){const o=new t.constructor;return n.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Cr(o,t,r,n,i),o}if(typeof t=="object"&&Y5(t)){const o=Object.create(Object.getPrototypeOf(t));return n.set(t,o),Cr(o,t,r,n,i),o}return t}function Cr(t,e,r=t,n,i){const s=[...Object.keys(e),...Cy(e)];for(let o=0;o<s.length;o++){const a=s[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=xn(e[a],a,r,n,i))}}function Y5(t){switch(Ty(t)){case Uy:case U5:case L5:case k5:case By:case N5:case W5:case G5:case H5:case V5:case K5:case R5:case Ry:case j5:case C5:case B5:case Ny:case T5:case q5:case F5:case M5:case z5:return!0;default:return!1}}function J5(t,e){return Z5(t,(r,n,i,s)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case Ry:case Ny:case By:{const o=new t.constructor(t==null?void 0:t.valueOf());return Cr(o,t),o}case Uy:{const o={};return Cr(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function cf(t){return J5(t)}function uf(t){return t!==null&&typeof t=="object"&&Ty(t)==="[object Arguments]"}function Q5(t){return _u(t)}function X5(t){var r;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const n=t[Symbol.toStringTag];return n==null||!((r=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&r.writable)?!1:t.toString()===`[object ${n}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function eC(t,...e){const r=e.slice(0,-1),n=e[e.length-1];let i=t;for(let s=0;s<r.length;s++){const o=r[s];i=Mc(i,o,n,new Map)}return i}function Mc(t,e,r,n){if(Iu(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(n.has(e))return P5(n.get(e));if(n.set(e,t),Array.isArray(e)){e=e.slice();for(let s=0;s<e.length;s++)e[s]=e[s]??void 0}const i=[...Object.keys(e),...Cy(e)];for(let s=0;s<i.length;s++){const o=i[s];let a=e[o],c=t[o];if(uf(a)&&(a={...a}),uf(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=cf(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const l=[],h=Reflect.ownKeys(c);for(let d=0;d<h.length;d++){const p=h[d];l[p]=c[p]}c=l}else c=[];const u=r(c,a,o,t,e,n);u!=null?t[o]=u:Array.isArray(a)||af(c)&&af(a)?t[o]=Mc(c,a,r,n):c==null&&X5(a)?t[o]=Mc({},a,r,n):c==null&&Q5(a)?t[o]=cf(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function tC(t,...e){return eC(t,...e,x5)}var rC=Object.defineProperty,nC=Object.defineProperties,iC=Object.getOwnPropertyDescriptors,lf=Object.getOwnPropertySymbols,sC=Object.prototype.hasOwnProperty,oC=Object.prototype.propertyIsEnumerable,hf=(t,e,r)=>e in t?rC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ss=(t,e)=>{for(var r in e||(e={}))sC.call(e,r)&&hf(t,r,e[r]);if(lf)for(var r of lf(e))oC.call(e,r)&&hf(t,r,e[r]);return t},aC=(t,e)=>nC(t,iC(e));function ft(t,e,r){var n;const i=ay(t);return((n=e.rpcMap)==null?void 0:n[i.reference])||`${Py}?chainId=${i.namespace}:${i.reference}&projectId=${r}`}function Yr(t){return t.includes(":")?t.split(":")[1]:t}function Ly(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function cC(t,e){const r=Object.keys(e.namespaces).filter(i=>i.includes(t));if(!r.length)return[];const n=[];return r.forEach(i=>{const s=e.namespaces[i].accounts;n.push(...s)}),n}function Os(t={},e={}){const r=df(t),n=df(e);return tC(r,n)}function df(t){var e,r,n,i,s;const o={};if(!Ua(t))return o;for(const[a,c]of Object.entries(t)){const u=$u(a)?[a]:c.chains,l=c.methods||[],h=c.events||[],d=c.rpcMap||{},p=_i(a);o[p]=aC(Ss(Ss({},o[p]),c),{chains:Oa(u,(e=o[p])==null?void 0:e.chains),methods:Oa(l,(r=o[p])==null?void 0:r.methods),events:Oa(h,(n=o[p])==null?void 0:n.events)}),(Ua(d)||Ua(((i=o[p])==null?void 0:i.rpcMap)||{}))&&(o[p].rpcMap=Ss(Ss({},d),(s=o[p])==null?void 0:s.rpcMap))}return o}function ff(t){return t.includes(":")?t.split(":")[2]:t}function pf(t){const e={};for(const[r,n]of Object.entries(t)){const i=n.methods||[],s=n.events||[],o=n.accounts||[],a=$u(r)?[r]:n.chains?n.chains:Ly(n.accounts);e[r]={chains:a,methods:i,events:s,accounts:o}}return e}function La(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const jy={},re=t=>jy[t],ja=(t,e)=>{jy[t]=e};var uC=Object.defineProperty,lC=(t,e,r)=>e in t?uC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dn=(t,e,r)=>lC(t,typeof e!="symbol"?e+"":e,r);class hC{constructor(e){dn(this,"name","polkadot"),dn(this,"client"),dn(this,"httpProviders"),dn(this,"events"),dn(this,"namespace"),dn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const i=Yr(r);e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}}var dC=Object.defineProperty,fC=Object.defineProperties,pC=Object.getOwnPropertyDescriptors,gf=Object.getOwnPropertySymbols,gC=Object.prototype.hasOwnProperty,yC=Object.prototype.propertyIsEnumerable,zc=(t,e,r)=>e in t?dC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yf=(t,e)=>{for(var r in e||(e={}))gC.call(e,r)&&zc(t,r,e[r]);if(gf)for(var r of gf(e))yC.call(e,r)&&zc(t,r,e[r]);return t},wf=(t,e)=>fC(t,pC(e)),fn=(t,e,r)=>zc(t,typeof e!="symbol"?e+"":e,r);class wC{constructor(e){fn(this,"name","eip155"),fn(this,"client"),fn(this,"chainId"),fn(this,"namespace"),fn(this,"httpProviders"),fn(this,"events"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const n=r||ft(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const i=parseInt(Yr(r));e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,n;let i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const s=parseInt(i,16);if(this.isChainApproved(s))this.setDefaultChain(`${s}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${s}`);else throw new Error(`Failed to switch to chain 'eip155:${s}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,n,i,s,o;const a=(n=(r=e.request)==null?void 0:r.params)==null?void 0:n[0],c=((s=(i=e.request)==null?void 0:i.params)==null?void 0:s[1])||[],u=`${a}${c.join(",")}`;if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),h=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{};if(h!=null&&h[u])return h==null?void 0:h[u];const d=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:wf(yf({},l.sessionProperties||{}),{capabilities:wf(yf({},h||{}),{[u]:d})})})}catch(p){console.warn("Failed to update session with capabilities",p)}return d}async getCallStatus(e){var r,n;const i=this.client.session.get(e.topic),s=(r=i.sessionProperties)==null?void 0:r.bundler_name;if(s){const a=this.getBundlerUrl(e.chainId,s);try{return await this.getUserOperationReceipt(a,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,a)}}const o=(n=i.sessionProperties)==null?void 0:n.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var n;const i=new URL(e),s=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(wr("eth_getUserOperationReceipt",[(n=r.request.params)==null?void 0:n[0]]))});if(!s.ok)throw new Error(`Failed to fetch user operation receipt - ${s.status}`);return await s.json()}getBundlerUrl(e,r){return`${D5}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}}var mC=Object.defineProperty,bC=(t,e,r)=>e in t?mC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,pn=(t,e,r)=>bC(t,typeof e!="symbol"?e+"":e,r);class vC{constructor(e){pn(this,"name","solana"),pn(this,"client"),pn(this,"httpProviders"),pn(this,"events"),pn(this,"namespace"),pn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const i=Yr(r);e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}}var EC=Object.defineProperty,$C=(t,e,r)=>e in t?EC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,gn=(t,e,r)=>$C(t,typeof e!="symbol"?e+"":e,r);class IC{constructor(e){gn(this,"name","cosmos"),gn(this,"client"),gn(this,"httpProviders"),gn(this,"events"),gn(this,"namespace"),gn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const i=Yr(r);e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}}var _C=Object.defineProperty,SC=(t,e,r)=>e in t?_C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yn=(t,e,r)=>SC(t,typeof e!="symbol"?e+"":e,r);class OC{constructor(e){yn(this,"name","algorand"),yn(this,"client"),yn(this,"httpProviders"),yn(this,"events"),yn(this,"namespace"),yn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(!this.httpProviders[e]){const n=r||ft(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;e[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new vt(new Ct(n,re("disableProviderPing")))}}var AC=Object.defineProperty,DC=(t,e,r)=>e in t?AC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wn=(t,e,r)=>DC(t,typeof e!="symbol"?e+"":e,r);class xC{constructor(e){wn(this,"name","cip34"),wn(this,"client"),wn(this,"httpProviders"),wn(this,"events"),wn(this,"namespace"),wn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r),i=Yr(r);e[i]=this.createHttpProvider(i,n)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||this.getCardanoRPCUrl(e);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}}var PC=Object.defineProperty,CC=(t,e,r)=>e in t?PC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mn=(t,e,r)=>CC(t,typeof e!="symbol"?e+"":e,r);class TC{constructor(e){mn(this,"name","elrond"),mn(this,"client"),mn(this,"httpProviders"),mn(this,"events"),mn(this,"namespace"),mn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const i=Yr(r);e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}}var NC=Object.defineProperty,RC=(t,e,r)=>e in t?NC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bn=(t,e,r)=>RC(t,typeof e!="symbol"?e+"":e,r);class BC{constructor(e){bn(this,"name","multiversx"),bn(this,"client"),bn(this,"httpProviders"),bn(this,"events"),bn(this,"namespace"),bn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;const i=Yr(r);e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}}var UC=Object.defineProperty,LC=(t,e,r)=>e in t?UC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vn=(t,e,r)=>LC(t,typeof e!="symbol"?e+"":e,r);class jC{constructor(e){vn(this,"name","near"),vn(this,"client"),vn(this,"httpProviders"),vn(this,"events"),vn(this,"namespace"),vn(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const n=r||ft(`${this.name}:${e}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var n;e[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace);return typeof n>"u"?void 0:new vt(new Ct(n,re("disableProviderPing")))}}var kC=Object.defineProperty,qC=(t,e,r)=>e in t?kC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,En=(t,e,r)=>qC(t,typeof e!="symbol"?e+"":e,r);class FC{constructor(e){En(this,"name","tezos"),En(this,"client"),En(this,"httpProviders"),En(this,"events"),En(this,"namespace"),En(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const n=r||ft(`${this.name}:${e}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,n)}this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace);return typeof n>"u"?void 0:new vt(new Ct(n))}}var MC=Object.defineProperty,zC=(t,e,r)=>e in t?MC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$n=(t,e,r)=>zC(t,typeof e!="symbol"?e+"":e,r);class HC{constructor(e){$n(this,"name",_n),$n(this,"client"),$n(this,"httpProviders"),$n(this,"events"),$n(this,"namespace"),$n(this,"chainId"),this.namespace=e.namespace,this.events=re("events"),this.client=re("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit(Et.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const n={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(i=>{const s=ay(i);n[`${s.namespace}:${s.reference}`]=this.createHttpProvider(i)}),n}getHttpProvider(e){const r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const n=this.createHttpProvider(e,r);n&&(this.httpProviders[e]=n)}createHttpProvider(e,r){const n=r||ft(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new vt(new Ct(n,re("disableProviderPing")))}}var VC=Object.defineProperty,KC=Object.defineProperties,WC=Object.getOwnPropertyDescriptors,mf=Object.getOwnPropertySymbols,GC=Object.prototype.hasOwnProperty,ZC=Object.prototype.propertyIsEnumerable,Hc=(t,e,r)=>e in t?VC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,As=(t,e)=>{for(var r in e||(e={}))GC.call(e,r)&&Hc(t,r,e[r]);if(mf)for(var r of mf(e))ZC.call(e,r)&&Hc(t,r,e[r]);return t},ka=(t,e)=>KC(t,WC(e)),wt=(t,e,r)=>Hc(t,typeof e!="symbol"?e+"":e,r);let YC=class ky{constructor(e){wt(this,"client"),wt(this,"namespaces"),wt(this,"optionalNamespaces"),wt(this,"sessionProperties"),wt(this,"scopedProperties"),wt(this,"events",new Wc),wt(this,"rpcProviders",{}),wt(this,"session"),wt(this,"providerOpts"),wt(this,"logger"),wt(this,"uri"),wt(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Hi(Qs({level:(e==null?void 0:e.logger)||of})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new ky(e);return await r.initialize(),r}async request(e,r,n){const[i,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:As({},e),chainId:`${i}:${s}`,topic:this.session.topic,expiry:n})}sendAsync(e,r,n,i){const s=new Date().getTime();this.request(e,n,i).then(o=>r(null,lo(s,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Fc("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:i}=await this.client.authenticate(e,r);n&&(this.uri=n,this.events.emit("display_uri",n));const s=await i();if(this.session=s.session,this.session){const o=pf(this.session.namespaces);this.namespaces=Os(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return s}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});r&&(this.uri=r,this.events.emit("display_uri",r));const i=await n();this.session=i;const s=pf(i.namespaces);return this.namespaces=Os(this.namespaces,s),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[n,i]=this.validateChain(e),s=this.getProvider(n);s.name===_n?s.setDefaultChain(`${n}:${i}`,r):s.setDefaultChain(i,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Pn(r)){for(const n of r)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await Dx.init({core:this.providerOpts.core,logger:this.providerOpts.logger||of,relayUrl:this.providerOpts.relayUrl||S5,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error("Failed to get session",n),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>_i(r)))];ja("client",this.client),ja("events",this.events),ja("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const n=cC(r,this.session),i=Ly(n),s=Os(this.namespaces,this.optionalNamespaces),o=ka(As({},s[r]),{accounts:n,chains:i});switch(r){case"eip155":this.rpcProviders[r]=new wC({namespace:o});break;case"algorand":this.rpcProviders[r]=new OC({namespace:o});break;case"solana":this.rpcProviders[r]=new vC({namespace:o});break;case"cosmos":this.rpcProviders[r]=new IC({namespace:o});break;case"polkadot":this.rpcProviders[r]=new hC({namespace:o});break;case"cip34":this.rpcProviders[r]=new xC({namespace:o});break;case"elrond":this.rpcProviders[r]=new TC({namespace:o});break;case"multiversx":this.rpcProviders[r]=new BC({namespace:o});break;case"near":this.rpcProviders[r]=new jC({namespace:o});break;case"tezos":this.rpcProviders[r]=new FC({namespace:o});break;default:this.rpcProviders[_n]?this.rpcProviders[_n].updateNamespace(o):this.rpcProviders[_n]=new HC({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:n}=e;n===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:n,topic:i}=e;if(i!==((r=this.session)==null?void 0:r.topic))return;const{event:s}=n;if(s.name==="accountsChanged"){const o=s.data;o&&Pn(o)&&this.events.emit("accountsChanged",o.map(ff))}else if(s.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=_i(o),u=La(o)!==La(a)?`${c}:${La(a)}`:o;this.onChainChanged(u)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var n,i;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:s}=r,o=(i=this.client)==null?void 0:i.session.get(e);this.session=ka(As({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",ka(As({},Fc("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Et.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[_n]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:n={},sessionProperties:i,scopedProperties:s}=e;this.optionalNamespaces=Os(r,n),this.sessionProperties=i,this.scopedProperties=s}validateChain(e){const[r,n]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(o=>_i(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const i=_i(Object.keys(this.namespaces)[0]),s=this.rpcProviders[i].getDefaultChain();return[i,s]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,r=!1){if(!this.namespaces)return;const[n,i]=this.validateChain(e);if(!i)return;this.updateNamespaceChain(n,i),this.events.emit("chainChanged",i);const s=this.getProvider(n).getDefaultChain();r||this.getProvider(n).setDefaultChain(i),this.emitAccountsChangedOnChainChange({namespace:n,previousChainId:s,newChainId:e}),await this.persist("namespaces",this.namespaces)}emitAccountsChangedOnChainChange({namespace:e,previousChainId:r,newChainId:n}){var i,s;try{if(r===n)return;const o=(s=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:s.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${n}:`)).map(ff);if(!Pn(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,r){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${r}`,i={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=r):this.namespaces[n]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var n;const i=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${_s}/${e}${i}`,r)}async getFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${_s}/${e}${n}`)}async deleteFromStore(e){var r;const n=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${_s}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const n of r)n.startsWith(_s)&&await this.client.core.storage.removeItem(n)}catch(r){this.logger.warn("Failed to cleanup storage",r)}}};const JC=YC,QC="wc",XC="ethereum_provider",eT=`${QC}@2:${XC}:`,tT="https://rpc.walletconnect.org/v1/",Gs=["eth_sendTransaction","personal_sign"],qy=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Zs=["chainChanged","accountsChanged"],Fy=["chainChanged","accountsChanged","message","disconnect","connect"],rT=async()=>{const{createAppKit:t}=await If(()=>import("./core-Dsekcj68.js").then(e=>e.X),__vite__mapDeps([5,1,2]));return t};var nT=Object.defineProperty,iT=Object.defineProperties,sT=Object.getOwnPropertyDescriptors,bf=Object.getOwnPropertySymbols,oT=Object.prototype.hasOwnProperty,aT=Object.prototype.propertyIsEnumerable,Vc=(t,e,r)=>e in t?nT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Sr=(t,e)=>{for(var r in e||(e={}))oT.call(e,r)&&Vc(t,r,e[r]);if(bf)for(var r of bf(e))aT.call(e,r)&&Vc(t,r,e[r]);return t},vi=(t,e)=>iT(t,sT(e)),it=(t,e,r)=>Vc(t,typeof e!="symbol"?e+"":e,r);function Ys(t){return Number(t[0].split(":")[1])}function Ds(t){return`0x${t.toString(16)}`}function cT(t){const{chains:e,optionalChains:r,methods:n,optionalMethods:i,events:s,optionalEvents:o,rpcMap:a}=t;if(!Pn(e))throw new Error("Invalid chains");const c={chains:e,methods:n||Gs,events:s||Zs,rpcMap:Sr({},e.length?{[Ys(e)]:a[Ys(e)]}:{})},u=s==null?void 0:s.filter(p=>!Zs.includes(p)),l=n==null?void 0:n.filter(p=>!Gs.includes(p));if(!r&&!o&&!i&&!(u!=null&&u.length)&&!(l!=null&&l.length))return{required:e.length?c:void 0};const h=(u==null?void 0:u.length)&&(l==null?void 0:l.length)||!r,d={chains:[...new Set(h?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(i!=null&&i.length?i:qy))],events:[...new Set(c.events.concat(o!=null&&o.length?o:Fy))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?d:void 0}}class Ao{constructor(){it(this,"events",new pt.EventEmitter),it(this,"namespace","eip155"),it(this,"accounts",[]),it(this,"signer"),it(this,"chainId",1),it(this,"modal"),it(this,"rpc"),it(this,"STORAGE_KEY",eT),it(this,"on",(e,r)=>(this.events.on(e,r),this)),it(this,"once",(e,r)=>(this.events.once(e,r),this)),it(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),it(this,"off",(e,r)=>(this.events.off(e,r),this)),it(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new Ao;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,n){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:n,optional:i}=cT(this.rpc);try{const s=await new Promise(async(a,c)=>{var u,l;this.rpc.showQrModal&&((u=this.modal)==null||u.open(),(l=this.modal)==null||l.subscribeState(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(vi(Sr({namespaces:Sr({},n&&{[this.namespace]:n})},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:h})).then(d=>{a(d)}).catch(d=>{var p;(p=this.modal)==null||p.showErrorMessage("Unable to connect"),c(new Error(d.message))})});if(!s)return;const o=jd(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Ds(this.chainId)})}catch(s){throw this.signer.logger.error(s),s}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var n;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const i=await new Promise(async(o,a)=>{var c,u;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(u=this.modal)==null||u.subscribeState(l=>{!l.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(vi(Sr({},e),{chains:this.rpc.chains}),r).then(l=>{o(l)}).catch(l=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(l.message))})}),s=i.session;if(s){const o=jd(s.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:Ds(this.chainId)})}return i}catch(i){throw this.signer.logger.error(i),i}finally{(n=this.modal)==null||n.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",Ds(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",vi(Sr({},Fc("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Ds(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,n,i]=e.split(":");return{chainId:`${r}:${n}`,address:i}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,n;const i=(r=e==null?void 0:e.chains)!=null?r:[],s=(n=e==null?void 0:e.optionalChains)!=null?n:[],o=i.concat(s);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=i.length?(e==null?void 0:e.methods)||Gs:[],c=i.length?(e==null?void 0:e.events)||Zs:[],u=(e==null?void 0:e.optionalMethods)||[],l=(e==null?void 0:e.optionalEvents)||[],h=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),d=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:i==null?void 0:i.map(p=>this.formatChainId(p)),optionalChains:s.map(p=>this.formatChainId(p)),methods:a,events:c,optionalMethods:u,optionalEvents:l,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:d,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const n={};return e.forEach(i=>{n[i]=this.getRpcUrl(i,r)}),n}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Ys(this.rpc.chains):Ys(this.rpc.optionalChains),this.signer=await JC.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const n=await rT(),{convertWCMToAppKitOptions:i}=await Promise.resolve().then(function(){return bT}),s=i(vi(Sr({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!s.networks.length)throw new Error("No networks found for WalletConnect·");r=n(vi(Sr({},s),{universalProvider:this.signer,manualWCControl:!0}))}catch(n){throw console.warn(n),new Error("To use QR modal, please install @reown/appkit package")}if(r)try{this.modal=r}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:n,rpcMap:i}=e;r&&Pn(r)&&(this.rpc.chains=r.map(s=>this.formatChainId(s)),r.forEach(s=>{this.rpc.rpcMap[s]=(i==null?void 0:i[s])||this.getRpcUrl(s)})),n&&Pn(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(s=>this.formatChainId(s)),n.forEach(s=>{this.rpc.rpcMap[s]=(i==null?void 0:i[s])||this.getRpcUrl(s)}))}getRpcUrl(e,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[e])||`${tT}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const uT=Ao;var lT=Object.defineProperty,hT=Object.defineProperties,dT=Object.getOwnPropertyDescriptors,vf=Object.getOwnPropertySymbols,fT=Object.prototype.hasOwnProperty,pT=Object.prototype.propertyIsEnumerable,Ef=(t,e,r)=>e in t?lT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,My=(t,e)=>{for(var r in e||(e={}))fT.call(e,r)&&Ef(t,r,e[r]);if(vf)for(var r of vf(e))pT.call(e,r)&&Ef(t,r,e[r]);return t},gT=(t,e)=>hT(t,dT(e));function yT(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const wT=t=>{const[e,r]=t.split(":");return zy({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function mT(t){var e,r,n,i,s,o,a;const c=(e=t.chains)==null?void 0:e.map(wT).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const u=c.find(h=>{var d;return h.id===((d=t.defaultChain)==null?void 0:d.id)}),l={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:yT(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:u,metadata:gT(My({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((n=t.metadata)==null?void 0:n.description)||"Connect to WalletConnect-compatible wallets",url:((i=t.metadata)==null?void 0:i.url)||"https://walletconnect.org",icons:((s=t.metadata)==null?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const h=[...(t.mobileWallets||[]).map(g=>({id:g.id,name:g.name,links:g.links})),...(t.desktopWallets||[]).map(g=>({id:g.id,name:g.name,links:{native:g.links.native,universal:g.links.universal}}))],d=[...l.featuredWalletIds||[],...l.excludeWalletIds||[]],p=h.filter(g=>!d.includes(g.id));p.length&&(l.customWallets=p)}return l}function zy(t){return My({formatters:void 0,fees:void 0,serializers:void 0},t)}var bT=Object.freeze({__proto__:null,convertWCMToAppKitOptions:mT,defineChain:zy});const HN=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:uT,OPTIONAL_EVENTS:Fy,OPTIONAL_METHODS:qy,REQUIRED_EVENTS:Zs,REQUIRED_METHODS:Gs,default:Ao},Symbol.toStringTag,{value:"Module"}));export{Am as A,gI as B,Jv as C,uu as D,Ke as E,fo as F,lo as G,IO as H,Kr as I,L1 as J,ar as K,kr as L,Tr as M,Wc as N,Hi as O,ml as P,rp as Q,ho as R,qt as S,bt as T,kt as U,Ct as V,HN as W,Uh as a,fO as b,_N as c,IN as d,go as e,AN as f,ON as g,ip as h,tt as i,ze as j,M as k,dt as l,K1 as m,Si as n,pt as o,Qs as p,Nw as q,SN as r,Za as s,bg as t,lm as u,wr as v,_O as w,Wr as x,rt as y,vt as z};
